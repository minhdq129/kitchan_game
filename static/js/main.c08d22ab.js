/*! For license information please see main.c08d22ab.js.LICENSE.txt */
!function(){var t={7228:function(t){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n},t.exports.__esModule=!0,t.exports.default=t.exports},2858:function(t){t.exports=function(t){if(Array.isArray(t))return t},t.exports.__esModule=!0,t.exports.default=t.exports},3646:function(t,e,i){var n=i(7228);t.exports=function(t){if(Array.isArray(t))return n(t)},t.exports.__esModule=!0,t.exports.default=t.exports},1506:function(t){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.__esModule=!0,t.exports.default=t.exports},4575:function(t){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.__esModule=!0,t.exports.default=t.exports},3913:function(t){function e(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports},3269:function(t,e,i){var n=i(379);t.exports=function(t,e){var i="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=n(t))||e&&t&&"number"===typeof t.length){i&&(t=i);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,h=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){h=!0,o=t},f:function(){try{s||null==i.return||i.return()}finally{if(h)throw o}}}},t.exports.__esModule=!0,t.exports.default=t.exports},9842:function(t,e,i){var n=i(9754),r=i(7067),a=i(8585);t.exports=function(t){var e=r();return function(){var i,r=n(t);if(e){var o=n(this).constructor;i=Reflect.construct(r,arguments,o)}else i=r.apply(this,arguments);return a(this,i)}},t.exports.__esModule=!0,t.exports.default=t.exports},6525:function(t,e,i){var n=i(8331);function r(){return"undefined"!==typeof Reflect&&Reflect.get?(t.exports=r=Reflect.get.bind(),t.exports.__esModule=!0,t.exports.default=t.exports):(t.exports=r=function(t,e,i){var r=n(t,e);if(r){var a=Object.getOwnPropertyDescriptor(r,e);return a.get?a.get.call(arguments.length<3?t:i):a.value}},t.exports.__esModule=!0,t.exports.default=t.exports),r.apply(this,arguments)}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports},9754:function(t){function e(i){return t.exports=e=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},t.exports.__esModule=!0,t.exports.default=t.exports,e(i)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},2205:function(t,e,i){var n=i(9489);t.exports=function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&n(t,e)},t.exports.__esModule=!0,t.exports.default=t.exports},7067:function(t){t.exports=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}},t.exports.__esModule=!0,t.exports.default=t.exports},6860:function(t){t.exports=function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)},t.exports.__esModule=!0,t.exports.default=t.exports},3884:function(t){t.exports=function(t,e){var i=null==t?null:"undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var n,r,a=[],o=!0,s=!1;try{for(i=i.call(t);!(o=(n=i.next()).done)&&(a.push(n.value),!e||a.length!==e);o=!0);}catch(h){s=!0,r=h}finally{try{o||null==i.return||i.return()}finally{if(s)throw r}}return a}},t.exports.__esModule=!0,t.exports.default=t.exports},521:function(t){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports},8206:function(t){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports},8585:function(t,e,i){var n=i(8).default,r=i(1506);t.exports=function(t,e){if(e&&("object"===n(e)||"function"===typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return r(t)},t.exports.__esModule=!0,t.exports.default=t.exports},9591:function(t,e,i){var n=i(8).default;function r(){"use strict";t.exports=r=function(){return e},t.exports.__esModule=!0,t.exports.default=t.exports;var e={},i=Object.prototype,a=i.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",h=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function u(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(R){u=function(t,e,i){return t[e]=i}}function c(t,e,i,n){var r=e&&e.prototype instanceof p?e:p,a=Object.create(r.prototype),o=new _(n||[]);return a._invoke=function(t,e,i){var n="suspendedStart";return function(r,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===r)throw a;return E()}for(i.method=r,i.arg=a;;){var o=i.delegate;if(o){var s=T(o,i);if(s){if(s===f)continue;return s}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===n)throw n="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n="executing";var h=d(t,e,i);if("normal"===h.type){if(n=i.done?"completed":"suspendedYield",h.arg===f)continue;return{value:h.arg,done:i.done}}"throw"===h.type&&(n="completed",i.method="throw",i.arg=h.arg)}}}(t,i,o),a}function d(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(R){return{type:"throw",arg:R}}}e.wrap=c;var f={};function p(){}function v(){}function g(){}var y={};u(y,s,(function(){return this}));var m=Object.getPrototypeOf,w=m&&m(m(I([])));w&&w!==i&&a.call(w,s)&&(y=w);var M=g.prototype=p.prototype=Object.create(y);function b(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function i(r,o,s,h){var l=d(t[r],t,o);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==n(c)&&a.call(c,"__await")?e.resolve(c.__await).then((function(t){i("next",t,s,h)}),(function(t){i("throw",t,s,h)})):e.resolve(c).then((function(t){u.value=t,s(u)}),(function(t){return i("throw",t,s,h)}))}h(l.arg)}var r;this._invoke=function(t,n){function a(){return new e((function(e,r){i(t,n,e,r)}))}return r=r?r.then(a,a):a()}}function T(t,e){var i=t.iterator[e.method];if(void 0===i){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,T(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=d(i,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,f;var r=n.arg;return r?r.done?(e[t.resultName]=r.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function _(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(t){if(t){var e=t[s];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,n=function e(){for(;++i<t.length;)if(a.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:E}}function E(){return{value:void 0,done:!0}}return v.prototype=g,u(M,"constructor",g),u(g,"constructor",v),v.displayName=u(g,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,u(t,l,"GeneratorFunction")),t.prototype=Object.create(M),t},e.awrap=function(t){return{__await:t}},b(x.prototype),u(x.prototype,h,(function(){return this})),e.AsyncIterator=x,e.async=function(t,i,n,r,a){void 0===a&&(a=Promise);var o=new x(c(t,i,n,r),a);return e.isGeneratorFunction(i)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},b(M),u(M,l,"Generator"),u(M,s,(function(){return this})),u(M,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=[];for(var i in t)e.push(i);return e.reverse(),function i(){for(;e.length;){var n=e.pop();if(n in t)return i.value=n,i.done=!1,i}return i.done=!0,i}},e.values=I,_.prototype={constructor:_,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&a.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(i,n){return o.type="throw",o.arg=t,e.next=i,n&&(e.method="next",e.arg=void 0),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n],o=r.completion;if("root"===r.tryLoc)return i("end");if(r.tryLoc<=this.prev){var s=a.call(r,"catchLoc"),h=a.call(r,"finallyLoc");if(s&&h){if(this.prev<r.catchLoc)return i(r.catchLoc,!0);if(this.prev<r.finallyLoc)return i(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return i(r.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return i(r.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var r=n;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=t,o.arg=e,r?(this.method="next",this.next=r.finallyLoc,f):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),k(i),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var n=i.completion;if("throw"===n.type){var r=n.arg;k(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,i){return this.delegate={iterator:I(t),resultName:e,nextLoc:i},"next"===this.method&&(this.arg=void 0),f}},e}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports},9489:function(t){function e(i,n){return t.exports=e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},t.exports.__esModule=!0,t.exports.default=t.exports,e(i,n)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},3038:function(t,e,i){var n=i(2858),r=i(3884),a=i(379),o=i(521);t.exports=function(t,e){return n(t)||r(t,e)||a(t,e)||o()},t.exports.__esModule=!0,t.exports.default=t.exports},8331:function(t,e,i){var n=i(9754);t.exports=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=n(t)););return t},t.exports.__esModule=!0,t.exports.default=t.exports},319:function(t,e,i){var n=i(3646),r=i(6860),a=i(379),o=i(8206);t.exports=function(t){return n(t)||r(t)||a(t)||o()},t.exports.__esModule=!0,t.exports.default=t.exports},8:function(t){function e(i){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(i)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},379:function(t,e,i){var n=i(7228);t.exports=function(t,e){if(t){if("string"===typeof t)return n(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(t,e):void 0}},t.exports.__esModule=!0,t.exports.default=t.exports},8041:function(t){"use strict";var e,i="object"===typeof Reflect?Reflect:null,n=i&&"function"===typeof i.apply?i.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)};e=i&&"function"===typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var r=Number.isNaN||function(t){return t!==t};function a(){a.init.call(this)}t.exports=a,t.exports.once=function(t,e){return new Promise((function(i,n){function r(i){t.removeListener(e,a),n(i)}function a(){"function"===typeof t.removeListener&&t.removeListener("error",r),i([].slice.call(arguments))}v(t,e,a,{once:!0}),"error"!==e&&function(t,e,i){"function"===typeof t.on&&v(t,"error",e,i)}(t,r,{once:!0})}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var o=10;function s(t){if("function"!==typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function h(t){return void 0===t._maxListeners?a.defaultMaxListeners:t._maxListeners}function l(t,e,i,n){var r,a,o,l;if(s(i),void 0===(a=t._events)?(a=t._events=Object.create(null),t._eventsCount=0):(void 0!==a.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),a=t._events),o=a[e]),void 0===o)o=a[e]=i,++t._eventsCount;else if("function"===typeof o?o=a[e]=n?[i,o]:[o,i]:n?o.unshift(i):o.push(i),(r=h(t))>0&&o.length>r&&!o.warned){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=t,u.type=e,u.count=o.length,l=u,console&&console.warn&&console.warn(l)}return t}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function c(t,e,i){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},r=u.bind(n);return r.listener=i,n.wrapFn=r,r}function d(t,e,i){var n=t._events;if(void 0===n)return[];var r=n[e];return void 0===r?[]:"function"===typeof r?i?[r.listener||r]:[r]:i?function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(r):p(r,r.length)}function f(t){var e=this._events;if(void 0!==e){var i=e[t];if("function"===typeof i)return 1;if(void 0!==i)return i.length}return 0}function p(t,e){for(var i=new Array(e),n=0;n<e;++n)i[n]=t[n];return i}function v(t,e,i,n){if("function"===typeof t.on)n.once?t.once(e,i):t.on(e,i);else{if("function"!==typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function r(a){n.once&&t.removeEventListener(e,r),i(a)}))}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(t){if("number"!==typeof t||t<0||r(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");o=t}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(t){if("number"!==typeof t||t<0||r(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},a.prototype.getMaxListeners=function(){return h(this)},a.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var r="error"===t,a=this._events;if(void 0!==a)r=r&&void 0===a.error;else if(!r)return!1;if(r){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var h=a[t];if(void 0===h)return!1;if("function"===typeof h)n(h,this,e);else{var l=h.length,u=p(h,l);for(i=0;i<l;++i)n(u[i],this,e)}return!0},a.prototype.addListener=function(t,e){return l(this,t,e,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(t,e){return l(this,t,e,!0)},a.prototype.once=function(t,e){return s(e),this.on(t,c(this,t,e)),this},a.prototype.prependOnceListener=function(t,e){return s(e),this.prependListener(t,c(this,t,e)),this},a.prototype.removeListener=function(t,e){var i,n,r,a,o;if(s(e),void 0===(n=this._events))return this;if(void 0===(i=n[t]))return this;if(i===e||i.listener===e)0===--this._eventsCount?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!==typeof i){for(r=-1,a=i.length-1;a>=0;a--)if(i[a]===e||i[a].listener===e){o=i[a].listener,r=a;break}if(r<0)return this;0===r?i.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(i,r),1===i.length&&(n[t]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",t,o||e)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(t){var e,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0===--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var r,a=Object.keys(i);for(n=0;n<a.length;++n)"removeListener"!==(r=a[n])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(e=i[t]))this.removeListener(t,e);else if(void 0!==e)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},a.prototype.listeners=function(t){return d(this,t,!0)},a.prototype.rawListeners=function(t){return d(this,t,!1)},a.listenerCount=function(t,e){return"function"===typeof t.listenerCount?t.listenerCount(e):f.call(t,e)},a.prototype.listenerCount=f,a.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]}},9434:function(t,e,i){"use strict";var n=i(3269).default;function r(t){if(this.words=[],null!=(a=t)&&void 0!==a[Symbol.iterator]){var e,i=n(t);try{for(i.s();!(e=i.n()).done;){var r=e.value;this.add(r)}}catch(o){i.e(o)}finally{i.f()}}var a}r.prototype.add=function(t){this.resize(t),this.words[t>>>5]|=1<<t},r.prototype.flip=function(t){this.resize(t),this.words[t>>>5]^=1<<t},r.prototype.clear=function(){this.words=[]},r.prototype.remove=function(t){this.resize(t),this.words[t>>>5]&=~(1<<t)},r.prototype.isEmpty=function(t){for(var e=this.words.length,i=0;i<e;i++)if(0!==this.words[i])return!1;return!0},r.prototype.has=function(t){return 0!==(this.words[t>>>5]&1<<t)},r.prototype.checkedAdd=function(t){this.resize(t);var e=this.words[t>>>5],i=e|1<<t;return this.words[t>>>5]=i,(i^e)>>>t},r.prototype.trim=function(t){for(var e=this.words.length;e>0&&0===this.words[e-1];)e--;this.words=this.words.slice(0,e)},r.prototype.resize=function(t){for(var e=t+32>>>5,i=this.words.length;i<e;i++)this.words[i]=0},r.prototype.hammingWeight=function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},r.prototype.hammingWeight4=function(t,e,i,n){return 16843009*((t=(t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)+(e=(e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)+(i=(i=(858993459&(i-=i>>>1&1431655765))+(i>>>2&858993459))+(i>>>4)&252645135)+(n=(n=(858993459&(n-=n>>>1&1431655765))+(n>>>2&858993459))+(n>>>4)&252645135))>>>24},r.prototype.size=function(){for(var t=0,e=this.words.length,i=this.words,n=0;n<e;n++)t+=this.hammingWeight(i[n]);return t},r.prototype.array=function(){for(var t=new Array(this.size()),e=0,i=this.words.length,n=0;n<i;++n)for(var r=this.words[n];0!=r;){var a=r&-r;t[e++]=(n<<5)+this.hammingWeight(a-1|0),r^=a}return t},r.prototype.forEach=function(t){for(var e=this.words.length,i=0;i<e;++i)for(var n=this.words[i];0!=n;){var r=n&-n;t((i<<5)+this.hammingWeight(r-1|0)),n^=r}},r.prototype.clone=function(){var t=Object.create(r.prototype);return t.words=this.words.slice(),t},r.prototype.intersects=function(t){for(var e=Math.min(this.words.length,t.words.length),i=0;i<e;++i)if(0!==(this.words[i]&t.words[i]))return!0;return!1},r.prototype.intersection=function(t){for(var e=Math.min(this.words.length,t.words.length),i=0;i+7<e;i+=8)this.words[i]&=t.words[i],this.words[i+1]&=t.words[i+1],this.words[i+2]&=t.words[i+2],this.words[i+3]&=t.words[i+3],this.words[i+4]&=t.words[i+4],this.words[i+5]&=t.words[i+5],this.words[i+6]&=t.words[i+6],this.words[i+7]&=t.words[i+7];for(;i<e;++i)this.words[i]&=t.words[i];var n=this.words.length;for(i=e;i<n;++i)this.words[i]=0;return this},r.prototype.intersection_size=function(t){for(var e=Math.min(this.words.length,t.words.length),i=0,n=0;n<e;++n)i+=this.hammingWeight(this.words[n]&t.words[n]);return i},r.prototype.new_intersection=function(t){var e=Object.create(r.prototype),i=Math.min(this.words.length,t.words.length);e.words=new Array(i);for(var n=i,a=0;a+7<n;a+=8)e.words[a]=this.words[a]&t.words[a],e.words[a+1]=this.words[a+1]&t.words[a+1],e.words[a+2]=this.words[a+2]&t.words[a+2],e.words[a+3]=this.words[a+3]&t.words[a+3],e.words[a+4]=this.words[a+4]&t.words[a+4],e.words[a+5]=this.words[a+5]&t.words[a+5],e.words[a+6]=this.words[a+6]&t.words[a+6],e.words[a+7]=this.words[a+7]&t.words[a+7];for(;a<n;++a)e.words[a]=this.words[a]&t.words[a];return e},r.prototype.equals=function(t){for(var e=Math.min(this.words.length,t.words.length),i=0;i<e;++i)if(this.words[i]!=t.words[i])return!1;if(this.words.length<t.words.length){var n=t.words.length;for(i=this.words.length;i<n;++i)if(0!=t.words[i])return!1}else if(t.words.length<this.words.length)for(n=this.words.length,i=t.words.length;i<n;++i)if(0!=this.words[i])return!1;return!0},r.prototype.difference=function(t){for(var e=Math.min(this.words.length,t.words.length),i=0;i+7<e;i+=8)this.words[i]&=~t.words[i],this.words[i+1]&=~t.words[i+1],this.words[i+2]&=~t.words[i+2],this.words[i+3]&=~t.words[i+3],this.words[i+4]&=~t.words[i+4],this.words[i+5]&=~t.words[i+5],this.words[i+6]&=~t.words[i+6],this.words[i+7]&=~t.words[i+7];for(;i<e;++i)this.words[i]&=~t.words[i];return this},r.prototype.difference_size=function(t){for(var e=Math.min(this.words.length,t.words.length),i=0,n=0;n<e;++n)i+=this.hammingWeight(this.words[n]&~t.words[n]);for(var r=this.words.length;n<r;++n)i+=this.hammingWeight(this.words[n]);return i},r.prototype.toString=function(){return"{"+this.array().join(",")+"}"},r.prototype.union=function(t){for(var e=Math.min(this.words.length,t.words.length),i=0;i+7<e;i+=8)this.words[i]|=t.words[i],this.words[i+1]|=t.words[i+1],this.words[i+2]|=t.words[i+2],this.words[i+3]|=t.words[i+3],this.words[i+4]|=t.words[i+4],this.words[i+5]|=t.words[i+5],this.words[i+6]|=t.words[i+6],this.words[i+7]|=t.words[i+7];for(;i<e;++i)this.words[i]|=t.words[i];if(this.words.length<t.words.length){this.resize((t.words.length<<5)-1);var n=t.words.length;for(i=e;i<n;++i)this.words[i]=t.words[i]}return this},r.prototype.new_union=function(t){var e=Object.create(r.prototype),i=Math.max(this.words.length,t.words.length);e.words=new Array(i);for(var n=Math.min(this.words.length,t.words.length),a=0;a+7<n;a+=8)e.words[a]=this.words[a]|t.words[a],e.words[a+1]=this.words[a+1]|t.words[a+1],e.words[a+2]=this.words[a+2]|t.words[a+2],e.words[a+3]=this.words[a+3]|t.words[a+3],e.words[a+4]=this.words[a+4]|t.words[a+4],e.words[a+5]=this.words[a+5]|t.words[a+5],e.words[a+6]=this.words[a+6]|t.words[a+6],e.words[a+7]=this.words[a+7]|t.words[a+7];for(;a<n;++a)e.words[a]=this.words[a]|t.words[a];var o=this.words.length;for(a=n;a<o;++a)e.words[a]=this.words[a];var s=t.words.length;for(a=n;a<s;++a)e.words[a]=t.words[a];return e},r.prototype.new_difference=function(t){return this.clone().difference(t)},r.prototype.union_size=function(t){for(var e=Math.min(this.words.length,t.words.length),i=0,n=0;n<e;++n)i+=this.hammingWeight(this.words[n]|t.words[n]);if(this.words.length<t.words.length){var r=t.words.length;for(n=this.words.length;n<r;++n)i+=this.hammingWeight(0|t.words[n])}else for(r=this.words.length,n=t.words.length;n<r;++n)i+=this.hammingWeight(0|this.words[n]);return i},t.exports=r},1281:function(t,e,i){"use strict";var n=i(3913).default,r=i(4575).default,a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Archetype=void 0;var o=a(i(9434)),s=n((function t(e){r(this,t),this.componentBits=new o.default,this.componentBitsInitialized=!1,this.componentTypes=e}));e.Archetype=s},3713:function(t,e,i){"use strict";var n=i(3913).default,r=i(4575).default;Object.defineProperty(e,"__esModule",{value:!0}),e.Component=void 0;var a=n((function t(){r(this,t)}));e.Component=a},9179:function(t,e,i){"use strict";var n=i(4575).default,r=i(3913).default;Object.defineProperty(e,"__esModule",{value:!0}),e.ComponentMapper=void 0;var a=function(){function t(){n(this,t),this.data=[]}return r(t,[{key:"add",value:function(t,e){this.data[t]=e}},{key:"get",value:function(t){return this.data[t]}},{key:"remove",value:function(t){delete this.data[t]}}]),t}();e.ComponentMapper=a},1218:function(t,e,i){"use strict";var n=i(3269).default,r=i(4575).default,a=i(3913).default,o=i(6525).default,s=i(9754).default,h=i(2205).default,l=i(9842).default,u=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.EntityIteratingSystem=void 0;var c=i(4905),d=u(i(9434)),f=function(t){h(i,t);var e=l(i);function i(t){var n;return r(this,i),(n=e.call(this)).componentBits=new d.default,n.types=t,n}return a(i,[{key:"setWorld",value:function(t){o(s(i.prototype),"setWorld",this).call(this,t);var e,r=n(this.types);try{for(r.s();!(e=r.n()).done;){var a=e.value;this.componentBits.add(t.getComponentIndex(a))}}catch(h){r.e(h)}finally{r.f()}}},{key:"process",value:function(){this.begin(),this.world.getEntities(this.componentBits,this.processEntity.bind(this)),this.end()}},{key:"begin",value:function(){}},{key:"end",value:function(){}}]),i}(c.System);e.EntityIteratingSystem=f},2645:function(t,e,i){"use strict";var n=i(4575).default,r=i(3913).default,a=i(2205).default,o=i(9842).default;Object.defineProperty(e,"__esModule",{value:!0}),e.EntitySystem=void 0;var s=function(t){a(i,t);var e=o(i);function i(){var t;return n(this,i),(t=e.apply(this,arguments)).entities=[],t}return r(i,[{key:"process",value:function(){this.entities.length=0,this.begin(),this.world.getEntities(this.componentBits,this.processEntity.bind(this)),this.processEntities(this.entities),this.end()}},{key:"processEntity",value:function(t){this.entities.push(t)}}]),i}(i(1218).EntityIteratingSystem);e.EntitySystem=s},6310:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Inject=void 0,e.Inject=function(t){return function(e,i){var n=e.constructor;n.hasOwnProperty("__inject__")||(n.__inject__={}),n.__inject__[i]=t}}},1185:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.InjectMapper=void 0,e.InjectMapper=function(t){return function(e,i){var n=e.constructor;n.hasOwnProperty("__injectMapper__")||(n.__injectMapper__={}),n.__injectMapper__[i]=t}}},4905:function(t,e,i){"use strict";var n=i(4575).default,r=i(3913).default;Object.defineProperty(e,"__esModule",{value:!0}),e.System=void 0;var a=function(){function t(){n(this,t)}return r(t,[{key:"setWorld",value:function(t){this.world=t}},{key:"initialized",value:function(){}},{key:"dispose",value:function(){}}]),t}();e.System=a},8293:function(t,e,i){"use strict";var n=i(3269).default,r=i(4575).default,a=i(3913).default,o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var s=o(i(9434)),h=i(9179),l=function(){function t(){r(this,t),this.index=0,this.mappers={},this.componentBitsMap=[],this.componentIndices=new Map,this.currentComponentIndex=0,this.activeSystems=[],this.passiveSystems=[],this.injectionRegistry={},this.delta=0}return a(t,[{key:"getNewId",value:function(){return this.index++}},{key:"createEntity",value:function(){return this.getNewId()}},{key:"getComponentBits",value:function(t){return this.componentBitsMap[t]||(this.componentBitsMap[t]=new s.default),this.componentBitsMap[t]}},{key:"getMapper",value:function(t){var e=this.getComponentIndex(t);return this.getMapperByIndex(e)}},{key:"getMapperByIndex",value:function(t){return this.mappers[t]||(this.mappers[t]=new h.ComponentMapper),this.mappers[t]}},{key:"getComponentIndex",value:function(t){var e=this.componentIndices.get(t);return void 0===e&&(e=this.currentComponentIndex++,this.componentIndices.set(t,e)),e}},{key:"createEntityByArchetype",value:function(t){var e=this,i=this.getNewId();return t.componentTypes.forEach((function(n){var r=new n;t.componentBitsInitialized||t.componentBits.add(e.getComponentIndex(n)),e.addComponent(i,r,!1)})),this.componentBitsMap[i]=t.componentBits,i}},{key:"addComponent",value:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.getComponentIndex(e.constructor),r=this.getMapperByIndex(n);return r.add(t,e),i&&this.getComponentBits(t).add(n),e}},{key:"getComponent",value:function(t,e){return this.getMapper(e).get(t)}},{key:"getEntities",value:function(t,e){for(var i=0;i<this.componentBitsMap.length;i++)if(this.componentBitsMap[i]){var n=this.componentBitsMap[i];t.union_size(n)===n.size()&&e(i)}}},{key:"addSystem",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e?this.activeSystems.push(t):this.passiveSystems.push(t),t.setWorld(this),this.injectMapper(t),this.inject(t),t.initialized()}},{key:"injectMapper",value:function(t){var e=t.constructor.__injectMapper__||{};for(var i in e){var n=e[i];t[i]=this.getMapper(n)}}},{key:"register",value:function(t,e){this.injectionRegistry[t]=e}},{key:"inject",value:function(t){var e=t.constructor.__inject__||{};for(var i in e){var n=e[i];t[i]=this.injectionRegistry[n]}}},{key:"dispose",value:function(){var t,e=n(this.activeSystems);try{for(e.s();!(t=e.n()).done;){t.value.dispose()}}catch(a){e.e(a)}finally{e.f()}var i,r=n(this.passiveSystems);try{for(r.s();!(i=r.n()).done;){i.value.dispose()}}catch(a){r.e(a)}finally{r.f()}}},{key:"setDelta",value:function(t){this.delta=t}},{key:"processActiveSystem",value:function(){var t,e=n(this.activeSystems);try{for(e.s();!(t=e.n()).done;){t.value.process()}}catch(i){e.e(i)}finally{e.f()}}},{key:"processPassiveSystem",value:function(){var t,e=n(this.passiveSystems);try{for(e.s();!(t=e.n()).done;){t.value.process()}}catch(i){e.e(i)}finally{e.f()}}},{key:"deleteEntity",value:function(t){for(var e in this.mappers)this.mappers[e].remove(t);delete this.componentBitsMap[t]}},{key:"isEntityActive",value:function(t){return!!this.componentBitsMap[t]}}]),t}();e.default=l},9997:function(t,e,i){"use strict";var n=i(8293);Object.defineProperty(e,"q3",{enumerable:!0,get:function(){return n.default}});var r=i(1281);var a=i(3713);var o=i(9179);var s=i(1218);var h=i(2645);var l=i(4905);Object.defineProperty(e,"xP",{enumerable:!0,get:function(){return l.System}});var u=i(1185);var c=i(6310);Object.defineProperty(e,"tB",{enumerable:!0,get:function(){return c.Inject}})},8656:function(t,e,i){"use strict";var n,r=i(3269).default,a=i(4575).default,o=i(3913).default;Object.defineProperty(e,"__esModule",{value:!0}),e.Animation=e.PlayMode=void 0,function(t){t[t.NORMAL=0]="NORMAL",t[t.LOOP=1]="LOOP",t[t.LOOP_PINGPONG=2]="LOOP_PINGPONG",t[t.REVERSED=3]="REVERSED",t[t.LOOP_REVERSED=4]="LOOP_REVERSED"}(n=e.PlayMode||(e.PlayMode={}));var s=function(){function t(e,i){a(this,t),this.totalDuration=0,this.keyFrames=e,Array.isArray(i)||(i=[i]);for(var n=i[i.length-1]||0;i.length<e.length;)i.push(n);var o,s=r(i);try{for(s.s();!(o=s.n()).done;){var h=o.value;this.totalDuration+=h}}catch(l){s.e(l)}finally{s.f()}this.frameDurations=i}return o(t,[{key:"getFrameNumber",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.frameDurations,n=e?i.length-1:0;!((t-=i[n])<0);)e?n--:n++;return n}},{key:"getKeyFrame",value:function(t,e){var i=this.keyFrames,r=this.frameDurations,a=this.totalDuration,o=Math.floor(t/a),s=t%a,h=0;switch(e){case n.NORMAL:h=0===o?this.getFrameNumber(s):r.length-1;break;case n.LOOP:h=this.getFrameNumber(s);break;case n.LOOP_PINGPONG:h=this.getFrameNumber(s,o%2===1);break;case n.REVERSED:h=0===o?this.getFrameNumber(s,!0):0;break;case n.LOOP_REVERSED:h=this.getFrameNumber(s,!0)}return i[h]}}]),t}();e.Animation=s},2121:function(t,e,i){"use strict";var n=i(319).default,r=i(9591).default,a=i(3269).default,o=i(4575).default,s=i(3913).default,h=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(r,a){function o(t){try{h(n.next(t))}catch(e){a(e)}}function s(t){try{h(n.throw(t))}catch(e){a(e)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,s)}h((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.AssetManager=void 0;var l=i(7581),u=i(7139),c=i(9396),d=function(){function t(e){o(this,t),this.promises=[],this.atlases=new Map,this.textures=new Map,this.jsonData=new Map,this.binaryData=new Map,this.done=0,this.listeners=[],this.fonts=new Map,this.gl=e}return s(t,[{key:"addListener",value:function(t){this.listeners.push(t)}},{key:"reportDone",value:function(){this.done++;var t,e=a(this.listeners);try{for(e.s();!(t=e.n()).done;){(0,t.value)(this.done/this.getTotal()*100,this.done>=this.getTotal())}}catch(i){e.e(i)}finally{e.f()}}},{key:"loadAtlas",value:function(t,e){var i=this,n=c.TextureAtlas.load(this.gl,t,{}).then((function(t){return i.atlases.set(e,t),i.reportDone(),t}));return this.promises.push(n),n}},{key:"getAtlas",value:function(t){return this.atlases.get(t)}},{key:"loadJsonData",value:function(t,e){var i=this,n=fetch(t).then((function(t){return t.json()})).then((function(t){return i.jsonData.set(e,t),i.reportDone(),t}));return this.promises.push(n),n}},{key:"getJsonData",value:function(t){return this.jsonData.get(t)}},{key:"loadBinaryData",value:function(t,e){var i=this,n=fetch(t).then((function(t){return t.arrayBuffer()})).then((function(t){return i.binaryData.set(e,t),i.reportDone(),t}));return this.promises.push(n),n}},{key:"getBinaryData",value:function(t){return this.binaryData.get(t)}},{key:"loadFont",value:function(t,e){var i=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=l.BitmapFont.load(this.gl,t,n).then((function(t){return i.fonts.set(e,t),i.reportDone(),t}));return this.promises.push(r),r}},{key:"getFont",value:function(t){return this.fonts.get(t)}},{key:"loadTexture",value:function(t,e){var i=this,n=u.Texture.load(this.gl,t).then((function(t){return i.textures.set(e,t),i.reportDone(),t}));return this.promises.push(n),n}},{key:"getTexture",value:function(t){return this.textures.get(t)}},{key:"finishLoading",value:function(){return h(this,void 0,void 0,r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(this.promises);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"getDone",value:function(){return this.done}},{key:"getTotal",value:function(){return this.promises.length}},{key:"disposeAll",value:function(){var t=this;n(this.atlases.keys()).forEach((function(e){var i;((null===(i=t.atlases.get(e))||void 0===i?void 0:i.getRegions())||[]).forEach((function(t){var e;null===(e=t.texture)||void 0===e||e.destroy()})),t.atlases.delete(e)})),n(this.textures.keys()).forEach((function(e){var i;null===(i=t.textures.get(e))||void 0===i||i.destroy(),t.textures.delete(e)})),n(this.fonts.keys()).forEach((function(e){var i;((null===(i=t.fonts.get(e))||void 0===i?void 0:i.getRegions())||[]).forEach((function(t){var e;null===(e=t.texture)||void 0===e||e.destroy()})),t.fonts.delete(e)}))}}]),t}();e.AssetManager=d,e.default=d},7581:function(t,e,i){"use strict";var n=i(9591).default,r=i(3913).default,a=i(4575).default,o=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(r,a){function o(t){try{h(n.next(t))}catch(e){a(e)}}function s(t){try{h(n.throw(t))}catch(e){a(e)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,s)}h((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.BitmapFont=void 0;var s=i(3959),h=i(2791),l=i(8606),u=r((function t(e,i,n){var r=this;a(this,t),this.load=function(t){for(var e=Object.values(t.glyphs),i=0;i<e.length;i++){var n=e[i];if(n)for(var a=0;a<n.length;a++){var o=n[a];o&&t.setGlyphRegion(o,r.regions[o.page])}}null!=t.missingGlyph&&t.setGlyphRegion(t.missingGlyph,r.regions[t.missingGlyph.page])},this.draw=function(t,e,i,n,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:l.Align.left,s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:e.length,c=arguments.length>9?arguments[9]:void 0;r.cache.clear(),r.cache.addText(e,i,n,h,u,a,o,s,c),r.cache.draw(t)},this.getColor=function(){return r.cache.getColor()},this.getScaleX=function(){return r.data.scaleX},this.getScaleY=function(){return r.data.scaleY},this.getRegions=function(){return r.regions},this.getRegion=function(t){return r.regions[t]},this.getLineHeight=function(){return r.data.lineHeight},this.getSpaceXadvance=function(){return r.data.spaceXadvance},this.getXHeight=function(){return r.data.xHeight},this.getCapHeight=function(){return r.data.capHeight},this.getAscent=function(){return r.data.ascent},this.getDescent=function(){return r.data.descent},this.isFlipped=function(){return r.flipped},this.dispose=function(){if(r.ownsTexture)for(var t=0;t<r.regions.length;t++)r.regions[t].texture.dispose()},this.setFixedWidthGlyphs=function(t){for(var e=r.data,i=0,n=0,a=t.length;n<a;n++){var o=e.getGlyph(t.charAt(n));null!=o&&o.xadvance>i&&(i=o.xadvance)}for(var s=0,h=t.length;s<h;s++){var l=e.getGlyph(t.charAt(s));l&&(l.xoffset+=(i-l.xadvance)/2,l.xadvance=i,l.kerning=[],l.kerning=null,l.fixedWidth=!0)}},this.setUseIntegerPositions=function(t){r.integer=t,r.cache.setUseIntegerPositions(t)},this.usesIntegerPositions=function(){return r.integer},this.getCache=function(){return r.cache},this.getData=function(){return r.data},this.getOwnsTexture=function(){return r.ownsTexture},this.setOwnsTexture=function(t){r.ownsTexture=t},this.newFontCache=function(){return new s.BitmapFontCache(r,r.integer)},this.regions=i,this.flipped=e.flipped,this.data=e,this.integer=n,0!==this.regions.length?(this.ownsTexture=!1,this.cache=this.newFontCache(),this.load(e)):console.log("No texture region were found")}));e.BitmapFont=u,u.load=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return o(void 0,void 0,void 0,n().mark((function a(){var o;return n().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=new h.BitmapFontData(e,i),n.next=3,o.loadFont(t);case 3:return n.abrupt("return",new u(o,o.regions,r));case 4:case"end":return n.stop()}}),a)})))}},3959:function(t,e,i){"use strict";var n=i(319).default,r=i(4575).default,a=i(3913).default;Object.defineProperty(e,"__esModule",{value:!0}),e.BitmapFontCache=void 0;var o=i(7712),s=i(9699),h=i(8606),l=function(){function t(e,i){var a=this;r(this,t),this.tempColor=new h.Color(1,1,1,1),this.drawingTexts=[],this.layouts=[],this.pooledLayouts=[],this.color=new h.Color(1,1,1,1),this.setPosition=function(t,e){a.translate(t-a.x,e-a.y)},this.translate=function(t,e){if(0!==t||0!==e){a.integer&&(t=Math.round(t),e=Math.round(e)),a.x+=t,a.y+=e;for(var i=a.pageVertices,n=0,r=i.length;n<r;n++)for(var o=i[n],s=0,h=a.idx[n];s<h;s+=5)o[s]+=t,o[s+1]+=e}},this.setColors=function(t,e,i,n){for(var r=255<<24|255*i<<16|255*e<<8|255*t,o=s.NumberUtil.intToFloatColor(r),h=0,l=a.pageVertices.length;h<l;h++)for(var u=a.pageVertices[h],c=2,d=a.idx[h];c<d;c+=5)u[c]=o},this.getColor=function(){return a.color},this.setColor=function(t,e,i,n){a.color.set(t,e,i,n)},this.clear=function(){a.x=0,a.y=0,h.Pools.freeAll("GlyphLayout",a.pooledLayouts),a.pooledLayouts.length=0,a.layouts.length=0;for(var t=0,e=a.idx.length;t<e;t++)null!=a.pageGlyphIndices&&(a.pageGlyphIndices[t].length=0),a.idx[t]=0},this.requireGlyphs=function(t){if(1===a.pageVertices.length)a.requirePageGlyphs(0,t.glyphCount);else{for(var e=a.tempGlyphCount,i=0;i<e.length;i++)e[i]=0;for(var n=0,r=t.runs.length;n<r;n++)for(var o=t.runs[n].glyphs,s=o,h=0,l=o.length;h<l;h++)e[s[h].page]++;for(var u=0,c=e.length;u<c;u++)a.requirePageGlyphs(u,e[u])}},this.requirePageGlyphs=function(t,e){var i=a.idx[t]+20*e,n=a.pageVertices[t];if(n){if(n.length<i){var r=new Array(i);h.Utils.arrayCopy(n,0,r,0,a.idx[t]),a.pageVertices[t]=r}}else a.pageVertices[t]=new Array(i)},this.setPageCount=function(t){var e=new Array(t).fill([]);h.Utils.arrayCopy(a.pageVertices,0,e,0,a.pageVertices.length),a.pageVertices=n(e);var i=new Array(t);h.Utils.arrayCopy(a.idx,0,i,0,a.idx.length),a.idx=i;var r=new Array(t),o=0;null!=a.pageGlyphIndices&&(o=a.pageGlyphIndices.length,h.Utils.arrayCopy(a.pageGlyphIndices,0,r,0,a.pageGlyphIndices.length));for(var s=o;s<t;s++)r[s]=[];a.pageGlyphIndices=r,a.tempGlyphCount=new Array(t)},this.addToCache=function(t,e,i){var n=t.runs.length;if(0!==n){a.pageVertices.length<a.font.regions.length&&a.setPageCount(a.font.regions.length),a.layouts.push(t),a.requireGlyphs(t);var r=t.colors,o=0,h=0,l=0,u=0;a.drawingTexts.length=0;for(var c=0;c<n;c++)for(var d=t.runs[c],f=d.glyphs,p=d.xAdvances,v=e+d.x,g=i+d.y,y=0,m=d.glyphs.length;y<m;y++)l++===h&&(u=s.NumberUtil.intToFloatColor(r[++o]),h=++o<r.length?r[o]:-1),v+=p[y],a.drawingTexts.push(f[y].id),a.addGlyph(f[y],v,g,u);a.currentTint=s.NumberUtil.intToFloatColor(-1)}},this.addGlyph=function(t,e,i,n){var r=a.font.data.scaleX,o=a.font.data.scaleY;e+=t.xoffset*r,i+=t.yoffset*o;var s=t.width*r,h=t.height*o,l=t.u,u=t.u2,c=t.v,d=t.v2;a.integer&&(e=Math.round(e),i=Math.round(i),s=Math.round(s),h=Math.round(h));var f=e+s,p=i+h,v=t.page,g=a.idx[v];a.idx[v]+=20,null!=a.pageGlyphIndices&&a.pageGlyphIndices[v].push(a.glyphCount++);var y=a.pageVertices[v];y[g++]=e,y[g++]=i,y[g++]=n,y[g++]=l,y[g++]=c,y[g++]=e,y[g++]=p,y[g++]=n,y[g++]=l,y[g++]=d,y[g++]=f,y[g++]=p,y[g++]=n,y[g++]=u,y[g++]=d,y[g++]=f,y[g++]=i,y[g++]=n,y[g++]=u,y[g]=c},this.setText=function(t,e,i,n,r,o,s,h,l){return a.clear(),a.addText(t,e,i,n,r,o,s,h,l)},this.setTextToCache=function(t,e,i){a.clear(),a.addTextToCache(t,e,i)},this.addText=function(t,e,i,n,r,o,s,l,u){var c=h.Pools.obtain("GlyphLayout");return a.pooledLayouts.push(c),c.setText(a.font,t,n,r,a.color,o,s,l,u),a.addTextToCache(c,e,i),c},this.addTextToCache=function(t,e,i){a.addToCache(t,e,i+a.font.data.ascent)},this.getX=function(){return a.x},this.getY=function(){return a.y},this.getFont=function(){return a.font},this.setUseIntegerPositions=function(t){a.integer=t},this.usesIntegerPositions=function(){return a.integer},this.getVertices=function(t){return a.pageVertices[t]},this.getVertexCount=function(t){return a.idx[t]},this.getLayouts=function(){return a.layouts},this.font=e,this.integer=i;var l=e.regions.length;if(0===l&&console.log("The specified font must contain at least one texture page."),this.pageVertices=new Array(l).fill([]),this.idx=new Array(l),l>1){this.pageGlyphIndices=new Array(l);for(var u=0,c=this.pageGlyphIndices.length;u<c;u++)this.pageGlyphIndices[u]=[]}this.tempGlyphCount=new Array(l),h.Pools.get("GlyphLayout",(function(){return new o.GlyphLayout(e,"",0,0,h.Color.WHITE,0,h.Align.left,!1)}))}return a(t,[{key:"draw",value:function(t){for(var e=this,i=this.font.getRegions(),n=0;n<this.pageVertices.length;n++)if(this.idx[n]>0)for(var r=this.pageVertices[n],a=function(n){var a=20*n,o=i.find((function(t){var i;return t.id===(null===(i=e.drawingTexts)||void 0===i?void 0:i[n])}));o&&o.draw(t,r[0+a],r[1+a],r[10+a]-r[0+a],r[11+a]-r[1+a])},o=0;o<this.idx[n]/20;o++)a(o)}}]),t}();e.BitmapFontCache=l},2791:function(t,e,i){"use strict";var n=i(319).default,r=i(9591).default,a=i(4575).default,o=i(3913).default,s=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(r,a){function o(t){try{h(n.next(t))}catch(e){a(e)}}function s(t){try{h(n.throw(t))}catch(e){a(e)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,s)}h((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.BitmapFontData=void 0;var h=i(2013),l=i(7139),u=i(859);function c(t,e){for(var i=t.split("/"),n=e.split("/"),r=[],a=0,o=i.length;a<o;a++)if(".."===i[a])r.pop();else{if("."===i[a])continue;r.push(i[a])}for(var s=0,h=n.length;s<h;s++)if(".."===n[s])r.pop();else{if("."===n[s])continue;r.push(n[s])}return r.join("/")}var d=65535,f=function(){function t(e,i){var n=this;a(this,t),this.capHeight=1,this.blankLineScale=1,this.scaleX=1,this.scaleY=1,this.glyphs={},this.xHeight=1,this.xChars=["x","e","a","o","n","s","r","c","u","m","v","w","z"],this.capChars=["M","N","B","D","C","E","F","K","A","G","H","I","J","L","O","P","Q","R","S","T","U","V","W","X","Y","Z"],this.loadFont=function(t){return s(n,void 0,void 0,r().mark((function e(){var i,n,a,o,s,f,v,g,y,m,w,M,b,x,T,S,k,_,I,E,R,A,P,O,D,L,C,B,z,H,V,F,N,G,j,W,U,Y,X,K,q,Q,J,Z,$,tt,et,it,nt,rt,at,ot,st,ht,lt,ut,ct,dt,ft,pt,vt,gt,yt,mt,wt,Mt;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.imagePaths){e.next=2;break}return e.abrupt("return");case 2:return i=0,e.next=5,fetch(this.fontFile);case 5:return a=e.sent,e.next=8,a.text();case 8:if(n=e.sent,o=n.split(/\r?\n/).map((function(t){return t.trim()})),e.prev=10,"string"===typeof(s=o[i])){e.next=14;break}throw new Error("File is empty.");case 14:if(s=s.substring(s.indexOf("padding=")+8),4===(f=s.substring(0,s.indexOf(" ")).split(",",4)).length){e.next=18;break}throw new Error("Invalid padding.");case 18:if(this.padTop=parseInt(f[0]),this.padRight=parseInt(f[1]),this.padBottom=parseInt(f[2]),this.padLeft=parseInt(f[3]),v=this.padTop+this.padBottom,i++,"string"===typeof(s=o[i])){e.next=27;break}throw new Error("Missing common header.");case 27:if(!((g=s.split(" ",9)).length<3)){e.next=30;break}throw new Error("Invalid common header.");case 30:if(g[1].startsWith("lineHeight=")){e.next=32;break}throw new Error("Missing: lineHeight");case 32:if(this.lineHeight=parseInt(g[1].substring(11)),g[2].startsWith("base=")){e.next=35;break}throw new Error("Missing: base");case 35:if(y=parseInt(g[2].substring(5)),m=1,g.length>=6&&null!=g[5]&&g[5].startsWith("pages="))try{m=Math.max(1,parseInt(g[5].substring(6)))}catch(r){}this.imagePaths=new Array(m),w=[],M=0;case 41:if(!(M<m)){e.next=65;break}if(i++,"string"===typeof(s=o[i])){e.next=46;break}throw new Error("Missing additional page definitions.");case 46:if(!((b=s.match(new RegExp(".*id=(\\d+)")))&&b.length>1)){e.next=57;break}if(x=b[1],e.prev=49,parseInt(x)===M){e.next=53;break}throw new Error("Page IDs must be indices starting at 0: "+x);case 53:e.next=57;break;case 55:e.prev=55,e.t0=e.catch(49);case 57:if((T=s.match(new RegExp('.*file="?([^"]+)"?')))&&!(T.length<=1)){e.next=60;break}throw new Error("Missing: file");case 60:S=T[1],w[M]=S;case 62:M++,e.next=41;break;case 65:this.descent=0;case 66:if(i++,s=o[i]){e.next=71;break}return e.abrupt("break",105);case 71:if(!s.startsWith("kernings ")){e.next=73;break}return e.abrupt("break",105);case 73:if(!s.startsWith("metrics ")){e.next=75;break}return e.abrupt("break",105);case 75:if(s.startsWith("char ")){e.next=77;break}return e.abrupt("continue",66);case 77:if(k=new h.Glyph,(_=new p(s,"=")).nextToken(),_.nextToken(),!((I=parseInt(_.nextToken()))>0&&I>d)){e.next=84;break}return e.abrupt("continue",66);case 84:if(k.id=I+"",_.nextToken(),k.srcX=parseInt(_.nextToken()),_.nextToken(),k.srcY=parseInt(_.nextToken()),_.nextToken(),k.width=parseInt(_.nextToken()),_.nextToken(),k.height=parseInt(_.nextToken()),_.nextToken(),k.xoffset=parseInt(_.nextToken()),_.nextToken(),this.flipped?k.yoffset=parseInt(_.nextToken()):k.yoffset=-(k.height+parseInt(_.nextToken())),_.nextToken(),k.xadvance=parseInt(_.nextToken()),_.hasMoreTokens()&&_.nextToken(),_.hasMoreTokens())try{k.page=parseInt(_.nextToken())}catch(bt){}k.width>0&&k.height>0&&(this.descent=Math.min(y+k.yoffset,this.descent)),I<=0?this.missingGlyph=k:I<=d&&this.setGlyph(I,k),e.next=66;break;case 105:this.descent+=this.padBottom;case 106:if(i++,"string"===typeof(s=o[i])){e.next=111;break}return e.abrupt("break",127);case 111:if(s.startsWith("kerning ")){e.next=113;break}return e.abrupt("break",127);case 113:if((E=new p(s,"=")).nextToken(),E.nextToken(),R=parseInt(E.nextToken()),E.nextToken(),A=parseInt(E.nextToken()),!(R<0||R>d||A<0||A>d)){e.next=121;break}return e.abrupt("continue",106);case 121:P=this.getGlyph(R+""),E.nextToken(),O=parseInt(E.nextToken()),P&&P.setKerning(A,O),e.next=106;break;case 127:D=!1,L=0,C=0,B=0,z=0,H=0,V=0,F=0,null!=s&&s.startsWith("metrics ")&&(D=!0,(N=new p(s,"=")).nextToken(),N.nextToken(),L=parseFloat(N.nextToken()),N.nextToken(),C=parseFloat(N.nextToken()),N.nextToken(),B=parseFloat(N.nextToken()),N.nextToken(),z=parseFloat(N.nextToken()),N.nextToken(),H=parseFloat(N.nextToken()),N.nextToken(),V=parseFloat(N.nextToken()),N.nextToken(),F=parseFloat(N.nextToken())),(G=this.getGlyph("32"))||((G=new h.Glyph).id="32",(j=this.getGlyph("l"))||(j=this.getFirstGlyph()),G.xadvance=j.xadvance,this.setGlyph(32,G)),0===G.width&&(G.width=this.padLeft+G.xadvance+this.padRight,G.xoffset=-this.padLeft),this.spaceXadvance=G.xadvance,U=0;case 141:if(!(U<this.xChars.length)){e.next=148;break}if(!(W=this.getGlyph(this.xChars[U]))){e.next=145;break}return e.abrupt("break",148);case 145:U++,e.next=141;break;case 148:W||(W=this.getFirstGlyph()),this.xHeight=W.height-v,X=0;case 151:if(!(X<this.capChars.length)){e.next=158;break}if(!(Y=this.getGlyph(this.capChars[X]))){e.next=155;break}return e.abrupt("break",158);case 155:X++,e.next=151;break;case 158:if(Y){e.next=178;break}K=Object.values(this.glyphs),q=0;case 161:if(!(q<K.length)){e.next=176;break}if(Q=K[q]){e.next=165;break}return e.abrupt("continue",173);case 165:J=0;case 166:if(!(J<Q.length)){e.next=173;break}if(Q[J]&&0!==Q[J].height&&0!==Q[J].width){e.next=169;break}return e.abrupt("continue",170);case 169:this.capHeight=Math.max(this.capHeight,Q[J].height);case 170:J++,e.next=166;break;case 173:q++,e.next=161;break;case 176:e.next=179;break;case 178:this.capHeight=Y.height;case 179:for(this.capHeight-=v,this.ascent=y-this.capHeight,this.down=-this.lineHeight,this.flipped&&(this.ascent=-this.ascent,this.down=-this.down),D&&(this.ascent=L,this.descent=C,this.down=B,this.capHeight=z,this.lineHeight=H,this.spaceXadvance=V,this.xHeight=F),Z=[],$=Object.values(this.glyphs),tt=0;tt<$.length;tt++)for(et=Object.values($[tt]),it=0;it<et.length;it++)nt={id:et[it].id,left:et[it].srcX,top:et[it].srcY,width:et[it].width,height:et[it].height,xoffset:et[it].xoffset,yoffset:et[it].yoffset,xadvance:et[it].xadvance,page:w[et[it].page],pageId:et[it].page},Z.push(nt);rt=[],at=0;case 189:if(!(at<m)){e.next=199;break}return e.next=192,l.Texture.load(t,c(this.fontFile,"../".concat(w[at])));case 192:ot=e.sent,st=1/ot.width,ht=1/ot.height,rt.push({texture:ot,invTexWidth:st,invTexHeight:ht});case 196:at++,e.next=189;break;case 199:for(this.regions=[],lt=0,ut=Z;lt<ut.length;lt++)ct=ut[lt],dt=ct.left,ft=ct.top,pt=ct.width,vt=ct.height,gt=rt[ct.pageId],yt=gt.texture,mt=gt.invTexWidth,wt=gt.invTexHeight,(Mt=new u.TextureRegion(yt,dt,ft,pt,vt,ct,mt,wt)).originalWidth=pt,Mt.originalHeight=vt,Mt.offsetX=0,Mt.offsetY=0,this.regions.push(Mt);e.next=206;break;case 203:e.prev=203,e.t1=e.catch(10),console.error(e.t1);case 206:case"end":return e.stop()}}),e,this,[[10,203],[49,55]])})))},this.setGlyphRegion=function(t,e){var i=e.texture,r=1/i.width,a=1/i.height,o=e.u,s=e.v,h=(e.originalWidth,e.originalHeight,t.srcX),l=t.srcX+t.width,u=t.srcY,c=t.srcY+t.height;t.u=o+h*r,t.u2=o+l*r,n.flipped?(t.v=s+u*a,t.v2=s+c*a):(t.v2=s+u*a,t.v=s+c*a)},this.setLineHeight=function(t){n.lineHeight=t*n.scaleY,n.down=n.flipped?n.lineHeight:-n.lineHeight},this.setGlyph=function(t,e){var i=n.glyphs[t/h.PAGE_SIZE];i||(i=new Array(h.PAGE_SIZE),n.glyphs[t/h.PAGE_SIZE]=i),i[t&h.PAGE_SIZE-1]=e},this.getFirstGlyph=function(){for(var t=Object.values(n.glyphs),e=0;e<t.length;e++){var i=t[e];if(i)for(var r=0;r<i.length;r++){var a=i[r];if(a&&0!==a.height&&0!==a.width)return a}}},this.hasGlyph=function(t){return!!n.missingGlyph||null!=n.getGlyph(t)},this.getGlyph=function(t){var e=n.glyphs[t.charCodeAt(0)/h.PAGE_SIZE];if(null!=e)return e[t.charCodeAt(0)&h.PAGE_SIZE-1]},this.getGlyphs=function(t,e,i,r,a){if(0!==r-i){var o=n.markupEnabled,s=n.scaleX,h=t.glyphs,l=t.xAdvances;do{var u=e.charAt(i++);if("\r"!==u){var c=n.getGlyph(u);if(!c){if(!n.missingGlyph)continue;c=n.missingGlyph}h.push(c),l.push(a?(a.xadvance+a.getKerning(u))*s:c.fixedWidth?0:-c.xoffset*s-n.padLeft),a=c,o&&"["===u&&i<r&&"["===e.charAt(i)&&i++}}while(i<r);if(a){var d=a.fixedWidth?a.xadvance*s:(a.width+a.xoffset)*s-n.padRight;l.push(d)}}},this.getWrapIndex=function(t,e){var i=e-1,r=t,a=r[i].id;if(n.isWhitespace(a+""))return i;for(n.isBreakChar(a+"")&&i--;i>0;i--)if(a=r[i].id,n.isWhitespace(a+"")||n.isBreakChar(a+""))return i+1;return 0},this.isBreakChar=function(t){if(!n.breakChars)return!1;for(var e=String.fromCharCode(parseInt(t)),i=0;i<n.breakChars.length;i++)if(e===n.breakChars[i])return!0;return!1},this.isWhitespace=function(t){switch(String.fromCharCode(parseInt(t))){case"\n":case"\r":case"\t":case" ":return!0;default:return!1}},this.getImagePath=function(t){return n.imagePaths[t]},this.getImagePaths=function(){return n.imagePaths},this.setScale=function(t,e){if(0!==t&&0!==e){var i=t/n.scaleX,r=e/n.scaleY;n.lineHeight*=r,n.spaceXadvance*=i,n.xHeight*=r,n.capHeight*=r,n.ascent*=r,n.descent*=r,n.down*=r,n.padLeft*=i,n.padRight*=i,n.padTop*=r,n.padBottom*=r,n.scaleX=t,n.scaleY=e}},this.scale=function(t){n.setScale(n.scaleX+t,n.scaleY+t)},this.fontFile=e,this.flipped=i}return o(t,[{key:"setXYScale",value:function(t){this.setScale(t,t)}}]),t}();e.BitmapFontData=f;var p=function(){function t(e,i){a(this,t),this.strArray=[],this.currentIndex=0;for(var r=e.split(/\s+/),o=0;o<r.length;o++){var s,h=r[o];(s=this.strArray).push.apply(s,n(h.split(i)))}}return o(t,[{key:"hasMoreTokens",value:function(){return this.currentIndex>=this.strArray.length}},{key:"nextToken",value:function(){return this.strArray[this.currentIndex++]}}]),t}()},5477:function(t,e,i){"use strict";var n=i(3269).default,r=i(4575).default,a=i(3913).default;Object.defineProperty(e,"__esModule",{value:!0}),e.BoundingBox=void 0;var o=i(7811),s=function(){function t(){r(this,t),this.min=new o.Vector3,this.max=new o.Vector3,this.cnt=new o.Vector3,this.dim=new o.Vector3,this.clr()}return a(t,[{key:"getCenter",value:function(t){return t.setFrom(this.cnt)}},{key:"getCenterX",value:function(){return this.cnt.x}},{key:"getCenterY",value:function(){return this.cnt.y}},{key:"getCenterZ",value:function(){return this.cnt.z}},{key:"getCorner000",value:function(t){return t.set(this.min.x,this.min.y,this.min.z)}},{key:"getCorner001",value:function(t){return t.set(this.min.x,this.min.y,this.max.z)}},{key:"getCorner010",value:function(t){return t.set(this.min.x,this.max.y,this.min.z)}},{key:"getCorner011",value:function(t){return t.set(this.min.x,this.max.y,this.max.z)}},{key:"getCorner100",value:function(t){return t.set(this.max.x,this.min.y,this.min.z)}},{key:"getCorner101",value:function(t){return t.set(this.max.x,this.min.y,this.max.z)}},{key:"getCorner110",value:function(t){return t.set(this.max.x,this.max.y,this.min.z)}},{key:"getCorner111",value:function(t){return t.set(this.max.x,this.max.y,this.max.z)}},{key:"getDimensions",value:function(t){return t.setFrom(this.dim)}},{key:"getWidth",value:function(){return this.dim.x}},{key:"getHeight",value:function(){return this.dim.y}},{key:"getDepth",value:function(){return this.dim.z}},{key:"getMin",value:function(t){return t.setFrom(this.min)}},{key:"getMax",value:function(t){return t.setFrom(this.max)}},{key:"setFromBounds",value:function(t){return this.set(t.min,t.max)}},{key:"set",value:function(t,e){return this.min.set(t.x<e.x?t.x:e.x,t.y<e.y?t.y:e.y,t.z<e.z?t.z:e.z),this.max.set(t.x>e.x?t.x:e.x,t.y>e.y?t.y:e.y,t.z>e.z?t.z:e.z),this.update(),this}},{key:"update",value:function(){this.cnt.setFrom(this.min).add(this.max).scale(.5),this.dim.setFrom(this.max).sub(this.min)}},{key:"setFromPoints",value:function(t){this.inf();var e,i=n(t);try{for(i.s();!(e=i.n()).done;){var r=e.value;this.extPoint(r)}}catch(a){i.e(a)}finally{i.f()}return this}},{key:"inf",value:function(){return this.min.set(1/0,1/0,1/0),this.max.set(-1/0,-1/0,-1/0),this.cnt.set(0,0,0),this.dim.set(0,0,0),this}},{key:"extPoint",value:function(t){return this.set(this.min.set(Math.min(this.min.x,t.x),Math.min(this.min.y,t.y),Math.min(this.min.z,t.z)),this.max.set(Math.max(this.max.x,t.x),Math.max(this.max.y,t.y),Math.max(this.max.z,t.z)))}},{key:"clr",value:function(){return this.set(this.min.set(0,0,0),this.max.set(0,0,0))}},{key:"isValid",value:function(){return this.min.x<=this.max.x&&this.min.y<=this.max.y&&this.min.z<=this.max.z}},{key:"extBounds",value:function(t){return this.set(this.min.set(Math.min(this.min.x,t.min.x),Math.min(this.min.y,t.min.y),Math.min(this.min.z,t.min.z)),this.max.set(Math.max(this.max.x,t.max.x),Math.max(this.max.y,t.max.y),Math.max(this.max.z,t.max.z)))}},{key:"extSphere",value:function(t,e){return this.set(this.min.set(Math.min(this.min.x,t.x-e),Math.min(this.min.y,t.y-e),Math.min(this.min.z,t.z-e)),this.max.set(Math.max(this.max.x,t.x+e),Math.max(this.max.y,t.y+e),Math.max(this.max.z,t.z+e)))}},{key:"extTransformedBox",value:function(e,i){return this.extPoint(t.tmpVector.set(e.min.x,e.min.y,e.min.z).multiply(i)),this.extPoint(t.tmpVector.set(e.min.x,e.min.y,e.max.z).multiply(i)),this.extPoint(t.tmpVector.set(e.min.x,e.max.y,e.min.z).multiply(i)),this.extPoint(t.tmpVector.set(e.min.x,e.max.y,e.max.z).multiply(i)),this.extPoint(t.tmpVector.set(e.max.x,e.min.y,e.min.z).multiply(i)),this.extPoint(t.tmpVector.set(e.max.x,e.min.y,e.max.z).multiply(i)),this.extPoint(t.tmpVector.set(e.max.x,e.max.y,e.min.z).multiply(i)),this.extPoint(t.tmpVector.set(e.max.x,e.max.y,e.max.z).multiply(i)),this}},{key:"mul",value:function(e){var i=this.min.x,n=this.min.y,r=this.min.z,a=this.max.x,o=this.max.y,s=this.max.z;return this.inf(),this.extPoint(t.tmpVector.set(i,n,r).multiply(e)),this.extPoint(t.tmpVector.set(i,n,s).multiply(e)),this.extPoint(t.tmpVector.set(i,o,r).multiply(e)),this.extPoint(t.tmpVector.set(i,o,s).multiply(e)),this.extPoint(t.tmpVector.set(a,n,r).multiply(e)),this.extPoint(t.tmpVector.set(a,n,s).multiply(e)),this.extPoint(t.tmpVector.set(a,o,r).multiply(e)),this.extPoint(t.tmpVector.set(a,o,s).multiply(e)),this}},{key:"containsBounds",value:function(t){return!this.isValid()||this.min.x<=t.min.x&&this.min.y<=t.min.y&&this.min.z<=t.min.z&&this.max.x>=t.max.x&&this.max.y>=t.max.y&&this.max.z>=t.max.z}},{key:"intersects",value:function(t){if(!this.isValid())return!1;var e=Math.abs(this.cnt.x-t.cnt.x),i=this.dim.x/2+t.dim.x/2,n=Math.abs(this.cnt.y-t.cnt.y),r=this.dim.y/2+t.dim.y/2,a=Math.abs(this.cnt.z-t.cnt.z),o=this.dim.z/2+t.dim.z/2;return e<=i&&n<=r&&a<=o}},{key:"containsPoint",value:function(t){return this.min.x<=t.x&&this.max.x>=t.x&&this.min.y<=t.y&&this.max.y>=t.y&&this.min.z<=t.z&&this.max.z>=t.z}},{key:"ext",value:function(t,e,i){return this.set(this.min.set(Math.min(this.min.x,t),Math.min(this.min.y,e),Math.min(this.min.z,i)),this.max.set(Math.max(this.max.x,t),Math.max(this.max.y,e),Math.max(this.max.z,i)))}}]),t}();e.BoundingBox=s,s.tmpVector=new o.Vector3},7459:function(t,e,i){"use strict";var n=i(4575).default,r=i(3913).default;Object.defineProperty(e,"__esModule",{value:!0}),e.OrthoCamera=void 0;var a=i(4995),o=i(7811),s=function(){function t(e,i,r,s){n(this,t),this.position=new o.Vector3(0,0,0),this.direction=new o.Vector3(0,0,-1),this.up=new o.Vector3(0,1,0),this.near=0,this.far=100,this.zoom=1,this.viewportWidth=0,this.viewportHeight=0,this.projectionView=new a.Matrix4,this.inverseProjectionView=new a.Matrix4,this.projection=new a.Matrix4,this.view=new a.Matrix4,this.tmp3=new o.Vector3,this.resize(e,i,r,s)}return r(t,[{key:"setYDown",value:function(t){t?(this.up.set(0,-1,0),this.direction.set(0,0,1)):(this.up.set(0,1,0),this.direction.set(0,0,-1)),this.update()}},{key:"resize",value:function(t,e,i,n){this.viewportWidth=t,this.viewportHeight=e,this.screenWidth=i,this.screenHeight=n,this.update()}},{key:"setPosition",value:function(t,e){this.position.set(t,e,this.position.z)}},{key:"update",value:function(){var t=this.projection,e=this.view,i=this.projectionView,n=this.inverseProjectionView,r=this.zoom,a=this.viewportWidth,o=this.viewportHeight;t.ortho(r*(-a/2),r*(a/2),r*(-o/2),r*(o/2),this.near,this.far),e.lookAt(this.position,this.direction,this.up),i.set(t.values),i.multiply(e),n.set(i.values).invert(),this.combined=i.values}},{key:"screenToWorld",value:function(t,e,i){e=e||this.screenWidth,i=i||this.screenHeight;var n=t.x,r=i-t.y-1;return t.x=2*n/e-1,t.y=2*r/i-1,t.z=2*t.z-1,t.project(this.inverseProjectionView),t}},{key:"worldToScreen",value:function(t,e,i){return e=e||this.screenWidth,i=i||this.screenHeight,t.project(this.projectionView),t.x=e*(t.x+1)/2,t.y=i*(t.y+1)/2,t.z=(t.z+1)/2,t}},{key:"unprojectVector2",value:function(t,e){this.tmp3.set(e.x,e.y,0),this.screenToWorld(this.tmp3),t.set(this.tmp3.x,this.tmp3.y)}},{key:"setViewport",value:function(t,e){this.viewportWidth=t,this.viewportHeight=e}}]),t}();e.OrthoCamera=s},6176:function(t,e,i){"use strict";var n=i(4575).default,r=i(3913).default;Object.defineProperty(e,"__esModule",{value:!0}),e.Game=void 0;var a=function(){function t(){n(this,t)}return r(t,[{key:"setScreen",value:function(t){this.currentScreen&&this.currentScreen.dispose&&this.currentScreen.dispose(),this.currentScreen=t,this.currentScreen&&this.currentScreen.init&&this.currentScreen.init(this)}},{key:"update",value:function(t){this.currentScreen&&this.currentScreen.update&&this.currentScreen.update(t,this)}}]),t}();e.Game=a,a.shared=new a},2013:function(t,e,i){"use strict";var n=i(4575).default,r=i(3913).default;Object.defineProperty(e,"__esModule",{value:!0}),e.Glyph=e.PAGES=e.PAGE_SIZE=e.LOG2_PAGE_SIZE=void 0,e.LOG2_PAGE_SIZE=9,e.PAGE_SIZE=1<<e.LOG2_PAGE_SIZE,e.PAGES=65536/e.PAGE_SIZE;var a=function(){function t(){n(this,t),this.page=0}return r(t,[{key:"getKerning",value:function(t){if(this.kerning){var i=this.kerning[t.charCodeAt(0)>>>e.LOG2_PAGE_SIZE];if(null!=i)return i[t.charCodeAt(0)&e.PAGE_SIZE-1]}return 0}},{key:"setKerning",value:function(t,i){this.kerning||(this.kerning=[]);var n=this.kerning[t>>>e.LOG2_PAGE_SIZE];n||(this.kerning[t>>>e.LOG2_PAGE_SIZE]=n=new Uint32Array(new ArrayBuffer(e.PAGE_SIZE))),n[t&e.PAGE_SIZE-1]=i}}]),t}();e.Glyph=a},7712:function(t,e,i){"use strict";var n=i(319).default,r=i(4575).default,a=i(3913).default;Object.defineProperty(e,"__esModule",{value:!0}),e.GlyphLayout=void 0;var o=i(9045),s=i(8606),h=function(){function t(e,i,a,h,l,u,c,d,f){var p=this;r(this,t),this.epsilon=1e-4,this.glyphRunPool=s.Pools.get("GlyphRun",(function(){return new o.GlyphRun})),this.colorStack=new Array(4),this.runs=[],this.colors=[],this.setText=function(t,e,i,n,r,a,o,s,h){p.reset();var l=t.data;if(i!==n){s&&(a=Math.max(a,3*l.spaceXadvance));var u=s||null!=h,c=r.toIntBits(),d=c;p.colors.shift();var f=l.markupEnabled;f&&p.colorStack.push(c);for(var v=!1,g=0,y=l.down,m=null,w=null,M=i;;){var b=void 0,x=!1;if(i===n){if(M===n)break;b=n,v=!0}else{if("\n"!==e.charAt(i++))continue;b=i-1,x=!0}t:{var T=p.glyphRunPool.obtain();if(T.x=0,T.y=g,l.getGlyphs(T,e,M,b,w),p.glyphCount+=T.glyphs.length,d!==c&&(p.colors[p.colors.length-2]===p.glyphCount?p.colors[p.colors.length-1]=d:(p.colors.push(p.glyphCount),p.colors.push(d)),c=d),0===T.glyphs.length){if(p.glyphRunPool.free(T),!m)break}else m?(m.appendRun(T),p.glyphRunPool.free(T)):(m=T,p.runs.push(m));if(x||v?(p.setLastGlyphXAdvance(l,m),w=null):w=m.glyphs[m.glyphs.length-1],u&&0!==m.glyphs.length&&(x||v))for(var S=m.xAdvances[0]+m.xAdvances[1],k=2;k<m.xAdvances.length;k++){var _=m.glyphs[k-1];if(S+p.getGlyphWidth(_,l)-p.epsilon<=a)S+=m.xAdvances[k];else{if(null!=h){p.truncate(l,m,a,h);break}var I=l.getWrapIndex(m.glyphs,k);if((0===I&&0===m.x||I>=m.glyphs.length)&&(I=k-1),!(m=p.wrap(l,m,I)))break t;p.runs.push(m),g+=y,m.x=0,m.y=g,S=m.xAdvances[0]+m.xAdvances[1],k=1}}}x&&(m=null,w=null,g+=b===M?y*l.blankLineScale:y),M=i}p.height=l.capHeight+Math.abs(g),p.calculateWidths(l),p.alignRuns(a,o),f&&(p.colorStack.length=0)}else p.height=l.capHeight},this.calculateWidths=function(t){for(var e,i=0,r=n(p.runs),a=0,o=p.runs.length;a<o;a++){for(var s=r[a],h=s.xAdvances,l=s.x+h[0],u=0,c=s.glyphs,d=0;d<s.glyphs.length;){var f=c[d],v=p.getGlyphWidth(f,t);u=Math.max(u,l+v),l+=null!==(e=h[++d])&&void 0!==e?e:0}s.width=Math.max(l,u)-s.x,i=Math.max(i,s.x+(isNaN(s.width)?l:s.width))}p.width=i},this.alignRuns=function(t,e){if(0===(e&s.Align.left))for(var i=0!==(e&s.Align.center),r=n(p.runs),a=0,o=p.runs.length;a<o;a++){var h=r[a];h.x+=i?.5*(t-h.width):t-h.width}},this.truncate=function(t,e,i,n){var r=e.glyphs.length,a=p.glyphRunPool.obtain();t.getGlyphs(a,n,0,n.length,null);var o=0;if(a.xAdvances.length>0){p.setLastGlyphXAdvance(t,a);for(var h=a.xAdvances,l=1;l<a.xAdvances.length;l++)o+=h[l]}i-=o;for(var u=0,c=e.x,d=e.xAdvances;u<e.xAdvances.length;){if((c+=d[u])>i)break;u++}if(u>1){if(u-1>=0&&e.glyphs.length>u-1)for(var f=u-1;f<e.glyphs.length;f++)e.glyphs.splice(f,1);if(u>=0&&e.xAdvances.length>u)for(var v=u;v<e.xAdvances.length;v++)e.xAdvances.splice(v,1);p.setLastGlyphXAdvance(t,e),a.xAdvances.length>0&&s.Utils.arrayCopy(a.xAdvances,1,e.xAdvances,e.xAdvances.length,a.xAdvances.length-1)}else e.glyphs.length=0,e.xAdvances.length=0,s.Utils.arrayCopy(a.xAdvances,0,e.xAdvances,e.xAdvances.length,a.xAdvances.length);var g=r-e.glyphs.length;if(g>0&&(p.glyphCount-=g,t.markupEnabled))for(;p.colors.length>2&&p.colors[p.colors.length-2]>=p.glyphCount;)p.colors.length-=2;s.Utils.arrayCopy(a.glyphs,0,e.glyphs,e.glyphs.length,a.glyphs.length),p.glyphCount+=n.length,p.glyphRunPool.free(a)},this.setLastGlyphXAdvance=function(t,e){var i=e.glyphs[e.glyphs.length-1];i.fixedWidth||(e.xAdvances[e.xAdvances.length-1]=p.getGlyphWidth(i,t))},this.getGlyphWidth=function(t,e){return(t.width+t.xoffset)*e.scaleX-e.padRight},this.getLineOffset=function(t,e){return-t[0].xoffset*e.scaleX-e.padLeft},this.reset=function(){p.glyphRunPool.freeAll(p.runs),p.runs.length=0,p.colors.length=0,p.glyphCount=0,p.width=0,p.height=0},this.setText(e,i,a,h,l,u,c,d,f)}return a(t,[{key:"wrap",value:function(t,e,i){for(var n=e.glyphs.length,r=e.glyphs,a=e.xAdvances,o=i;o>0&&t.isWhitespace(r[o-1].id);o--);for(var h,l=i;l<n&&t.isWhitespace(r[l].id);l++);if(l<n){var u=(h=this.glyphRunPool.obtain()).glyphs;s.Utils.arrayCopy(r,0,u,u.length,o),r.splice(0,l-1+1),e.glyphs=u,h.glyphs=r;var c=h.xAdvances;s.Utils.arrayCopy(a,0,c,c.length,o+1),a.splice(1,l),a[0]=this.getLineOffset(r,t),e.xAdvances=c,h.xAdvances=a;var d=e.glyphs.length,f=h.glyphs.length,p=n-d-f;if(this.glyphCount-=p,t.markupEnabled&&p>0)for(var v=this.glyphCount-f,g=this.colors.length-2;g>=2;g-=2){var y=this.colors[g];if(y<=v)break;this.colors[g]=y-p}}else{r=r.slice(0,o),a=a.slice(0,o+1);var m=l-o;if(m>0&&(this.glyphCount-=m,t.markupEnabled&&this.colors[this.colors.length-2]>this.glyphCount)){for(var w=this.colors[this.colors.length-1];this.colors[this.colors.length-2]>this.glyphCount;)this.colors.length-=2;this.colors[this.colors.length-2]=this.glyphCount,this.colors[this.colors.length-1]=w}}return 0===o?(this.glyphRunPool.free(e),this.runs.pop()):this.setLastGlyphXAdvance(t,e),h}}]),t}();e.GlyphLayout=h},9045:function(t,e,i){"use strict";var n=i(3913).default,r=i(4575).default;Object.defineProperty(e,"__esModule",{value:!0}),e.GlyphRun=void 0;var a=n((function t(){var e=this;r(this,t),this.glyphs=[],this.xAdvances=[],this.appendRun=function(t){e.glyphs.concat(t.glyphs),e.xAdvances.length||e.xAdvances.length--,e.xAdvances.concat(t.xAdvances)},this.reset=function(){e.glyphs.length=0,e.xAdvances.length=0}}));e.GlyphRun=a},6964:function(t,e,i){"use strict";var n=i(4575).default,r=i(3913).default;Object.defineProperty(e,"__esModule",{value:!0}),e.InputHandler=e.InputEvent=void 0;var a=i(8041),o=i(2283);!function(t){t.TouchStart="touchStart",t.TouchEnd="touchEnd",t.TouchMove="touchMove"}(e.InputEvent||(e.InputEvent={}));var s=function(){function t(e){var i=this;n(this,t),this.screenCoord=new o.Vector2,this.worldCoord=new o.Vector2,this.canvas=e,this.lastX=0,this.lastY=0,this.touched=!1;var r=this.emitter=new a.EventEmitter;this.mouseDownHandler=function(t){i.touched=!0,i.handleMove(t),r.emit("touchStart",i.getX(),i.getY())},this.mouseUpHandler=function(t){i.touched=!1,r.emit("touchEnd",i.getX(),i.getY())},this.mouseMoveHandler=function(t){i.handleMove(t),r.emit("touchMove",i.getX(),i.getY())},this.touchStartHandler=function(t){t.preventDefault();var e=t.touches[0];i.canvas.dispatchEvent(new MouseEvent("mousedown",{clientX:e.clientX,clientY:e.clientY}))},this.touchEndHandler=function(t){t.preventDefault(),i.canvas.dispatchEvent(new MouseEvent("mouseup"))},this.touchMoveHandler=function(t){t.preventDefault();var e=t.touches[0];i.canvas.dispatchEvent(new MouseEvent("mousemove",{clientX:e.clientX,clientY:e.clientY}))},this.canvas.addEventListener("mousedown",this.mouseDownHandler,!1),this.canvas.addEventListener("mouseup",this.mouseUpHandler,!1),this.canvas.addEventListener("mousemove",this.mouseMoveHandler,!1),this.canvas.addEventListener("touchstart",this.touchStartHandler,!1),this.canvas.addEventListener("touchend",this.touchEndHandler,!1),this.canvas.addEventListener("touchmove",this.touchMoveHandler,!1)}return r(t,[{key:"cleanup",value:function(){this.canvas.removeEventListener("mousedown",this.mouseDownHandler),this.canvas.removeEventListener("mouseup",this.mouseUpHandler),this.canvas.removeEventListener("mousemove",this.mouseMoveHandler),this.canvas.removeEventListener("touchstart",this.touchStartHandler),this.canvas.removeEventListener("touchend",this.touchEndHandler),this.canvas.removeEventListener("touchmove",this.touchMoveHandler)}},{key:"addEventListener",value:function(t,e){this.emitter.addListener(t,e)}},{key:"handleMove",value:function(t){var e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top;this.lastX=i,this.lastY=n}},{key:"getX",value:function(){return this.lastX}},{key:"getY",value:function(){return this.lastY}},{key:"isTouched",value:function(){return this.touched}},{key:"getTouchedWorldCoord",value:function(t){return this.screenCoord.set(this.getX(),this.getY()),t.unprojectVector2(this.worldCoord,this.screenCoord),this.worldCoord}}]),t}();e.InputHandler=s},4995:function(t,e,i){"use strict";var n=i(4575).default,r=i(3913).default;Object.defineProperty(e,"__esModule",{value:!0}),e.Matrix4=e.M33=e.M32=e.M31=e.M30=e.M23=e.M22=e.M21=e.M20=e.M13=e.M12=e.M11=e.M10=e.M03=e.M02=e.M01=e.M00=void 0;var a=i(7811);e.M00=0,e.M01=4,e.M02=8,e.M03=12,e.M10=1,e.M11=5,e.M12=9,e.M13=13,e.M20=2,e.M21=6,e.M22=10,e.M23=14,e.M30=3,e.M31=7,e.M32=11,e.M33=15;var o=function(){function t(){n(this,t),this.temp=new Float32Array(16),this.values=new Float32Array(16);var i=this.values;i[e.M00]=1,i[e.M11]=1,i[e.M22]=1,i[e.M33]=1}return r(t,[{key:"set",value:function(t){return this.values.set(t),this}},{key:"transpose",value:function(){var t=this.temp,i=this.values;return t[e.M00]=i[e.M00],t[e.M01]=i[e.M10],t[e.M02]=i[e.M20],t[e.M03]=i[e.M30],t[e.M10]=i[e.M01],t[e.M11]=i[e.M11],t[e.M12]=i[e.M21],t[e.M13]=i[e.M31],t[e.M20]=i[e.M02],t[e.M21]=i[e.M12],t[e.M22]=i[e.M22],t[e.M23]=i[e.M32],t[e.M30]=i[e.M03],t[e.M31]=i[e.M13],t[e.M32]=i[e.M23],t[e.M33]=i[e.M33],this.set(t)}},{key:"identity",value:function(){var t=this.values;return t[e.M00]=1,t[e.M01]=0,t[e.M02]=0,t[e.M03]=0,t[e.M10]=0,t[e.M11]=1,t[e.M12]=0,t[e.M13]=0,t[e.M20]=0,t[e.M21]=0,t[e.M22]=1,t[e.M23]=0,t[e.M30]=0,t[e.M31]=0,t[e.M32]=0,t[e.M33]=1,this}},{key:"invert",value:function(){var t=this.values,i=this.temp,n=t[e.M30]*t[e.M21]*t[e.M12]*t[e.M03]-t[e.M20]*t[e.M31]*t[e.M12]*t[e.M03]-t[e.M30]*t[e.M11]*t[e.M22]*t[e.M03]+t[e.M10]*t[e.M31]*t[e.M22]*t[e.M03]+t[e.M20]*t[e.M11]*t[e.M32]*t[e.M03]-t[e.M10]*t[e.M21]*t[e.M32]*t[e.M03]-t[e.M30]*t[e.M21]*t[e.M02]*t[e.M13]+t[e.M20]*t[e.M31]*t[e.M02]*t[e.M13]+t[e.M30]*t[e.M01]*t[e.M22]*t[e.M13]-t[e.M00]*t[e.M31]*t[e.M22]*t[e.M13]-t[e.M20]*t[e.M01]*t[e.M32]*t[e.M13]+t[e.M00]*t[e.M21]*t[e.M32]*t[e.M13]+t[e.M30]*t[e.M11]*t[e.M02]*t[e.M23]-t[e.M10]*t[e.M31]*t[e.M02]*t[e.M23]-t[e.M30]*t[e.M01]*t[e.M12]*t[e.M23]+t[e.M00]*t[e.M31]*t[e.M12]*t[e.M23]+t[e.M10]*t[e.M01]*t[e.M32]*t[e.M23]-t[e.M00]*t[e.M11]*t[e.M32]*t[e.M23]-t[e.M20]*t[e.M11]*t[e.M02]*t[e.M33]+t[e.M10]*t[e.M21]*t[e.M02]*t[e.M33]+t[e.M20]*t[e.M01]*t[e.M12]*t[e.M33]-t[e.M00]*t[e.M21]*t[e.M12]*t[e.M33]-t[e.M10]*t[e.M01]*t[e.M22]*t[e.M33]+t[e.M00]*t[e.M11]*t[e.M22]*t[e.M33];if(0===n)throw new Error("non-invertible matrix");var r=1/n;return i[e.M00]=t[e.M12]*t[e.M23]*t[e.M31]-t[e.M13]*t[e.M22]*t[e.M31]+t[e.M13]*t[e.M21]*t[e.M32]-t[e.M11]*t[e.M23]*t[e.M32]-t[e.M12]*t[e.M21]*t[e.M33]+t[e.M11]*t[e.M22]*t[e.M33],i[e.M01]=t[e.M03]*t[e.M22]*t[e.M31]-t[e.M02]*t[e.M23]*t[e.M31]-t[e.M03]*t[e.M21]*t[e.M32]+t[e.M01]*t[e.M23]*t[e.M32]+t[e.M02]*t[e.M21]*t[e.M33]-t[e.M01]*t[e.M22]*t[e.M33],i[e.M02]=t[e.M02]*t[e.M13]*t[e.M31]-t[e.M03]*t[e.M12]*t[e.M31]+t[e.M03]*t[e.M11]*t[e.M32]-t[e.M01]*t[e.M13]*t[e.M32]-t[e.M02]*t[e.M11]*t[e.M33]+t[e.M01]*t[e.M12]*t[e.M33],i[e.M03]=t[e.M03]*t[e.M12]*t[e.M21]-t[e.M02]*t[e.M13]*t[e.M21]-t[e.M03]*t[e.M11]*t[e.M22]+t[e.M01]*t[e.M13]*t[e.M22]+t[e.M02]*t[e.M11]*t[e.M23]-t[e.M01]*t[e.M12]*t[e.M23],i[e.M10]=t[e.M13]*t[e.M22]*t[e.M30]-t[e.M12]*t[e.M23]*t[e.M30]-t[e.M13]*t[e.M20]*t[e.M32]+t[e.M10]*t[e.M23]*t[e.M32]+t[e.M12]*t[e.M20]*t[e.M33]-t[e.M10]*t[e.M22]*t[e.M33],i[e.M11]=t[e.M02]*t[e.M23]*t[e.M30]-t[e.M03]*t[e.M22]*t[e.M30]+t[e.M03]*t[e.M20]*t[e.M32]-t[e.M00]*t[e.M23]*t[e.M32]-t[e.M02]*t[e.M20]*t[e.M33]+t[e.M00]*t[e.M22]*t[e.M33],i[e.M12]=t[e.M03]*t[e.M12]*t[e.M30]-t[e.M02]*t[e.M13]*t[e.M30]-t[e.M03]*t[e.M10]*t[e.M32]+t[e.M00]*t[e.M13]*t[e.M32]+t[e.M02]*t[e.M10]*t[e.M33]-t[e.M00]*t[e.M12]*t[e.M33],i[e.M13]=t[e.M02]*t[e.M13]*t[e.M20]-t[e.M03]*t[e.M12]*t[e.M20]+t[e.M03]*t[e.M10]*t[e.M22]-t[e.M00]*t[e.M13]*t[e.M22]-t[e.M02]*t[e.M10]*t[e.M23]+t[e.M00]*t[e.M12]*t[e.M23],i[e.M20]=t[e.M11]*t[e.M23]*t[e.M30]-t[e.M13]*t[e.M21]*t[e.M30]+t[e.M13]*t[e.M20]*t[e.M31]-t[e.M10]*t[e.M23]*t[e.M31]-t[e.M11]*t[e.M20]*t[e.M33]+t[e.M10]*t[e.M21]*t[e.M33],i[e.M21]=t[e.M03]*t[e.M21]*t[e.M30]-t[e.M01]*t[e.M23]*t[e.M30]-t[e.M03]*t[e.M20]*t[e.M31]+t[e.M00]*t[e.M23]*t[e.M31]+t[e.M01]*t[e.M20]*t[e.M33]-t[e.M00]*t[e.M21]*t[e.M33],i[e.M22]=t[e.M01]*t[e.M13]*t[e.M30]-t[e.M03]*t[e.M11]*t[e.M30]+t[e.M03]*t[e.M10]*t[e.M31]-t[e.M00]*t[e.M13]*t[e.M31]-t[e.M01]*t[e.M10]*t[e.M33]+t[e.M00]*t[e.M11]*t[e.M33],i[e.M23]=t[e.M03]*t[e.M11]*t[e.M20]-t[e.M01]*t[e.M13]*t[e.M20]-t[e.M03]*t[e.M10]*t[e.M21]+t[e.M00]*t[e.M13]*t[e.M21]+t[e.M01]*t[e.M10]*t[e.M23]-t[e.M00]*t[e.M11]*t[e.M23],i[e.M30]=t[e.M12]*t[e.M21]*t[e.M30]-t[e.M11]*t[e.M22]*t[e.M30]-t[e.M12]*t[e.M20]*t[e.M31]+t[e.M10]*t[e.M22]*t[e.M31]+t[e.M11]*t[e.M20]*t[e.M32]-t[e.M10]*t[e.M21]*t[e.M32],i[e.M31]=t[e.M01]*t[e.M22]*t[e.M30]-t[e.M02]*t[e.M21]*t[e.M30]+t[e.M02]*t[e.M20]*t[e.M31]-t[e.M00]*t[e.M22]*t[e.M31]-t[e.M01]*t[e.M20]*t[e.M32]+t[e.M00]*t[e.M21]*t[e.M32],i[e.M32]=t[e.M02]*t[e.M11]*t[e.M30]-t[e.M01]*t[e.M12]*t[e.M30]-t[e.M02]*t[e.M10]*t[e.M31]+t[e.M00]*t[e.M12]*t[e.M31]+t[e.M01]*t[e.M10]*t[e.M32]-t[e.M00]*t[e.M11]*t[e.M32],i[e.M33]=t[e.M01]*t[e.M12]*t[e.M20]-t[e.M02]*t[e.M11]*t[e.M20]+t[e.M02]*t[e.M10]*t[e.M21]-t[e.M00]*t[e.M12]*t[e.M21]-t[e.M01]*t[e.M10]*t[e.M22]+t[e.M00]*t[e.M11]*t[e.M22],t[e.M00]=i[e.M00]*r,t[e.M01]=i[e.M01]*r,t[e.M02]=i[e.M02]*r,t[e.M03]=i[e.M03]*r,t[e.M10]=i[e.M10]*r,t[e.M11]=i[e.M11]*r,t[e.M12]=i[e.M12]*r,t[e.M13]=i[e.M13]*r,t[e.M20]=i[e.M20]*r,t[e.M21]=i[e.M21]*r,t[e.M22]=i[e.M22]*r,t[e.M23]=i[e.M23]*r,t[e.M30]=i[e.M30]*r,t[e.M31]=i[e.M31]*r,t[e.M32]=i[e.M32]*r,t[e.M33]=i[e.M33]*r,this}},{key:"determinant",value:function(){var t=this.values;return t[e.M30]*t[e.M21]*t[e.M12]*t[e.M03]-t[e.M20]*t[e.M31]*t[e.M12]*t[e.M03]-t[e.M30]*t[e.M11]*t[e.M22]*t[e.M03]+t[e.M10]*t[e.M31]*t[e.M22]*t[e.M03]+t[e.M20]*t[e.M11]*t[e.M32]*t[e.M03]-t[e.M10]*t[e.M21]*t[e.M32]*t[e.M03]-t[e.M30]*t[e.M21]*t[e.M02]*t[e.M13]+t[e.M20]*t[e.M31]*t[e.M02]*t[e.M13]+t[e.M30]*t[e.M01]*t[e.M22]*t[e.M13]-t[e.M00]*t[e.M31]*t[e.M22]*t[e.M13]-t[e.M20]*t[e.M01]*t[e.M32]*t[e.M13]+t[e.M00]*t[e.M21]*t[e.M32]*t[e.M13]+t[e.M30]*t[e.M11]*t[e.M02]*t[e.M23]-t[e.M10]*t[e.M31]*t[e.M02]*t[e.M23]-t[e.M30]*t[e.M01]*t[e.M12]*t[e.M23]+t[e.M00]*t[e.M31]*t[e.M12]*t[e.M23]+t[e.M10]*t[e.M01]*t[e.M32]*t[e.M23]-t[e.M00]*t[e.M11]*t[e.M32]*t[e.M23]-t[e.M20]*t[e.M11]*t[e.M02]*t[e.M33]+t[e.M10]*t[e.M21]*t[e.M02]*t[e.M33]+t[e.M20]*t[e.M01]*t[e.M12]*t[e.M33]-t[e.M00]*t[e.M21]*t[e.M12]*t[e.M33]-t[e.M10]*t[e.M01]*t[e.M22]*t[e.M33]+t[e.M00]*t[e.M11]*t[e.M22]*t[e.M33]}},{key:"translate",value:function(t,i,n){var r=this.values;return r[e.M03]+=t,r[e.M13]+=i,r[e.M23]+=n,this}},{key:"copy",value:function(){return(new t).set(this.values)}},{key:"projection",value:function(t,i,n,r){this.identity();var a=1/Math.tan(n*(Math.PI/180)/2),o=(i+t)/(t-i),s=2*i*t/(t-i),h=this.values;return h[e.M00]=a/r,h[e.M10]=0,h[e.M20]=0,h[e.M30]=0,h[e.M01]=0,h[e.M11]=a,h[e.M21]=0,h[e.M31]=0,h[e.M02]=0,h[e.M12]=0,h[e.M22]=o,h[e.M32]=-1,h[e.M03]=0,h[e.M13]=0,h[e.M23]=s,h[e.M33]=0,this}},{key:"ortho2d",value:function(t,e,i,n){return this.ortho(t,t+i,e,e+n,0,1)}},{key:"ortho",value:function(t,i,n,r,a,o){this.identity();var s=2/(i-t),h=2/(r-n),l=-2/(o-a),u=-(i+t)/(i-t),c=-(r+n)/(r-n),d=-(o+a)/(o-a),f=this.values;return f[e.M00]=s,f[e.M10]=0,f[e.M20]=0,f[e.M30]=0,f[e.M01]=0,f[e.M11]=h,f[e.M21]=0,f[e.M31]=0,f[e.M02]=0,f[e.M12]=0,f[e.M22]=l,f[e.M32]=0,f[e.M03]=u,f[e.M13]=c,f[e.M23]=d,f[e.M33]=1,this}},{key:"multiply",value:function(t){var i=this.temp,n=this.values,r=t.values;return i[e.M00]=n[e.M00]*r[e.M00]+n[e.M01]*r[e.M10]+n[e.M02]*r[e.M20]+n[e.M03]*r[e.M30],i[e.M01]=n[e.M00]*r[e.M01]+n[e.M01]*r[e.M11]+n[e.M02]*r[e.M21]+n[e.M03]*r[e.M31],i[e.M02]=n[e.M00]*r[e.M02]+n[e.M01]*r[e.M12]+n[e.M02]*r[e.M22]+n[e.M03]*r[e.M32],i[e.M03]=n[e.M00]*r[e.M03]+n[e.M01]*r[e.M13]+n[e.M02]*r[e.M23]+n[e.M03]*r[e.M33],i[e.M10]=n[e.M10]*r[e.M00]+n[e.M11]*r[e.M10]+n[e.M12]*r[e.M20]+n[e.M13]*r[e.M30],i[e.M11]=n[e.M10]*r[e.M01]+n[e.M11]*r[e.M11]+n[e.M12]*r[e.M21]+n[e.M13]*r[e.M31],i[e.M12]=n[e.M10]*r[e.M02]+n[e.M11]*r[e.M12]+n[e.M12]*r[e.M22]+n[e.M13]*r[e.M32],i[e.M13]=n[e.M10]*r[e.M03]+n[e.M11]*r[e.M13]+n[e.M12]*r[e.M23]+n[e.M13]*r[e.M33],i[e.M20]=n[e.M20]*r[e.M00]+n[e.M21]*r[e.M10]+n[e.M22]*r[e.M20]+n[e.M23]*r[e.M30],i[e.M21]=n[e.M20]*r[e.M01]+n[e.M21]*r[e.M11]+n[e.M22]*r[e.M21]+n[e.M23]*r[e.M31],i[e.M22]=n[e.M20]*r[e.M02]+n[e.M21]*r[e.M12]+n[e.M22]*r[e.M22]+n[e.M23]*r[e.M32],i[e.M23]=n[e.M20]*r[e.M03]+n[e.M21]*r[e.M13]+n[e.M22]*r[e.M23]+n[e.M23]*r[e.M33],i[e.M30]=n[e.M30]*r[e.M00]+n[e.M31]*r[e.M10]+n[e.M32]*r[e.M20]+n[e.M33]*r[e.M30],i[e.M31]=n[e.M30]*r[e.M01]+n[e.M31]*r[e.M11]+n[e.M32]*r[e.M21]+n[e.M33]*r[e.M31],i[e.M32]=n[e.M30]*r[e.M02]+n[e.M31]*r[e.M12]+n[e.M32]*r[e.M22]+n[e.M33]*r[e.M32],i[e.M33]=n[e.M30]*r[e.M03]+n[e.M31]*r[e.M13]+n[e.M32]*r[e.M23]+n[e.M33]*r[e.M33],this.set(this.temp)}},{key:"multiplyLeft",value:function(t){var i=this.temp,n=this.values,r=t.values;return i[e.M00]=r[e.M00]*n[e.M00]+r[e.M01]*n[e.M10]+r[e.M02]*n[e.M20]+r[e.M03]*n[e.M30],i[e.M01]=r[e.M00]*n[e.M01]+r[e.M01]*n[e.M11]+r[e.M02]*n[e.M21]+r[e.M03]*n[e.M31],i[e.M02]=r[e.M00]*n[e.M02]+r[e.M01]*n[e.M12]+r[e.M02]*n[e.M22]+r[e.M03]*n[e.M32],i[e.M03]=r[e.M00]*n[e.M03]+r[e.M01]*n[e.M13]+r[e.M02]*n[e.M23]+r[e.M03]*n[e.M33],i[e.M10]=r[e.M10]*n[e.M00]+r[e.M11]*n[e.M10]+r[e.M12]*n[e.M20]+r[e.M13]*n[e.M30],i[e.M11]=r[e.M10]*n[e.M01]+r[e.M11]*n[e.M11]+r[e.M12]*n[e.M21]+r[e.M13]*n[e.M31],i[e.M12]=r[e.M10]*n[e.M02]+r[e.M11]*n[e.M12]+r[e.M12]*n[e.M22]+r[e.M13]*n[e.M32],i[e.M13]=r[e.M10]*n[e.M03]+r[e.M11]*n[e.M13]+r[e.M12]*n[e.M23]+r[e.M13]*n[e.M33],i[e.M20]=r[e.M20]*n[e.M00]+r[e.M21]*n[e.M10]+r[e.M22]*n[e.M20]+r[e.M23]*n[e.M30],i[e.M21]=r[e.M20]*n[e.M01]+r[e.M21]*n[e.M11]+r[e.M22]*n[e.M21]+r[e.M23]*n[e.M31],i[e.M22]=r[e.M20]*n[e.M02]+r[e.M21]*n[e.M12]+r[e.M22]*n[e.M22]+r[e.M23]*n[e.M32],i[e.M23]=r[e.M20]*n[e.M03]+r[e.M21]*n[e.M13]+r[e.M22]*n[e.M23]+r[e.M23]*n[e.M33],i[e.M30]=r[e.M30]*n[e.M00]+r[e.M31]*n[e.M10]+r[e.M32]*n[e.M20]+r[e.M33]*n[e.M30],i[e.M31]=r[e.M30]*n[e.M01]+r[e.M31]*n[e.M11]+r[e.M32]*n[e.M21]+r[e.M33]*n[e.M31],i[e.M32]=r[e.M30]*n[e.M02]+r[e.M31]*n[e.M12]+r[e.M32]*n[e.M22]+r[e.M33]*n[e.M32],i[e.M33]=r[e.M30]*n[e.M03]+r[e.M31]*n[e.M13]+r[e.M32]*n[e.M23]+r[e.M33]*n[e.M33],this.set(this.temp)}},{key:"lookAt",value:function(i,n,r){t.initTemps();var a=t.xAxis,o=t.yAxis,s=t.zAxis;s.setFrom(n).normalize(),a.setFrom(n).normalize(),a.cross(r).normalize(),o.setFrom(a).cross(s).normalize(),this.identity();var h=this.values;return h[e.M00]=a.x,h[e.M01]=a.y,h[e.M02]=a.z,h[e.M10]=o.x,h[e.M11]=o.y,h[e.M12]=o.z,h[e.M20]=-s.x,h[e.M21]=-s.y,h[e.M22]=-s.z,t.tmpMatrix.identity(),t.tmpMatrix.values[e.M03]=-i.x,t.tmpMatrix.values[e.M13]=-i.y,t.tmpMatrix.values[e.M23]=-i.z,this.multiply(t.tmpMatrix),this}}],[{key:"initTemps",value:function(){null===t.xAxis&&(t.xAxis=new a.Vector3),null===t.yAxis&&(t.yAxis=new a.Vector3),null===t.zAxis&&(t.zAxis=new a.Vector3)}}]),t}();e.Matrix4=o,o.xAxis=null,o.yAxis=null,o.zAxis=null,o.tmpMatrix=new o},1514:function(t,e,i){"use strict";var n=i(2205).default,r=i(9842).default,a=i(4575).default,o=i(3913).default;Object.defineProperty(e,"__esModule",{value:!0}),e.Color2Attribute=e.ColorAttribute=e.TexCoordAttribute=e.Position3Attribute=e.Position2Attribute=e.VertexAttribute=e.VertexAttributeType=e.Mesh=void 0;var s,h=i(1858),l=function(){function t(e,i,n,r){a(this,t),this.attributes=i,this.verticesLength=0,this.dirtyVertices=!1,this.indicesLength=0,this.dirtyIndices=!1,this.elementsPerVertex=0,this.context=e,this.elementsPerVertex=0;for(var o=0;o<i.length;o++)this.elementsPerVertex+=i[o].numElements;this.vertices=new Float32Array(n*this.elementsPerVertex),this.indices=new Uint16Array(r)}return o(t,[{key:"getAttributes",value:function(){return this.attributes}},{key:"maxVertices",value:function(){return this.vertices.length/this.elementsPerVertex}},{key:"numVertices",value:function(){return this.verticesLength/this.elementsPerVertex}},{key:"setVerticesLength",value:function(t){this.dirtyVertices=!0,this.verticesLength=t}},{key:"getVertices",value:function(){return this.vertices}},{key:"maxIndices",value:function(){return this.indices.length}},{key:"numIndices",value:function(){return this.indicesLength}},{key:"setIndicesLength",value:function(t){this.dirtyIndices=!0,this.indicesLength=t}},{key:"getIndices",value:function(){return this.indices}},{key:"getVertexSizeInFloats",value:function(){for(var t=0,e=0;e<this.attributes.length;e++){t+=this.attributes[e].numElements}return t}},{key:"setVertices",value:function(t){if(this.dirtyVertices=!0,t.length>this.vertices.length)throw Error("Mesh can't store more than "+this.maxVertices()+" vertices");this.vertices.set(t,0),this.verticesLength=t.length}},{key:"setIndices",value:function(t){if(this.dirtyIndices=!0,t.length>this.indices.length)throw Error("Mesh can't store more than "+this.maxIndices()+" indices");this.indices.set(t,0),this.indicesLength=t.length}},{key:"draw",value:function(t,e){this.drawWithOffset(t,e,0,this.indicesLength>0?this.indicesLength:this.verticesLength/this.elementsPerVertex)}},{key:"drawWithOffset",value:function(t,e,i,n){var r=this.context;(this.dirtyVertices||this.dirtyIndices)&&this.update(),this.bind(t),this.indicesLength>0?r.drawElements(e,n,r.UNSIGNED_SHORT,2*i):r.drawArrays(e,i,n),this.unbind(t)}},{key:"bind",value:function(t){var e=this.context;e.bindBuffer(e.ARRAY_BUFFER,this.verticesBuffer);for(var i=0,n=0;n<this.attributes.length;n++){var r=this.attributes[n],a=t.getAttributeLocation(r.name);e.enableVertexAttribArray(a),e.vertexAttribPointer(a,r.numElements,e.FLOAT,!1,4*this.elementsPerVertex,4*i),i+=r.numElements}this.indicesLength>0&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indicesBuffer)}},{key:"unbind",value:function(t){for(var e=this.context,i=0;i<this.attributes.length;i++){var n=this.attributes[i],r=t.getAttributeLocation(n.name);e.disableVertexAttribArray(r)}e.bindBuffer(e.ARRAY_BUFFER,null),this.indicesLength>0&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}},{key:"update",value:function(){var t=this.context;this.dirtyVertices&&(this.verticesBuffer||(this.verticesBuffer=t.createBuffer()),t.bindBuffer(t.ARRAY_BUFFER,this.verticesBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices.subarray(0,this.verticesLength),t.DYNAMIC_DRAW),this.dirtyVertices=!1),this.dirtyIndices&&(this.indicesBuffer||(this.indicesBuffer=t.createBuffer()),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indicesBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices.subarray(0,this.indicesLength),t.DYNAMIC_DRAW),this.dirtyIndices=!1)}},{key:"restore",value:function(){this.verticesBuffer=null,this.indicesBuffer=null,this.update()}},{key:"dispose",value:function(){var t=this.context;t.deleteBuffer(this.verticesBuffer),t.deleteBuffer(this.indicesBuffer)}}]),t}();e.Mesh=l,function(t){t[t.Float=0]="Float"}(s=e.VertexAttributeType||(e.VertexAttributeType={}));var u=o((function t(e,i,n){a(this,t),this.name=e,this.type=i,this.numElements=n}));e.VertexAttribute=u;var c=function(t){n(i,t);var e=r(i);function i(){return a(this,i),e.call(this,h.Shader.POSITION,s.Float,2)}return o(i)}(u);e.Position2Attribute=c;var d=function(t){n(i,t);var e=r(i);function i(){return a(this,i),e.call(this,h.Shader.POSITION,s.Float,3)}return o(i)}(u);e.Position3Attribute=d;var f=function(t){n(i,t);var e=r(i);function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return a(this,i),e.call(this,h.Shader.TEXCOORDS+(0===t?"":t),s.Float,2)}return o(i)}(u);e.TexCoordAttribute=f;var p=function(t){n(i,t);var e=r(i);function i(){return a(this,i),e.call(this,h.Shader.COLOR,s.Float,4)}return o(i)}(u);e.ColorAttribute=p;var v=function(t){n(i,t);var e=r(i);function i(){return a(this,i),e.call(this,h.Shader.COLOR2,s.Float,4)}return o(i)}(u);e.Color2Attribute=v},9699:function(t,e,i){"use strict";var n=i(4575).default,r=i(3913).default;Object.defineProperty(e,"__esModule",{value:!0}),e.NumberUtil=void 0;var a=new Int8Array(4),o=new Int32Array(a.buffer,0,1),s=new Float32Array(a.buffer,0,1),h=function(){function t(){n(this,t)}return r(t,null,[{key:"intBitsToFloat",value:function(t){return o[0]=t,s[0]}},{key:"floatToIntBits",value:function(t){return s[0]=t,o[0]}},{key:"intToFloatColor",value:function(e){return t.intBitsToFloat(4278190079&e)}},{key:"colorToFloat",value:function(e,i,n,r){var a=e<<24|i<<16|n<<8|r;return t.intToFloatColor(a)}},{key:"isPowerOfTwo",value:function(t){return 0===(t&t-1)}},{key:"nextPowerOfTwo",value:function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1}}]),t}();e.NumberUtil=h},1251:function(t,e,i){"use strict";var n=i(4575).default,r=i(3913).default;Object.defineProperty(e,"__esModule",{value:!0}),e.PolygonBatch=void 0;var a=i(8606),o=i(1514),s=i(1858),h=[0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0],l=new a.Color(1,1,1,1),u=function(){function t(e){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10920;if(n(this,t),this.isDrawing=!1,this.shader=null,this.lastTexture=null,this.verticesLength=0,this.indicesLength=0,this.projectionValues=new Float32Array(16),this.color=l,this.twoColorTint=!0,this.yDown=!1,r>10920)throw new Error("Can't have more than 10920 triangles per batch: "+r);this.context=e;var a=i?[new o.Position2Attribute,new o.ColorAttribute,new o.TexCoordAttribute,new o.Color2Attribute]:[new o.Position2Attribute,new o.ColorAttribute,new o.TexCoordAttribute];this.mesh=new o.Mesh(e,a,r,3*r),this.shader=s.Shader.newTwoColoredTextured(e);var h=this.context;this.srcColorBlend=h.SRC_ALPHA,this.srcAlphaBlend=h.ONE,this.dstBlend=h.ONE_MINUS_SRC_ALPHA,this.twoColorTint=i}return r(t,[{key:"setColor",value:function(t){this.color=t}},{key:"setShader",value:function(t){this.shader.dispose(),this.shader=t}},{key:"setProjection",value:function(t){this.projectionValues=t}},{key:"begin",value:function(){if(this.isDrawing)throw new Error("PolygonBatch is already drawing. Call PolygonBatch.end() before calling PolygonBatch.begin()");this.drawCalls=0;var t=this.shader;this.lastTexture=null,this.isDrawing=!0,t.bind(),t.setUniform4x4f(s.Shader.MVP_MATRIX,this.projectionValues),t.setUniformi("u_texture",0);var e=this.context;e.enable(e.BLEND),e.blendFuncSeparate(this.srcColorBlend,this.dstBlend,this.srcAlphaBlend,this.dstBlend)}},{key:"setBlendMode",value:function(t,e,i){this.srcColorBlend===t&&this.srcAlphaBlend===e&&this.dstBlend===i||(this.srcColorBlend=t,this.srcAlphaBlend=e,this.dstBlend=i,this.isDrawing&&(this.flush(),this.context.blendFuncSeparate(t,i,e,i)))}},{key:"drawVerticesWithOffset",value:function(e,i,n,r){for(var a=[],o=0;o<r;o++)a[o]=i[o+n];this.drawVertices(e,a,t.QUAD_TRIANGLES)}},{key:"drawVertices",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.QUAD_TRIANGLES;e!==this.lastTexture?(this.flush(),this.lastTexture=e):(this.verticesLength+i.length>this.mesh.getVertices().length||this.indicesLength+n.length>this.mesh.getIndices().length)&&this.flush();var r=this.mesh.numVertices();this.mesh.getVertices().set(i,this.verticesLength),this.verticesLength+=i.length,this.mesh.setVerticesLength(this.verticesLength);for(var a=this.mesh.getIndices(),o=this.indicesLength,s=0;s<n.length;o++,s++)a[o]=n[s]+r;this.indicesLength+=n.length,this.mesh.setIndicesLength(this.indicesLength)}},{key:"flush",value:function(){0!==this.verticesLength&&(this.lastTexture.bind(),this.mesh.draw(this.shader,this.context.TRIANGLES),this.verticesLength=0,this.indicesLength=0,this.mesh.setVerticesLength(0),this.mesh.setIndicesLength(0),this.drawCalls++)}},{key:"end",value:function(){if(!this.isDrawing)throw new Error("PolygonBatch is not drawing. Call PolygonBatch.begin() before calling PolygonBatch.end()");(this.verticesLength>0||this.indicesLength>0)&&this.flush(),this.shader.unbind(),this.lastTexture=null,this.isDrawing=!1,t.totalDrawCalls+=this.drawCalls;var e=this.context;e.disable(e.BLEND)}},{key:"getDrawCalls",value:function(){return this.drawCalls}},{key:"dispose",value:function(){this.mesh.dispose()}},{key:"setYDown",value:function(t){this.yDown=t}},{key:"draw",value:function(e,i,n,r,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:1,d=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,f=arguments.length>11&&void 0!==arguments[11]?arguments[11]:1,p=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,v=arguments.length>13&&void 0!==arguments[13]?arguments[13]:0,g=arguments.length>14&&void 0!==arguments[14]&&arguments[14],y=this.color;if(this.yDown){var m=f;f=v,v=m}i=i||0,n=n||0;var w=-o,M=(r=0===r?r:r||e.width)-o,b=r-o,x=-o,T=-s,S=-s,k=(a=0===a?a:a||e.height)-s,_=a-s;if(1!==u&&(w*=u,M*=u,b*=u,x*=u),1!==c&&(T*=c,S*=c,k*=c,_*=c),0!==l){var I=Math.cos(l),E=Math.sin(l),R=I*w-E*T,A=E*w+I*T,P=I*M-E*S,O=E*M+I*S,D=I*b-E*k,L=E*b+I*k,C=I*x-E*_,B=E*x+I*_;w=R,M=P,b=D,x=C,T=A,S=O,k=L,_=B}w+=i+o,M+=i+o,b+=i+o,x+=i+o,T+=n+s,S+=n+s,k+=n+s,_+=n+s;var z=d,H=f,V=p,F=v,N=V,G=H,j=z,W=F;g&&(this.yDown?(z=d,H=v,V=p,F=f,N=d,G=f,j=p,W=v):(z=p,H=f,V=d,F=v,N=p,G=v,j=d,W=f));var U=0;h[U++]=w,h[U++]=T,h[U++]=y.r,h[U++]=y.g,h[U++]=y.b,h[U++]=y.a,h[U++]=z,h[U++]=H,this.twoColorTint&&(h[U++]=0,h[U++]=0,h[U++]=0,h[U++]=0),h[U++]=M,h[U++]=S,h[U++]=y.r,h[U++]=y.g,h[U++]=y.b,h[U++]=y.a,h[U++]=N,h[U++]=G,this.twoColorTint&&(h[U++]=0,h[U++]=0,h[U++]=0,h[U++]=0),h[U++]=b,h[U++]=k,h[U++]=y.r,h[U++]=y.g,h[U++]=y.b,h[U++]=y.a,h[U++]=V,h[U++]=F,this.twoColorTint&&(h[U++]=0,h[U++]=0,h[U++]=0,h[U++]=0),h[U++]=x,h[U++]=_,h[U++]=y.r,h[U++]=y.g,h[U++]=y.b,h[U++]=y.a,h[U++]=j,h[U++]=W,this.twoColorTint&&(h[U++]=0,h[U++]=0,h[U++]=0,h[U]=0),this.drawVertices(e,h,t.QUAD_TRIANGLES)}}],[{key:"resetTotalDrawCalls",value:function(){t.totalDrawCalls=0}}]),t}();e.PolygonBatch=u,u.QUAD_TRIANGLES=[0,1,2,2,3,0],u.totalDrawCalls=0},1858:function(t,e,i){"use strict";var n=i(4575).default,r=i(3913).default;Object.defineProperty(e,"__esModule",{value:!0}),e.Shader=void 0;var a=function(){function t(e,i,r){n(this,t),this.vertexShader=i,this.fragmentShader=r,this.vs=null,this.fs=null,this.program=null,this.tmp2x2=new Float32Array(4),this.tmp3x3=new Float32Array(9),this.tmp4x4=new Float32Array(16),this.vsSource=i,this.fsSource=r,this.context=e,this.compile()}return r(t,[{key:"getProgram",value:function(){return this.program}},{key:"getVertexShader",value:function(){return this.vertexShader}},{key:"getFragmentShader",value:function(){return this.fragmentShader}},{key:"getVertexShaderSource",value:function(){return this.vsSource}},{key:"getFragmentSource",value:function(){return this.fsSource}},{key:"compile",value:function(){var t=this.context;try{this.vs=this.compileShader(t.VERTEX_SHADER,this.vertexShader),this.fs=this.compileShader(t.FRAGMENT_SHADER,this.fragmentShader),this.program=this.compileProgram(this.vs,this.fs)}catch(e){throw this.dispose(),e}}},{key:"compileShader",value:function(t,e){var i=this.context,n=i.createShader(t);if(i.shaderSource(n,e),i.compileShader(n),!i.getShaderParameter(n,i.COMPILE_STATUS)){var r="Couldn't compile shader: "+i.getShaderInfoLog(n);if(i.deleteShader(n),!i.isContextLost())throw new Error(r)}return n}},{key:"compileProgram",value:function(t,e){var i=this.context,n=i.createProgram();if(i.attachShader(n,t),i.attachShader(n,e),i.linkProgram(n),!i.getProgramParameter(n,i.LINK_STATUS)){var r="Couldn't compile shader program: "+i.getProgramInfoLog(n);if(i.deleteProgram(n),!i.isContextLost())throw new Error(r)}return n}},{key:"restore",value:function(){this.compile()}},{key:"bind",value:function(){this.context.useProgram(this.program)}},{key:"unbind",value:function(){this.context.useProgram(null)}},{key:"setUniformi",value:function(t,e){this.context.uniform1i(this.getUniformLocation(t),e)}},{key:"setUniformf",value:function(t,e){this.context.uniform1f(this.getUniformLocation(t),e)}},{key:"setUniform2f",value:function(t,e,i){this.context.uniform2f(this.getUniformLocation(t),e,i)}},{key:"setUniform3f",value:function(t,e,i,n){this.context.uniform3f(this.getUniformLocation(t),e,i,n)}},{key:"setUniform4f",value:function(t,e,i,n,r){this.context.uniform4f(this.getUniformLocation(t),e,i,n,r)}},{key:"setUniform2x2f",value:function(t,e){var i=this.context;this.tmp2x2.set(e),i.uniformMatrix2fv(this.getUniformLocation(t),!1,this.tmp2x2)}},{key:"setUniform3x3f",value:function(t,e){var i=this.context;this.tmp3x3.set(e),i.uniformMatrix3fv(this.getUniformLocation(t),!1,this.tmp3x3)}},{key:"setUniform4x4f",value:function(t,e){var i=this.context;this.tmp4x4.set(e),i.uniformMatrix4fv(this.getUniformLocation(t),!1,this.tmp4x4)}},{key:"getUniformLocation",value:function(t){var e=this.context,i=e.getUniformLocation(this.program,t);if(!i&&!e.isContextLost())throw new Error("Couldn't find location for uniform ".concat(t));return i}},{key:"getAttributeLocation",value:function(t){var e=this.context,i=e.getAttribLocation(this.program,t);if(-1===i&&!e.isContextLost())throw new Error("Couldn't find location for attribute ".concat(t));return i}},{key:"dispose",value:function(){var t=this.context;this.vs&&(t.deleteShader(this.vs),this.vs=null),this.fs&&(t.deleteShader(this.fs),this.fs=null),this.program&&(t.deleteProgram(this.program),this.program=null)}}],[{key:"newColoredTextured",value:function(e){return new t(e,"\n         attribute vec4 ".concat(t.POSITION,";\n         attribute vec4 ").concat(t.COLOR,";\n         attribute vec2 ").concat(t.TEXCOORDS,";\n         uniform mat4 ").concat(t.MVP_MATRIX,";\n         varying vec4 v_color;\n         varying vec2 v_texCoords;\n \n         void main () {\n           v_color = ").concat(t.COLOR,";\n           v_texCoords = ").concat(t.TEXCOORDS,";\n           gl_Position = ").concat(t.MVP_MATRIX," * ").concat(t.POSITION,";\n         }\n       "),"\n         #ifdef GL_ES\n           #define LOWP lowp\n           precision mediump float;\n         #else\n           #define LOWP\n         #endif\n         varying LOWP vec4 v_color;\n         varying vec2 v_texCoords;\n         uniform sampler2D u_texture;\n \n         void main () {\n           gl_FragColor = v_color * texture2D(u_texture, v_texCoords);\n         }\n       ")}},{key:"newTwoColoredTextured",value:function(e){return new t(e,"\n         attribute vec4 ".concat(t.POSITION,";\n         attribute vec4 ").concat(t.COLOR,";\n         attribute vec4 ").concat(t.COLOR2,";\n         attribute vec2 ").concat(t.TEXCOORDS,";\n         uniform mat4 ").concat(t.MVP_MATRIX,";\n         varying vec4 v_light;\n         varying vec4 v_dark;\n         varying vec2 v_texCoords;\n \n         void main () {\n           v_light = ").concat(t.COLOR,";\n           v_dark = ").concat(t.COLOR2,";\n           v_texCoords = ").concat(t.TEXCOORDS,";\n           gl_Position = ").concat(t.MVP_MATRIX," * ").concat(t.POSITION,";\n         }\n       "),"\n         #ifdef GL_ES\n           #define LOWP lowp\n           precision mediump float;\n         #else\n           #define LOWP\n         #endif\n         varying LOWP vec4 v_light;\n         varying LOWP vec4 v_dark;\n         varying vec2 v_texCoords;\n         uniform sampler2D u_texture;\n \n         void main () {\n           vec4 texColor = texture2D(u_texture, v_texCoords);\n           gl_FragColor.a = texColor.a * v_light.a;\n           gl_FragColor.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\n         }\n       ")}},{key:"newColored",value:function(e){return new t(e,"\n         attribute vec4 ".concat(t.POSITION,";\n         attribute vec4 ").concat(t.COLOR,";\n         uniform mat4 ").concat(t.MVP_MATRIX,";\n         varying vec4 v_color;\n \n         void main () {\n           v_color = ").concat(t.COLOR,";\n           gl_Position = ").concat(t.MVP_MATRIX," * ").concat(t.POSITION,";\n         }\n       "),"\n         #ifdef GL_ES\n           #define LOWP lowp\n           precision mediump float;\n         #else\n           #define LOWP\n         #endif\n         varying LOWP vec4 v_color;\n \n         void main () {\n           gl_FragColor = v_color;\n         }\n       ")}}]),t}();e.Shader=a,a.MVP_MATRIX="u_projTrans",a.POSITION="a_position",a.COLOR="a_color",a.COLOR2="a_color2",a.TEXCOORDS="a_texCoords",a.SAMPLER="u_texture"},2987:function(t,e,i){"use strict";var n=i(4575).default,r=i(3913).default;Object.defineProperty(e,"__esModule",{value:!0}),e.ShapeRenderer=e.ShapeType=void 0;var a,o=i(1514),s=i(1858),h=i(8606),l=i(2283);!function(t){t[t.Point=0]="Point",t[t.Line=1]="Line",t[t.Filled=4]="Filled"}(a=e.ShapeType||(e.ShapeType={}));var u=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10920;if(n(this,t),this.isDrawing=!1,this.shapeType=a.Filled,this.color=new h.Color(1,1,1,1),this.vertexIndex=0,this.tmp=new l.Vector2,this.projectionValues=new Float32Array(16),i>10920)throw new Error("Can't have more than 10920 triangles per batch: "+i);this.context=e,this.mesh=new o.Mesh(e,[new o.Position2Attribute,new o.ColorAttribute],i,0);var r=this.context;this.srcColorBlend=r.SRC_ALPHA,this.srcAlphaBlend=r.ONE,this.dstBlend=r.ONE_MINUS_SRC_ALPHA,this.shader=s.Shader.newColored(r)}return r(t,[{key:"setProjection",value:function(t){this.projectionValues=t}},{key:"begin",value:function(){if(this.isDrawing)throw new Error("ShapeRenderer.begin() has already been called");this.vertexIndex=0,this.isDrawing=!0,this.shader.bind(),this.shader.setUniform4x4f(s.Shader.MVP_MATRIX,this.projectionValues);var t=this.context;t.enable(t.BLEND),t.blendFuncSeparate(this.srcColorBlend,this.dstBlend,this.srcAlphaBlend,this.dstBlend)}},{key:"setBlendMode",value:function(t,e,i){(this.srcColorBlend=t,this.srcAlphaBlend=e,this.dstBlend=i,this.isDrawing)&&(this.flush(),this.context.blendFuncSeparate(t,i,e,i))}},{key:"setColor",value:function(t){this.color.setFromColor(t)}},{key:"setColorWith",value:function(t,e,i,n){this.color.set(t,e,i,n)}},{key:"point",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.check(a.Point,1),null===i&&(i=this.color),this.vertex(t,e,i)}},{key:"line",value:function(t,e,i,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.check(a.Line,2),null===r&&(r=this.color),this.vertex(t,e,r),this.vertex(i,n,r)}},{key:"triangle",value:function(t,e,i,n,r,o,s){var h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null;this.check(t?a.Filled:a.Line,3),null===h&&(h=this.color),null===l&&(l=this.color),null===u&&(u=this.color),t?(this.vertex(e,i,h),this.vertex(n,r,l),this.vertex(o,s,u)):(this.vertex(e,i,h),this.vertex(n,r,l),this.vertex(n,r,h),this.vertex(o,s,l),this.vertex(o,s,h),this.vertex(e,i,l))}},{key:"quad",value:function(t,e,i,n,r,o,s,h,l){var u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,d=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,f=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null;this.check(t?a.Filled:a.Line,3),null===u&&(u=this.color),null===c&&(c=this.color),null===d&&(d=this.color),null===f&&(f=this.color),t?(this.vertex(e,i,u),this.vertex(n,r,c),this.vertex(o,s,d),this.vertex(o,s,d),this.vertex(h,l,f),this.vertex(e,i,u)):(this.vertex(e,i,u),this.vertex(n,r,c),this.vertex(n,r,c),this.vertex(o,s,d),this.vertex(o,s,d),this.vertex(h,l,f),this.vertex(h,l,f),this.vertex(e,i,u))}},{key:"rect",value:function(t,e,i,n,r){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;this.quad(t,e,i,e+n,i,e+n,i+r,e,i+r,a,a,a,a)}},{key:"rectLine",value:function(t,e,i,n,r,o){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.check(t?a.Filled:a.Line,8),null===s&&(s=this.color);var h=this.tmp.set(r-i,e-n);h.nor(),o*=.5;var l=h.x*o,u=h.y*o;t?(this.vertex(e+l,i+u,s),this.vertex(e-l,i-u,s),this.vertex(n+l,r+u,s),this.vertex(n-l,r-u,s),this.vertex(n+l,r+u,s),this.vertex(e-l,i-u,s)):(this.vertex(e+l,i+u,s),this.vertex(e-l,i-u,s),this.vertex(n+l,r+u,s),this.vertex(n-l,r-u,s),this.vertex(n+l,r+u,s),this.vertex(e+l,i+u,s),this.vertex(n-l,r-u,s),this.vertex(e-l,i-u,s))}},{key:"x",value:function(t,e,i){this.line(t-i,e-i,t+i,e+i),this.line(t-i,e+i,t+i,e-i)}},{key:"polygon",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(i<3)throw new Error("Polygon must contain at least 3 vertices");this.check(a.Line,2*i),null===n&&(n=this.color),i<<=1;for(var r=t[e<<=1],o=t[e+1],s=e+i,h=e,l=e+i-2;h<l;h+=2){var u=t[h],c=t[h+1],d=0,f=0;h+2>=s?(d=r,f=o):(d=t[h+2],f=t[h+3]),this.vertex(u,c,n),this.vertex(d,f,n)}}},{key:"circle",value:function(t,e,i,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(0===o&&(o=Math.max(1,6*h.MathUtils.cbrt(n)|0)),o<=0)throw new Error("segments must be > 0.");null===r&&(r=this.color);var s=2*h.MathUtils.PI/o,l=Math.cos(s),u=Math.sin(s),c=n,d=0;if(t){this.check(a.Filled,3*o+3),o--;for(var f=0;f<o;f++){this.vertex(e,i,r),this.vertex(e+c,i+d,r);var p=c;c=l*c-u*d,d=u*p+l*d,this.vertex(e+c,i+d,r)}this.vertex(e,i,r),this.vertex(e+c,i+d,r)}else{this.check(a.Line,2*o+2);for(var v=0;v<o;v++){this.vertex(e+c,i+d,r);var g=c;c=l*c-u*d,d=u*g+l*d,this.vertex(e+c,i+d,r)}this.vertex(e+c,i+d,r)}c=n,d=0,this.vertex(e+c,i+d,r)}},{key:"curve",value:function(t,e,i,n,r,o,s,h,l){var u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null;this.check(a.Line,2*l+2),null===u&&(u=this.color);for(var c=1/l,d=c*c,f=c*c*c,p=3*c,v=3*d,g=6*d,y=6*f,m=t-2*i+r,w=e-2*n+o,M=3*(i-r)-t+s,b=3*(n-o)-e+h,x=t,T=e,S=(i-t)*p+m*v+M*f,k=(n-e)*p+w*v+b*f,_=m*g+M*y,I=w*g+b*y,E=M*y,R=b*y;l-- >0;)this.vertex(x,T,u),x+=S,T+=k,S+=_,k+=I,_+=E,I+=R,this.vertex(x,T,u);this.vertex(x,T,u),this.vertex(s,h,u)}},{key:"vertex",value:function(t,e,i){var n=this.vertexIndex,r=this.mesh.getVertices();r[n++]=t,r[n++]=e,r[n++]=i.r,r[n++]=i.g,r[n++]=i.b,r[n++]=i.a,this.vertexIndex=n}},{key:"end",value:function(){if(!this.isDrawing)throw new Error("ShapeRenderer.begin() has not been called");this.flush();var t=this.context;t.disable(t.BLEND),this.isDrawing=!1}},{key:"flush",value:function(){0!==this.vertexIndex&&(this.mesh.setVerticesLength(this.vertexIndex),this.mesh.draw(this.shader,this.shapeType),this.vertexIndex=0)}},{key:"check",value:function(t,e){if(!this.isDrawing)throw new Error("ShapeRenderer.begin() has not been called");if(this.shapeType===t){if(!(this.mesh.maxVertices()-this.mesh.numVertices()<e))return;this.flush()}else this.flush(),this.shapeType=t}},{key:"dispose",value:function(){this.mesh.dispose()}}]),t}();e.ShapeRenderer=u},5297:function(t,e,i){"use strict";var n=i(4575).default,r=i(3913).default;Object.defineProperty(e,"__esModule",{value:!0}),e.Sprite=void 0;var a=i(8606),o=i(2283),s=function(){function t(e){n(this,t),this.region=e,this.dirty=!1,this.position=new o.Vector2(0,0),this.size=new o.Vector2(0,0),this.origin=new o.Vector2(0,0),this.scale=new o.Vector2(1,1),this.color=new a.Color(1,1,1,1),this.rotation=0,this.vertices=new Float32Array(48),this.bounds={x:0,y:0,width:0,height:0},this.setSize(e.width,e.height),this.setOrigin(e.width/2,e.height/2)}return r(t,[{key:"set",value:function(t){this.region=t.region,this.position.setVector(t.position),this.size.setVector(t.size),this.origin.setVector(t.origin),this.rotation=t.rotation,this.scale.setVector(t.scale),this.color.setFromColor(t.color),this.dirty=!0}},{key:"setBounds",value:function(t,e,i,n){this.setPosition(t,e),this.setSize(t,e),this.dirty=!0}},{key:"setSize",value:function(t,e){this.size.set(t,e),this.dirty=!0}},{key:"setPosition",value:function(t,e){this.position.set(t,e),this.dirty=!0}},{key:"setOriginBasedPosition",value:function(t,e){this.setPosition(t-this.origin.x,e-this.origin.y)}},{key:"setX",value:function(t){this.position.x=t,this.dirty=!0}},{key:"setY",value:function(t){this.position.y=t,this.dirty=!0}},{key:"setCenterX",value:function(t){this.setX(t-this.size.x/2)}},{key:"setCenterY",value:function(t){this.setY(t-this.size.y/2)}},{key:"setCenter",value:function(t,e){this.setPosition(t-this.size.x/2,e-this.size.y/2)}},{key:"translateX",value:function(t){this.translate(t,0)}},{key:"translateY",value:function(t){this.translate(0,t)}},{key:"translate",value:function(t,e){this.position.add(t,e),this.dirty=!0}},{key:"setColor",value:function(t){this.color.setFromColor(t),this.dirty=!0}},{key:"setAlpha",value:function(t){this.color.a=t,this.dirty=!0}},{key:"setOrigin",value:function(t,e){this.origin.set(t,e),this.dirty=!0}},{key:"setOriginCenter",value:function(){this.origin.set(this.size.x/2,this.size.y/2),this.dirty=!0}},{key:"setRotation",value:function(t){this.rotation=t,this.dirty=!0}},{key:"getRotation",value:function(){return this.rotation}},{key:"rotate",value:function(t){0!==t&&(this.rotation+=t,this.dirty=!0)}},{key:"setScale",value:function(t,e){this.scale.set(t,e),this.dirty=!0}},{key:"applyScale",value:function(t){this.scale.scale(t),this.dirty=!0}},{key:"getVertices",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.vertices,i=this.region;if(!this.dirty)return e;var n=this.position.x,r=this.position.y,a=this.size.x,o=this.size.y,s=this.origin.x,h=this.origin.y,l=this.rotation,u=this.scale.x,c=this.scale.y,d=i.u,f=i.v,p=i.u2,v=i.v2,g=this.color,y=i.rotated,m=a/i.originalWidth,w=o/i.originalHeight,M=i.width*m,b=i.height*w,x=n+i.offsetX*m;if(n=x,r=t?r+o-i.offsetY*w-b:r+i.offsetY*w,t){var T=f;f=v,v=T}var S=-s,k=(a=M)-s,_=a-s,I=-s,E=-h,R=-h,A=(o=b)-h,P=o-h;if(1!==u&&(S*=u,k*=u,_*=u,I*=u),1!==c&&(E*=c,R*=c,A*=c,P*=c),0!==l){var O=Math.cos(l),D=Math.sin(l),L=O*S-D*E,C=D*S+O*E,B=O*k-D*R,z=D*k+O*R,H=O*_-D*A,V=D*_+O*A,F=O*I-D*P,N=D*I+O*P;S=L,k=B,_=H,I=F,E=C,R=z,A=V,P=N}S+=n+s,k+=n+s,_+=n+s,I+=n+s,E+=r+h,R+=r+h,A+=r+h,P+=r+h;var G=d,j=f,W=p,U=v,Y=W,X=j,K=G,q=U;y&&(t?(G=d,j=v,W=p,U=f,Y=d,X=f,K=p,q=v):(G=p,j=f,W=d,U=v,Y=p,X=v,K=d,q=f));var Q=0;return e[Q++]=S,e[Q++]=E,e[Q++]=g.r,e[Q++]=g.g,e[Q++]=g.b,e[Q++]=g.a,e[Q++]=G,e[Q++]=j,e[Q++]=0,e[Q++]=0,e[Q++]=0,e[Q++]=0,e[Q++]=k,e[Q++]=R,e[Q++]=g.r,e[Q++]=g.g,e[Q++]=g.b,e[Q++]=g.a,e[Q++]=Y,e[Q++]=X,e[Q++]=0,e[Q++]=0,e[Q++]=0,e[Q++]=0,e[Q++]=_,e[Q++]=A,e[Q++]=g.r,e[Q++]=g.g,e[Q++]=g.b,e[Q++]=g.a,e[Q++]=W,e[Q++]=U,e[Q++]=0,e[Q++]=0,e[Q++]=0,e[Q++]=0,e[Q++]=I,e[Q++]=P,e[Q++]=g.r,e[Q++]=g.g,e[Q++]=g.b,e[Q++]=g.a,e[Q++]=K,e[Q++]=q,e[Q++]=0,e[Q++]=0,e[Q++]=0,e[Q]=0,e}},{key:"getBoundingRectangle",value:function(){var t=this.vertices,e=t[0],i=t[1],n=t[0],r=t[1];return e=(e=(e=e>t[12]?t[12]:e)>t[24]?t[24]:e)>t[36]?t[36]:e,n=(n=(n=n<t[12]?t[12]:n)<t[24]?t[24]:n)<t[36]?t[36]:n,i=(i=(i=i>t[13]?t[13]:i)>t[25]?t[25]:i)>t[37]?t[37]:i,r=(r=(r=r<t[13]?t[13]:r)<t[25]?t[25]:r)<t[37]?t[37]:r,this.bounds.x=e,this.bounds.y=i,this.bounds.width=n-e,this.bounds.height=r-i,this.bounds}},{key:"draw",value:function(t){t.drawVertices(this.region.texture,this.getVertices(t.yDown))}},{key:"drawWithAlpha",value:function(t,e){var i=this.getColor().a;this.setAlpha(i*e),this.draw(t),this.setAlpha(i)}},{key:"getX",value:function(){return this.position.x}},{key:"getY",value:function(){return this.position.y}},{key:"getWidth",value:function(){return this.size.x}},{key:"getHeight",value:function(){return this.size.y}},{key:"getOriginX",value:function(){return this.origin.x}},{key:"getOriginY",value:function(){return this.origin.y}},{key:"getScaleX",value:function(){return this.scale.x}},{key:"getScaleY",value:function(){return this.scale.y}},{key:"getColor",value:function(){return this.color}}]),t}();e.Sprite=s},7139:function(t,e,i){"use strict";var n,r=i(4575).default,a=i(3913).default;Object.defineProperty(e,"__esModule",{value:!0}),e.Texture=e.TextureWrap=e.TextureFilter=void 0,function(t){t[t.Nearest=9728]="Nearest",t[t.Linear=9729]="Linear",t[t.MipMap=9987]="MipMap",t[t.MipMapNearestNearest=9984]="MipMapNearestNearest",t[t.MipMapLinearNearest=9985]="MipMapLinearNearest",t[t.MipMapNearestLinear=9986]="MipMapNearestLinear",t[t.MipMapLinearLinear=9987]="MipMapLinearLinear"}(n=e.TextureFilter||(e.TextureFilter={})),function(t){t[t.MirroredRepeat=33648]="MirroredRepeat",t[t.ClampToEdge=33071]="ClampToEdge",t[t.Repeat=10497]="Repeat"}(e.TextureWrap||(e.TextureWrap={}));var o=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r(this,t),this.texture=null,this.boundUnit=0,this.useMipMaps=!1,this.width=0,this.height=0,this._image=i,this.context=e,this.useMipMaps=n,this.restore(),this.width=i.width,this.height=i.height}return a(t,[{key:"getImage",value:function(){return this._image}},{key:"getWebGLTexture",value:function(){return this.texture}},{key:"setFilters",value:function(e,i){var n=this.context;this.bind(),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,t.validateMagFilter(i))}},{key:"setWraps",value:function(t,e){var i=this.context;this.bind(),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,e)}},{key:"update",value:function(e){var i=this.context;this.texture||(this.texture=this.context.createTexture()),this.bind(),t.DISABLE_UNPACK_PREMULTIPLIED_ALPHA_WEBGL&&i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,this._image),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,e?i.LINEAR_MIPMAP_LINEAR:i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),e&&i.generateMipmap(i.TEXTURE_2D)}},{key:"restore",value:function(){this.texture=null,this.update(this.useMipMaps)}},{key:"bind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.context;this.boundUnit=t,e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this.texture)}},{key:"unbind",value:function(){var t=this.context;t.activeTexture(t.TEXTURE0+this.boundUnit),t.bindTexture(t.TEXTURE_2D,null)}},{key:"dispose",value:function(){this.context.deleteTexture(this.texture)}}],[{key:"load",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Promise((function(r){var a=new Image;a.onload=function(){r(new t(e,a,n))},a.src=i}))}},{key:"validateMagFilter",value:function(t){switch(t){case n.MipMap:case n.MipMapLinearLinear:case n.MipMapLinearNearest:case n.MipMapNearestLinear:case n.MipMapNearestNearest:return n.Linear;default:return t}}}]),t}();e.Texture=o,o.DISABLE_UNPACK_PREMULTIPLIED_ALPHA_WEBGL=!1},9396:function(t,e,i){"use strict";var n=i(9591).default,r=i(3038).default,a=i(3269).default,o=i(4575).default,s=i(3913).default,h=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(r,a){function o(t){try{h(n.next(t))}catch(e){a(e)}}function s(t){try{h(n.throw(t))}catch(e){a(e)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,s)}h((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.TextureAtlas=void 0;var l=i(7139),u=i(859);function c(t,e){for(var i=t.split("/"),n=e.split("/"),r=[],a=0,o=i.length;a<o;a++)if(".."===i[a])r.pop();else{if("."===i[a])continue;r.push(i[a])}for(var s=0,h=n.length;s<h;s++)if(".."===n[s])r.pop();else{if("."===n[s])continue;r.push(n[s])}return r.join("/")}var d=function(){function t(e,i){o(this,t),this.pages=e,this.regions=i}return s(t,[{key:"dispose",value:function(){var t,e=a(this.pages);try{for(e.s();!(t=e.n()).done;){t.value.dispose()}}catch(i){e.e(i)}finally{e.f()}}},{key:"getPages",value:function(){return this.pages}},{key:"getRegions",value:function(){return this.regions}},{key:"findRegion",value:function(t,e){for(var i=0;i<this.regions.length;i++){var n=this.regions[i];if(n.name===t&&(void 0===e||n.index===e))return n}return null}},{key:"findRegions",value:function(t){return this.regions.filter((function(e){return e.name===t})).sort((function(t,e){return t.index-e.index}))}}],[{key:"load",value:function(e,i,a){return h(this,void 0,void 0,n().mark((function o(){var s,h,d,f,p,v,g,y,m,w,M,b,x,T,S,k,_,I,E,R,A,P,O,D,L,C,B,z,H,V,F,N,G,j,W,U,Y,X,K,q,Q;return n().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,fetch(i).then((function(t){return t.text()}));case 2:s=n.sent,h=[],d=[],f=[],v=s.split(/\r?\n/),g=0;case 8:if(void 0!==(m=v[g])){n.next=12;break}return n.abrupt("break",16);case 12:0===m.trim().length?p=null:null===p?(w=c(i,"../".concat(m)),g++,m=v[g],y=m.split(":")[1].split(",").map((function(t){return t.trim()})),M=parseInt(y[0],10),b=parseInt(y[1],10),g++,m=v[g],y=m.split(":")[1].split(",").map((function(t){return t.trim()})),x=y[0],g++,m=v[g],y=m.split(":")[1].split(",").map((function(t){return t.trim()})),T=r(y,2),S=T[0],k=T[1],g++,m=v[g],y=m.split(":")[1].split(",").map((function(t){return t.trim()})),_=y[0],I=l.TextureWrap.ClampToEdge,E=l.TextureWrap.ClampToEdge,"x"===_?I=l.TextureWrap.Repeat:"y"===_?E=l.TextureWrap.Repeat:"xy"===_&&(I=l.TextureWrap.Repeat,E=l.TextureWrap.Repeat),p={file:w,width:M,height:b,format:x,mipMaps:"Nearest"!==S&&"Linear"!==S,min:S,max:k,direction:_,repeatX:I,repeatY:E},h.push(p)):(R=m,g++,m=v[g],y=m.split(":")[1].split(",").map((function(t){return t.trim()})),A="true"===y[0],g++,m=v[g],y=m.split(":")[1].split(",").map((function(t){return t.trim()})),P=parseInt(y[0],10),O=parseInt(y[1],10),g++,m=v[g],y=m.split(":")[1].split(",").map((function(t){return t.trim()})),D=parseInt(y[0],10),L=parseInt(y[1],10),C={name:R,rotate:A,left:P,top:O,width:D,height:L,page:p},g++,m=v[g],4===(y=m.split(":")[1].split(",").map((function(t){return t.trim()}))).length&&(C.splits=y.map((function(t){return parseInt(t,10)})),g++,m=v[g],4===(y=m.split(":")[1].split(",").map((function(t){return t.trim()}))).length&&(C.pads=y.map((function(t){return parseInt(t,10)})),g++,m=v[g],y=m.split(":")[1].split(",").map((function(t){return t.trim()})))),C.originalWidth=parseInt(y[0],10),C.originalHeight=parseInt(y[1],10),g++,m=v[g],y=m.split(":")[1].split(",").map((function(t){return t.trim()})),C.offsetX=parseInt(y[0],10),C.offsetY=parseInt(y[1],10),g++,m=v[g],y=m.split(":")[1].split(",").map((function(t){return t.trim()})),C.index=parseInt(y[0],10),f.push(C)),g++,n.next=8;break;case 16:B=0,z=h;case 17:if(!(B<z.length)){n.next=27;break}return H=z[B],n.next=21,l.Texture.load(e,H.file,a);case 21:H.texture=n.sent,H.invTexWidth=1/H.texture.width,H.invTexHeight=1/H.texture.height;case 24:B++,n.next=17;break;case 27:for(V=[],F=0,N=f;F<N.length;F++)G=N[F],j=G.left,W=G.top,U=G.rotate?G.height:G.width,Y=G.rotate?G.width:G.height,X=G.page,K=X.texture,q=X.invTexWidth,Q=X.invTexHeight,V.push(new u.TextureRegion(K,j,W,U,Y,G,q,Q,G.rotate));return n.abrupt("return",new t(d,V));case 30:case"end":return n.stop()}}),o)})))}}]),t}();e.TextureAtlas=d},859:function(t,e,i){"use strict";var n=i(4575).default,r=i(3913).default;Object.defineProperty(e,"__esModule",{value:!0}),e.TextureRegion=void 0;var a=function(){function t(e,i,r,a,o,s,h,l){var u=arguments.length>8&&void 0!==arguments[8]&&arguments[8];n(this,t),this.name=null,this.index=0,this.texture=null,this.regionX=0,this.regionY=0,this.width=0,this.height=0,this.invTexWidth=0,this.invTexHeight=0,this.originalWidth=0,this.originalHeight=0,this.offsetX=0,this.offsetY=0,this.u=0,this.v=0,this.u2=0,this.v2=0,this.rotated=!1,h&&l||(h=1/e.width,l=1/e.height);var c=i*h,d=(r+o)*l,f=(i+a)*h,p=r*l;for(var v in this.texture=e,this.regionX=i,this.regionY=r,this.width=a,this.height=o,this.originalWidth=a,this.originalHeight=o,this.offsetX=0,this.offsetY=0,this.u=c,this.v=d,this.u2=f,this.v2=p,this.rotated=u,s)this[v]=s[v]}return r(t,[{key:"draw",value:function(t,e,i,n,r){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:1,u=this.originalWidth,c=this.originalHeight,d=this.offsetX,f=this.offsetY,p=this.width,v=this.height,g=n/u,y=r/c,m=p*g,w=v*y,M=e+d*g,b=0;a-=M-e,o-=(b=t.yDown?i+r-f*y-w:i+f*y)-i,t.draw(this.texture,M,b,m,w,a,o,s,h,l,this.u,this.v,this.u2,this.v2,this.rotated)}}],[{key:"splitTexture",value:function(e,i,n){for(var r=e.width/i,a=e.height/n,o=[],s=0;s<n;s++)for(var h=0;h<i;h++)o.push(new t(e,h*r,s*a,r,a,{}));return o}}]),t}();e.TextureRegion=a},8606:function(t,e,i){"use strict";var n,r=i(2205).default,a=i(9842).default,o=i(4575).default,s=i(3913).default;Object.defineProperty(e,"__esModule",{value:!0}),e.copyArray=e.createStage=e.pointInRect=e.resizeCanvas=e.createGameLoop=e.WindowedMean=e.TimeKeeper=e.Pools=e.Pool=e.Utils=e.PowOut=e.Pow=e.Interpolation=e.MathUtils=e.Color=e.StringSet=e.IntSet=e.Align=void 0;var h=function(){function t(){o(this,t)}return s(t,null,[{key:"isLeft",value:function(t){return 0!==(t&this.left)}},{key:"isRight",value:function(t){return 0!==(t&this.right)}},{key:"isTop",value:function(t){return 0!==(t&this.top)}},{key:"isBottom",value:function(t){return 0!==(t&this.bottom)}},{key:"isCenterVertical",value:function(t){return 0===(t&this.top)&&0===(t&this.bottom)}},{key:"isCenterHorizontal",value:function(t){return 0===(t&this.left)&&0===(t&this.right)}}]),t}();e.Align=h,n=h,h.center=1,h.top=2,h.bottom=4,h.left=8,h.right=16,h.topLeft=n.top|n.left,h.topRight=n.top|n.right,h.bottomLeft=n.bottom|n.left,h.bottomRight=n.bottom|n.right;var l=function(){function t(){o(this,t),this.array=new Array}return s(t,[{key:"add",value:function(t){var e=this.contains(t);return this.array[0|t]=0|t,!e}},{key:"contains",value:function(t){return void 0!==this.array[0|t]}},{key:"remove",value:function(t){this.array[0|t]=void 0}},{key:"clear",value:function(){this.array.length=0}}]),t}();e.IntSet=l;var u=function(){function t(){o(this,t),this.entries={},this.size=0}return s(t,[{key:"add",value:function(t){var e=this.entries[t];return this.entries[t]=!0,!e&&(this.size++,!0)}},{key:"addAll",value:function(t){for(var e=this.size,i=0,n=t.length;i<n;i++)this.add(t[i]);return e!==this.size}},{key:"contains",value:function(t){return this.entries[t]}},{key:"clear",value:function(){this.entries={},this.size=0}}]),t}();e.StringSet=u;var c=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;o(this,t),this.r=e,this.g=i,this.b=n,this.a=r}return s(t,[{key:"unsafeSet",value:function(t,e,i,n){this.r=t,this.g=e,this.b=i,this.a=n}},{key:"set",value:function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=n,this.clamp()}},{key:"setFromColor",value:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}},{key:"setFromString",value:function(t){return t="#"===t.charAt(0)?t.substring(1):t,this.r=parseInt(t.substring(0,2),16)/255,this.g=parseInt(t.substring(2,4),16)/255,this.b=parseInt(t.substring(4,6),16)/255,this.a=8!==t.length?1:parseInt(t.substring(6,8),16)/255,this}},{key:"add",value:function(t,e,i,n){return this.r+=t,this.g+=e,this.b+=i,this.a+=n,this.clamp()}},{key:"clamp",value:function(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this}},{key:"toIntBits",value:function(){return 255*this.a<<24|255*this.b<<16|255*this.g<<8|255*this.r}}],[{key:"rgba8888ToColor",value:function(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255}},{key:"rgb888ToColor",value:function(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255}},{key:"fromString",value:function(e){return(new t).setFromString(e)}}]),t}();e.Color=c,c.WHITE=new c(1,1,1,1),c.RED=new c(1,0,0,1),c.GREEN=new c(0,1,0,1),c.BLUE=new c(0,0,1,1),c.MAGENTA=new c(1,0,1,1);var d=function(){function t(){o(this,t)}return s(t,null,[{key:"clamp",value:function(t,e,i){return t<e?e:t>i?i:t}},{key:"cosDeg",value:function(e){return Math.cos(e*t.degRad)}},{key:"sinDeg",value:function(e){return Math.sin(e*t.degRad)}},{key:"signum",value:function(t){return t>0?1:t<0?-1:0}},{key:"toInt",value:function(t){return t>0?Math.floor(t):Math.ceil(t)}},{key:"cbrt",value:function(t){var e=Math.pow(Math.abs(t),1/3);return t<0?-e:e}},{key:"randomTriangular",value:function(e,i){return t.randomTriangularWith(e,i,.5*(e+i))}},{key:"randomTriangularWith",value:function(t,e,i){var n=Math.random(),r=e-t;return n<=(i-t)/r?t+Math.sqrt(n*r*(i-t)):e-Math.sqrt((1-n)*r*(e-i))}},{key:"isPowerOfTwo",value:function(t){return t&&0===(t&t-1)}}]),t}();e.MathUtils=d,d.PI=3.1415927,d.PI2=2*d.PI,d.radiansToDegrees=180/d.PI,d.radDeg=d.radiansToDegrees,d.degreesToRadians=d.PI/180,d.degRad=d.degreesToRadians;var f=function(){function t(){o(this,t)}return s(t,[{key:"apply",value:function(t,e,i){return t+(e-t)*this.applyInternal(i)}}]),t}();e.Interpolation=f;var p=function(t){r(i,t);var e=a(i);function i(t){var n;return o(this,i),(n=e.call(this)).power=2,n.power=t,n}return s(i,[{key:"applyInternal",value:function(t){return t<=.5?Math.pow(2*t,this.power)/2:Math.pow(2*(t-1),this.power)/(this.power%2===0?-2:2)+1}}]),i}(f);e.Pow=p;var v=function(t){r(i,t);var e=a(i);function i(){return o(this,i),e.apply(this,arguments)}return s(i,[{key:"applyInternal",value:function(t){return Math.pow(t-1,this.power)*(this.power%2===0?-1:1)+1}}]),i}(p);e.PowOut=v;var g=function(){function t(){o(this,t)}return s(t,null,[{key:"arrayCopy",value:function(t,e,i,n,r){for(var a=e,o=n;a<e+r;a++,o++)i[o]=t[a]}},{key:"arrayFill",value:function(t,e,i,n){for(var r=e;r<i;r++)t[r]=n}},{key:"setArraySize",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=t.length;if(n===e)return t;if(t.length=e,n<e)for(var r=n;r<e;r++)t[r]=i;return t}},{key:"ensureArrayCapacity",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.length>=i?e:t.setArraySize(e,i,n)}},{key:"newArray",value:function(t,e){for(var i=new Array(t),n=0;n<t;n++)i[n]=e;return i}},{key:"newFloatArray",value:function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Float32Array(e);for(var i=new Array(e),n=0;n<i.length;n++)i[n]=0;return i}},{key:"newShortArray",value:function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Int16Array(e);for(var i=new Array(e),n=0;n<i.length;n++)i[n]=0;return i}},{key:"toFloatArray",value:function(e){return t.SUPPORTS_TYPED_ARRAYS?new Float32Array(e):e}},{key:"toSinglePrecision",value:function(e){return t.SUPPORTS_TYPED_ARRAYS?Math.fround(e):e}},{key:"contains",value:function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return!0;return!1}},{key:"enumValue",value:function(t,e){return t[e[0].toUpperCase()+e.slice(1)]}}]),t}();e.Utils=g,g.SUPPORTS_TYPED_ARRAYS="undefined"!==typeof Float32Array;var y=function(){function t(e){o(this,t),this.items=new Array,this.instantiator=e||function(){return{}}}return s(t,[{key:"obtain",value:function(){return this.items.length>0?this.items.pop():this.instantiator()}},{key:"free",value:function(t){(null===t||void 0===t?void 0:t.reset)&&t.reset(),this.items.push(t)}},{key:"freeAll",value:function(t){for(var e=0;e<t.length;e++)this.free(t[e])}},{key:"clear",value:function(){this.items.length=0}}]),t}();e.Pool=y;var m=function(){function t(){o(this,t)}return s(t,null,[{key:"free",value:function(t,e){this.pools[t]&&this.pools[t].free(e)}},{key:"freeAll",value:function(t,e){this.pools[t]&&this.pools[t].freeAll(e)}},{key:"get",value:function(t,e){return this.pools[t]||(this.pools[t]=new y(e)),this.pools[t]}},{key:"set",value:function(t,e){this.pools[t]=e}},{key:"obtain",value:function(t,e){return this.get(t,e).obtain()}}]),t}();e.Pools=m,m.pools={};var w=function(){function t(){o(this,t),this.maxDelta=.064,this.framesPerSecond=0,this.delta=0,this.totalTime=0,this.lastTime=Date.now()/1e3,this.frameCount=0,this.frameTime=0}return s(t,[{key:"update",value:function(){var t=Date.now()/1e3;this.delta=t-this.lastTime,this.frameTime+=this.delta,this.totalTime+=this.delta,this.delta>this.maxDelta&&(this.delta=this.maxDelta),this.lastTime=t,this.frameCount++,this.frameTime>1&&(this.framesPerSecond=this.frameCount/this.frameTime,this.frameTime=0,this.frameCount=0)}}]),t}();e.TimeKeeper=w;var M=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32;o(this,t),this.addedValues=0,this.lastValue=0,this.mean=0,this.dirty=!0,this.values=new Array(e)}return s(t,[{key:"hasEnoughData",value:function(){return this.addedValues>=this.values.length}},{key:"addValue",value:function(t){this.addedValues<this.values.length&&this.addedValues++,this.values[this.lastValue++]=t,this.lastValue>this.values.length-1&&(this.lastValue=0),this.dirty=!0}},{key:"getMean",value:function(){if(this.hasEnoughData()){if(this.dirty){for(var t=0,e=0;e<this.values.length;e++)t+=this.values[e];this.mean=t/this.values.length,this.dirty=!1}return this.mean}return 0}}]),t}();e.WindowedMean=M;e.createGameLoop=function(t){var e,i=Date.now(),n=0,r=!0,a=0,o=0;function s(){if(r){var h=Date.now()-i;i=Date.now(),a++,(o+=h)>=1e3&&(n=a,a=0,o-=1e3),e=requestAnimationFrame(s),t(h/1e3)}}return s(),{isRunning:function(){return r},start:function(){r||(r=!0,s())},stop:function(){e&&cancelAnimationFrame(e),r=!1},getFps:function(){return n}}};e.resizeCanvas=function(t,e){var i=e||window.devicePixelRatio||1,n=t.clientWidth*i,r=t.clientHeight*i;return t.width===n&&t.height===r||(t.width=n,t.height=r),[n,r]};e.pointInRect=function(t,e,i,n,r,a){return t>i&&t<i+r&&e>n&&e<n+a};e.createStage=function(t){t=Object.assign(Object.assign({},{hidden:!1,info:!0}),t);var e=document.createElement("div");e.setAttribute("style","position:fixed;top:0;left:0;right:0;bottom:0;"),t.wrapperClassName&&(e.className=t.wrapperClassName),t.hidden&&(e.style.display="none");var i=document.createElement("canvas");i.setAttribute("style","width:100%;height:100%;");var n=document.createElement("div");return n.setAttribute("style","position:absolute;top:1em;left:1em;color:white"),t.info||(n.style.display="none"),e.appendChild(i),e.appendChild(n),document.body.appendChild(e),{getCanvas:function(){return i},getInfo:function(){return n},show:function(){return e.style.display="block"},hide:function(){return e.style.display="none"},cleanup:function(){return document.body.removeChild(e)}}};e.copyArray=function(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.length,a=0;a<r;a++)e[i+a]=t[n+a]}},2283:function(t,e,i){"use strict";var n=i(4575).default,r=i(3913).default;Object.defineProperty(e,"__esModule",{value:!0}),e.Vector2=void 0;var a=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;n(this,t),this.x=0,this.y=0,this.x=e,this.y=i}return r(t,[{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}},{key:"set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"setVector",value:function(t){return this.set(t.x,t.y)}},{key:"add",value:function(t,e){return this.x+=t,this.y+=e,this}},{key:"addVector",value:function(t){return this.add(t.x,t.y)}},{key:"sub",value:function(t,e){return this.add(-t,-e)}},{key:"subVector",value:function(t){return this.sub(t.x,t.y)}},{key:"scale",value:function(t){return this.x*=t,this.y*=t,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"distanceSqr",value:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i}},{key:"distance",value:function(t){return Math.sqrt(this.distanceSqr(t))}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"len2",value:function(){return this.x*this.x+this.y*this.y}},{key:"len",value:function(){return Math.sqrt(this.len2())}},{key:"nor",value:function(){var t=this.len();return 0!==t&&(this.x/=t,this.y/=t),this}},{key:"rotateRad",value:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.x*e-this.y*i,r=this.x*i+this.y*e;return this.x=n,this.y=r,this}},{key:"rotate",value:function(t){return this.rotateRad(t*Math.PI/180)}},{key:"cpy",value:function(){return new t(this.x,this.y)}}]),t}();e.Vector2=a},7811:function(t,e,i){"use strict";var n=i(4575).default,r=i(3913).default;Object.defineProperty(e,"__esModule",{value:!0}),e.Vector3=void 0;var a=i(4995),o=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n(this,t),this.x=0,this.y=0,this.z=0,this.x=e,this.y=i,this.z=r}return r(t,[{key:"setFrom",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"set",value:function(t,e,i){return this.x=t,this.y=e,this.z=i,this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"scale",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"normalize",value:function(){var t=this.length();return 0===t||(t=1/t,this.x*=t,this.y*=t,this.z*=t),this}},{key:"cross",value:function(t){return this.set(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}},{key:"multiply",value:function(t){var e=t.values;return this.set(this.x*e[a.M00]+this.y*e[a.M01]+this.z*e[a.M02]+e[a.M03],this.x*e[a.M10]+this.y*e[a.M11]+this.z*e[a.M12]+e[a.M13],this.x*e[a.M20]+this.y*e[a.M21]+this.z*e[a.M22]+e[a.M23])}},{key:"project",value:function(t){var e=t.values,i=1/(this.x*e[a.M30]+this.y*e[a.M31]+this.z*e[a.M32]+e[a.M33]);return this.set((this.x*e[a.M00]+this.y*e[a.M01]+this.z*e[a.M02]+e[a.M03])*i,(this.x*e[a.M10]+this.y*e[a.M11]+this.z*e[a.M12]+e[a.M13])*i,(this.x*e[a.M20]+this.y*e[a.M21]+this.z*e[a.M22]+e[a.M23])*i)}},{key:"unproject",value:function(t,e,i,n,r,a){var o=this.x,s=this.y,h=this.z;return o-=i,s=a-s-1,s-=n,t.set(2*o/r-1,2*s/a-1,2*h-1),t.project(e),t}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"distance",value:function(t){var e=t.x-this.x,i=t.y-this.y,n=t.z-this.z;return Math.sqrt(e*e+i*i+n*n)}}]),t}();e.Vector3=o},5533:function(t,e,i){"use strict";var n=i(3269).default,r=i(3038).default;Object.defineProperty(e,"__esModule",{value:!0}),e.createViewport=void 0;var a=i(7459),o=i(8606);e.createViewport=function(t,e,i,s){var h,l={autoUpdate:!0,pixelRatio:void 0,crop:!0};(s=Object.assign(Object.assign({},l),s)).disablePremultipliedAlpha&&(h={premultipliedAlpha:!1}),h=Object.assign(Object.assign({},h),s.contextOption);var u,c=t.getContext("webgl2",h),d=[],f=s,p=f.autoUpdate,v=f.pixelRatio,g=f.crop,y={pixelRatio:v=v||window.devicePixelRatio||1,x:0,y:0,width:e,height:i,worldWidth:e,worldHeight:i},m=(0,o.resizeCanvas)(t,v),w=r(m,2),M=w[0],b=w[1],x=new a.OrthoCamera(e,i,M,b);p&&(u=function(t){T.update()},window.addEventListener("resize",u));var T={getViewportInfo:function(){return y},getCamera:function(){return x},addCamera:function(t){d.push(t)},getContext:function(){return c},getCanvas:function(){return t},update:function(){var a=(0,o.resizeCanvas)(t,v),s=r(a,2),h=s[0],l=s[1],u=e/i,f=h/l;if(g){var p,m;u<f?(m=l,p=l*u):(p=h,m=h/u);var w=(h-p)/2,M=(l-m)/2;y.x=w,y.y=M,y.width=p,y.height=m,c.viewport(w,M,p,m),x.setPosition(e/2,i/2),x.resize(e,i,p,m);var b,T=n(d);try{for(T.s();!(b=T.n()).done;){var S=b.value;S.setPosition(e/2,i/2),S.resize(e,i,p,m)}}catch(O){T.e(O)}finally{T.f()}}else{var k,_,I,E;y.x=0,y.y=0,y.width=h,y.height=l,c.viewport(0,0,h,l),u<f?(I=-((k=(_=i)*f)-e)/2,E=0):(I=0,E=-((_=(k=e)/f)-i)/2),x.setPosition(I+k/2,E+_/2),x.resize(k,_,h,l);var R,A=n(d);try{for(A.s();!(R=A.n()).done;){var P=R.value;P.setPosition(I+k/2,E+_/2),P.resize(k,_,h,l)}}catch(O){A.e(O)}finally{A.f()}}},cleanUp:function(){u&&window.removeEventListener("resize",u)}};return p&&T.update(),T}},4411:function(t,e,i){"use strict";var n=i(4575).default,r=i(3913).default;Object.defineProperty(e,"__esModule",{value:!0}),e.ViewportInputHandler=void 0;var a=i(6964),o=i(2283),s=function(){function t(e){n(this,t),this.screenCoord=new o.Vector2,this.worldCoord=new o.Vector2,this.viewport=e,this.canvas=e.getCanvas(),this.inputHandler=new a.InputHandler(this.canvas)}return r(t,[{key:"isTouched",value:function(){return this.inputHandler.isTouched()}},{key:"cleanup",value:function(){this.inputHandler.cleanup()}},{key:"addEventListener",value:function(t,e){var i,n;this.inputHandler.addEventListener(t,(i=e,n=this.viewport,function(t,e){var r=n.getViewportInfo(),a=r.x,o=r.y,s=r.pixelRatio;i(t=t*s-a,e=e*s-o)}))}},{key:"getX",value:function(){var t=this.viewport.getViewportInfo(),e=t.x,i=t.pixelRatio;return this.inputHandler.getX()*i-e}},{key:"getY",value:function(){var t=this.viewport.getViewportInfo(),e=t.y,i=t.pixelRatio;return this.inputHandler.getY()*i-e}},{key:"getTouchedWorldCoord",value:function(t){return t||(t=this.viewport.getCamera()),this.screenCoord.set(this.getX(),this.getY()),t.unprojectVector2(this.worldCoord,this.screenCoord),this.worldCoord}}]),t}();e.ViewportInputHandler=s},2955:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||n(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),r(i(8656),e),r(i(2121),e),r(i(7581),e),r(i(3959),e),r(i(2791),e),r(i(5477),e),r(i(7459),e),r(i(6176),e),r(i(2013),e),r(i(7712),e),r(i(9045),e),r(i(6964),e),r(i(4995),e),r(i(1514),e),r(i(9699),e),r(i(1251),e),r(i(1858),e),r(i(5297),e),r(i(2987),e),r(i(7139),e),r(i(9396),e),r(i(859),e),r(i(8606),e),r(i(2283),e),r(i(7811),e),r(i(5533),e),r(i(4411),e)}},e={};function i(n){var r=e[n];if(void 0!==r)return r.exports;var a=e[n]={exports:{}};return t[n].call(a.exports,a,a.exports,i),a.exports}i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,{a:e}),e},i.d=function(t,e){for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},function(){"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(){e=function(){return i};var i={},n=Object.prototype,r=n.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",h=a.toStringTag||"@@toStringTag";function l(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(E){l=function(t,e,i){return t[e]=i}}function u(t,e,i,n){var r=e&&e.prototype instanceof f?e:f,a=Object.create(r.prototype),o=new k(n||[]);return a._invoke=function(t,e,i){var n="suspendedStart";return function(r,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===r)throw a;return I()}for(i.method=r,i.arg=a;;){var o=i.delegate;if(o){var s=x(o,i);if(s){if(s===d)continue;return s}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===n)throw n="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n="executing";var h=c(t,e,i);if("normal"===h.type){if(n=i.done?"completed":"suspendedYield",h.arg===d)continue;return{value:h.arg,done:i.done}}"throw"===h.type&&(n="completed",i.method="throw",i.arg=h.arg)}}}(t,i,o),a}function c(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(E){return{type:"throw",arg:E}}}i.wrap=u;var d={};function f(){}function p(){}function v(){}var g={};l(g,o,(function(){return this}));var y=Object.getPrototypeOf,m=y&&y(y(_([])));m&&m!==n&&r.call(m,o)&&(g=m);var w=v.prototype=f.prototype=Object.create(g);function M(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function b(e,i){function n(a,o,s,h){var l=c(e[a],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==t(d)&&r.call(d,"__await")?i.resolve(d.__await).then((function(t){n("next",t,s,h)}),(function(t){n("throw",t,s,h)})):i.resolve(d).then((function(t){u.value=t,s(u)}),(function(t){return n("throw",t,s,h)}))}h(l.arg)}var a;this._invoke=function(t,e){function r(){return new i((function(i,r){n(t,e,i,r)}))}return a=a?a.then(r,r):r()}}function x(t,e){var i=t.iterator[e.method];if(void 0===i){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,x(t,e),"throw"===e.method))return d;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var n=c(i,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,d;var r=n.arg;return r?r.done?(e[t.resultName]=r.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function _(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,n=function e(){for(;++i<t.length;)if(r.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:I}}function I(){return{value:void 0,done:!0}}return p.prototype=v,l(w,"constructor",v),l(v,"constructor",p),p.displayName=l(v,h,"GeneratorFunction"),i.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},i.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,l(t,h,"GeneratorFunction")),t.prototype=Object.create(w),t},i.awrap=function(t){return{__await:t}},M(b.prototype),l(b.prototype,s,(function(){return this})),i.AsyncIterator=b,i.async=function(t,e,n,r,a){void 0===a&&(a=Promise);var o=new b(u(t,e,n,r),a);return i.isGeneratorFunction(e)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},M(w),l(w,h,"Generator"),l(w,o,(function(){return this})),l(w,"toString",(function(){return"[object Generator]"})),i.keys=function(t){var e=[];for(var i in t)e.push(i);return e.reverse(),function i(){for(;e.length;){var n=e.pop();if(n in t)return i.value=n,i.done=!1,i}return i.done=!0,i}},i.values=_,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(i,n){return o.type="throw",o.arg=t,e.next=i,n&&(e.method="next",e.arg=void 0),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n],o=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),h=r.call(a,"finallyLoc");if(s&&h){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),S(i),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var n=i.completion;if("throw"===n.type){var r=n.arg;S(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,i){return this.delegate={iterator:_(t),resultName:e,nextLoc:i},"next"===this.method&&(this.arg=void 0),d}},i}function n(t,e,i,n,r,a,o){try{var s=t[a](o),h=s.value}catch(l){return void i(l)}s.done?e(h):Promise.resolve(h).then(n,r)}function r(t){return function(){var e=this,i=arguments;return new Promise((function(r,a){var o=t.apply(e,i);function s(t){n(o,r,a,s,h,"next",t)}function h(t){n(o,r,a,s,h,"throw",t)}s(void 0)}))}}var a=i(2955);function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var l=s((function t(){h(this,t)}));l.WORLD_WIDTH=500,l.WORLD_HEIGHT=1e3,l.BG_WIDTH=600,l.BG_HEIGHT=1e3,l.BG_OFFSET=(l.WORLD_WIDTH-l.BG_WIDTH)/2,l.BUSH_GROW_TIME=1,l.BUSH_DISAPPEAR_TIME=.1,l.BUSH_GROW_DELAY=.1,l.BUSH_INITIAL_GROW_DELAY=.5,l.BUSH_JIGGLE_TIME=.1,l.MATERIAL_WIDTH=40,l.MATERIAL_HEIGHT=l.MATERIAL_WIDTH/46*53,l.MATERIAL_OFFSET=15,l.HERO_WIDTH=100,l.HERO_HEIGHT=l.HERO_WIDTH/250*300,l.HERO_PICKING_TIME=1.1,l.HERO_SPEED=l.WORLD_WIDTH/2,l.DEFAULT_MULTIPLIER=1,l.PLAYFUL_TIME_RANGE=[5,20],l.TOOL_PLAYFUL_ANIMATION_TIME=1.3,l.SHOP_PLAYFUL_ANIMATION_TIME=44/30,l.INVENTORY_TRANSITION_TIME=.5,l.PURCHASE_ERROR_SHAKING_TIME=.5,l.TOOL_PICKING_TRANSITION_TIME=.5,l.ORDER_EFFECT_TIME=.5,l.SMOKE_DURATION=.66,l.SMOKE_WH_RATIO=260/300,l.MAX_INGREDIENTS_IN_DISH=3,l.TOTAL_DEMO_LEVEL=12,l.TOTAL_ORDERS=3;var u,c={fps:0,drawCalls:0};!function(t){t.SLIDE_TO_MATCH="slide_to_match",t.TOUCH_TO_MATCH="touch_to_match"}(u||(u={}));var d,f,p,v,g,y,m,w,M,b,x,T=function(t){return new Promise((function(e){return setTimeout(e,t)}))},S=function(t,e){return Promise.all([t,T(e)]).then((function(t){return t[0]}))},k=function(t){var e=localStorage.getItem("level:".concat(t,":maxStar")),i=0;return null!==e&&(i=parseInt(e)),i},_=i(8041),I=i.n(_),E=i(9997),R=["chop","cut","pan","wok","grill","stew"];function A(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function P(t,e){if(t){if("string"===typeof t)return A(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?A(t,e):void 0}}function O(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var n,r,a=[],o=!0,s=!1;try{for(i=i.call(t);!(o=(n=i.next()).done)&&(a.push(n.value),!e||a.length!==e);o=!0);}catch(h){s=!0,r=h}finally{try{o||null==i.return||i.return()}finally{if(s)throw r}}return a}}(t,e)||P(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(t,e){var i="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=P(t))||e&&t&&"number"===typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw a}}}}function L(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function C(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function B(t,e){return B=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},B(t,e)}function z(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&B(t,e)}function H(t){return H=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},H(t)}function V(e,i){if(i&&("object"===t(i)||"function"===typeof i))return i;if(void 0!==i)throw new TypeError("Derived constructors may only return object or undefined");return C(e)}function F(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=H(t);if(e){var r=H(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return V(this,i)}}function N(t,e,i,n,r){var a={};return Object.keys(n).forEach((function(t){a[t]=n[t]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=i.slice().reverse().reduce((function(i,n){return n(t,e,i)||i}),a),r&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(r):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(t,e,a),a=null),a}!function(t){t.IDLE="idle",t.PLAYFUL="playful",t.WORKING="working"}(d||(d={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.OPEN_RECIPES=1]="OPEN_RECIPES",t[t.OPEN_UI_ENDGAME=2]="OPEN_UI_ENDGAME"}(f||(f={}));var G,j,W,U,Y,X,K,q,Q,J,Z,$,tt,et,it,nt,rt,at,ot,st,ht,lt,ut,ct,dt,ft,pt,vt,gt,yt,mt,wt,Mt,bt,xt,Tt,St,kt,_t,It,Et,Rt,At,Pt,Ot,Dt,Lt,Ct,Bt=(p=(0,E.tB)("uiState"),v=(0,E.tB)("dishes"),g=(0,E.tB)("orders"),y=(0,E.tB)("eventEmitter"),m=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return L(t=e.call.apply(e,[this].concat(r)),"uiState",w,C(t)),L(t,"dishes",M,C(t)),L(t,"orders",b,C(t)),L(t,"eventEmitter",x,C(t)),t}return s(i,[{key:"initialized",value:function(){}},{key:"process",value:function(){for(var t=0;t<this.dishes.length;t++){var e=this.dishes[t];if(void 0!==e.item){var i,n=e.item,r=D(this.orders);try{for(r.s();!(i=r.n()).done;){if(O(i.value,2)[1].dish===n){this.eventEmitter.emit("serveOrder",{dishItem:n}),e.item=void 0,e.ingredients.length=0;break}}}catch(a){r.e(a)}finally{r.f()}}}}}]),i}(E.xP),w=N(m.prototype,"uiState",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M=N(m.prototype,"dishes",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b=N(m.prototype,"orders",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x=N(m.prototype,"eventEmitter",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m),zt=[],Ht=function(t,e){if(t.length!==e.length)return!1;zt.length=0;var i,n=D(t);try{for(n.s();!(i=n.n()).done;){var r=i.value;zt.push(r)}}catch(l){n.e(l)}finally{n.f()}var a,o=D(e);try{for(o.s();!(a=o.n()).done;){var s=a.value,h=zt.indexOf(s);if(-1===h)return!1;zt.splice(h,1)}}catch(l){o.e(l)}finally{o.f()}return!0},Vt=function(){function t(){h(this,t),this.formulas=[],this.loadFormula()}return s(t,[{key:"loadFormula",value:function(){var t=r(e().mark((function t(){var i,n,r,a,o,s,h,l,u,c,d,f,p,v;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("data/formula/tools.txt").then((function(t){return t.text()}));case 2:if((i=t.sent)&&0!==i.length){t.next=5;break}return t.abrupt("return");case 5:n=i.replaceAll(" ","").split(/\r?\n/),this.formulas.length=0,r=D(n),t.prev=8,r.s();case 10:if((a=r.n()).done){t.next=30;break}if(o=a.value,!((s=o.split("=")).length<2)){t.next=15;break}return t.abrupt("continue",28);case 15:if(!((h=s[0].split("+")).length<2)){t.next=18;break}return t.abrupt("continue",28);case 18:if(l=h[0].split("*"),u=l[0],c=l.length>1?parseInt(l[1]):1,!((d=h[1].split("*")).length<2)){t.next=24;break}return t.abrupt("continue",28);case 24:f=d[0],p=parseFloat(d[1]),v=s[1],this.formulas.push({itemCode:u,itemAmount:c,outputItemCode:v,requireTime:p,toolCode:f});case 28:t.next=10;break;case 30:t.next=35;break;case 32:t.prev=32,t.t0=t.catch(8),r.e(t.t0);case 35:return t.prev=35,r.f(),t.finish(35);case 38:case"end":return t.stop()}}),t,this,[[8,32,35,38]])})));return function(){return t.apply(this,arguments)}}()},{key:"searchOutputItem",value:function(t,e){return this.formulas.find((function(i){return i.toolCode===e&&i.itemCode===t}))}},{key:"searchInputItem",value:function(t){return this.formulas.find((function(e){return e.outputItemCode===t}))}}]),t}(),Ft=function(){function t(){h(this,t),this.recipeFomulars=[],this.loadRecipes()}return s(t,[{key:"loadRecipes",value:function(){var t=r(e().mark((function t(){var i,n,r,a,o,s,h,l;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("data/formula/recipes.txt").then((function(t){return t.text()}));case 2:if((i=t.sent)&&0!==i.length){t.next=5;break}return t.abrupt("return");case 5:this.recipeFomulars.length=0,n=i.replaceAll(" ","").split(/\r?\n/),r=D(n),t.prev=8,r.s();case 10:if((a=r.n()).done){t.next=20;break}if(o=a.value,!((s=o.split("=")).length<2)){t.next=15;break}return t.abrupt("continue",18);case 15:h=s[1],l=s[0].split("+"),this.recipeFomulars.push({ingredients:l,outputItemCode:h});case 18:t.next=10;break;case 20:t.next=25;break;case 22:t.prev=22,t.t0=t.catch(8),r.e(t.t0);case 25:return t.prev=25,r.f(),t.finish(25);case 28:case"end":return t.stop()}}),t,this,[[8,22,25,28]])})));return function(){return t.apply(this,arguments)}}()},{key:"searchOutputDish",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var n,r=D(this.recipeFomulars);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(Ht(e,a.ingredients))return a}}catch(o){r.e(o)}finally{r.f()}return null}},{key:"searchIngredientsOfDish",value:function(t){var e,i=D(this.recipeFomulars);try{for(i.s();!(e=i.n()).done;){var n=e.value;if(n.outputItemCode===t)return n.ingredients}}catch(r){i.e(r)}finally{i.f()}return null}},{key:"searchAvailableFormula",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var n,r=D(this.recipeFomulars);try{var a=function(){var t=n.value;if(e.every((function(e){return t.ingredients.includes(e)})))return{v:!0}};for(r.s();!(n=r.n()).done;){var o=a();if("object"===typeof o)return o.v}}catch(s){r.e(s)}finally{r.f()}return!1}}]),t}(),Nt=new Vt,Gt=new Ft,jt=(G=(0,E.tB)("toolInputHandlingSystem"),j=(0,E.tB)("tools"),W=(0,E.tB)("inventory"),U=(0,E.tB)("uiState"),Y=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return L(t=e.call.apply(e,[this].concat(r)),"toolInputHandlingSystem",X,C(t)),L(t,"tools",K,C(t)),L(t,"inventory",q,C(t)),L(t,"uiState",Q,C(t)),t}return s(i,[{key:"initialized",value:function(){}},{key:"process",value:function(){for(var t=0;t<this.tools.length;t++){var e=this.tools[t];if(void 0===e.processingIngredient&&void 0!==e.type&&!e.locked)for(var i=0;i<this.inventory.slots.length;i++){var n=this.inventory.slots[i];if(void 0!==n)if(void 0!==Nt.searchOutputItem(n,e.type)){this.toolInputHandlingSystem.processIngredientWithTool(e,i),this.uiState.toolPickingTransitions.push({itemCode:n,toolIndex:t,itemIndex:i,remainingTime:l.TOOL_PICKING_TRANSITION_TIME});break}}}}}]),i}(E.xP),X=N(Y.prototype,"toolInputHandlingSystem",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K=N(Y.prototype,"tools",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q=N(Y.prototype,"inventory",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q=N(Y.prototype,"uiState",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y),Wt=(J=(0,E.tB)("batch"),Z=(0,E.tB)("assetManager"),$=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return L(t=e.call.apply(e,[this].concat(r)),"batch",tt,C(t)),L(t,"assetManager",et,C(t)),t.bg=void 0,t}return s(i,[{key:"initialized",value:function(){this.bg=this.assetManager.getTexture("bg")}},{key:"process",value:function(){var t=this.bg,e=this.batch;e.begin(),e.draw(t,l.BG_OFFSET,0,l.BG_WIDTH,l.BG_HEIGHT),e.end()}}]),i}(E.xP),tt=N($.prototype,"batch",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),et=N($.prototype,"assetManager",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$),Ut=function(t,e,i,n){return t.setVector(i).subVector(e).scale(n).addVector(e)},Yt=function(t,e,i,n){var r=Kt(e.r,i.r,n),a=Kt(e.g,i.g,n),o=Kt(e.b,i.b,n),s=Kt(e.a,i.a,n);return t.set(r,a,o,s)},Xt=function(t,e,i,n,r){return t.x>e&&t.x<e+n&&t.y>i&&t.y<i+r},Kt=function(t,e,i){return t+(e-t)*i},qt=function(t){for(var e=[],i=1;i<t.length;i++){e.length=0;var n=t[i-5],r=t[i+5],a=i%5,o=void 0,s=void 0;if(a>0&&(o=t[i-1]),a<4&&(s=t[i+1]),void 0!==n&&e.push(n),void 0!==r&&e.push(r),void 0!==o&&e.push(o),void 0!==s&&e.push(s),e.length>=2){var h,l=0,u=D(e);try{for(u.s();!(h=u.n()).done;){if(h.value.type===t[i].type&&l++,2===l)return!0}}catch(c){u.e(c)}finally{u.f()}}}return!1},Qt=function t(e,i){i.length=0;for(var n=(e.board.width- -40)/5,r=n/220*230,a=(e.board.height-5*r)/4,o=0;o<5;o++)for(var s=0;s<5;s++)i.push({x:e.board.x+(n+-10)*s,y:e.board.y+(r+a)*o,width:n,height:r,stateTime:0,jiggleTime:0,type:Math.floor(3*Math.random()),growDelay:l.BUSH_INITIAL_GROW_DELAY,growTime:l.BUSH_GROW_TIME,disappearTime:0});for(var h=qt(i);!h;)t(e,i),h=qt(i)},Jt=(it=(0,E.tB)("layoutData"),nt=(0,E.tB)("bushes"),rt=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return L(t=e.call.apply(e,[this].concat(r)),"layoutData",at,C(t)),L(t,"bushes",ot,C(t)),t}return s(i,[{key:"initialized",value:function(){Qt(this.layoutData,this.bushes)}},{key:"process",value:function(){}}]),i}(E.xP),at=N(rt.prototype,"layoutData",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ot=N(rt.prototype,"bushes",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rt),Zt=(st=(0,E.tB)("layoutData"),ht=(0,E.tB)("inputHandler"),lt=(0,E.tB)("selectedPath"),ut=(0,E.tB)("bushes"),ct=(0,E.tB)("uiState"),dt=(0,E.tB)("materials"),ft=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return L(t=e.call.apply(e,[this].concat(r)),"layoutData",pt,C(t)),L(t,"inputHandler",vt,C(t)),L(t,"selectedPath",gt,C(t)),L(t,"bushes",yt,C(t)),L(t,"uiState",mt,C(t)),L(t,"materials",wt,C(t)),t.tmpVector=new a.Vector2(0,0),t.materialSortFunc=function(t,e){return t.index-e.index},t.canTriggerJustTouched=!0,t.justTouched=!1,t.currentBushIdx=-1,t}return s(i,[{key:"regrowBush",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.bushes[t];i.previousType=i.type,i.type=Math.floor(Math.random()*(e?3:4)),i.disappearTime=l.BUSH_DISAPPEAR_TIME,i.growTime=l.BUSH_GROW_TIME,i.growDelay=l.BUSH_GROW_DELAY}},{key:"checkBushAvailable",value:function(t){return-1===this.selectedPath.indexOf(t)}},{key:"getSameColorSideBushIdx",value:function(t){this.selectedPath.push(t);var e=this.bushes[t],i=t-5;void 0!==this.bushes[i]&&e.type===this.bushes[i].type&&this.checkBushAvailable(i)&&this.getSameColorSideBushIdx(i),i=t+5,void 0!==this.bushes[i]&&e.type===this.bushes[i].type&&this.checkBushAvailable(i)&&this.getSameColorSideBushIdx(i);var n=t%5;n>0&&(i=t-1,e.type===this.bushes[i].type&&this.checkBushAvailable(i)&&this.getSameColorSideBushIdx(i)),n<4&&(i=t+1,e.type===this.bushes[i].type&&this.checkBushAvailable(i)&&this.getSameColorSideBushIdx(i))}},{key:"processTouchSelectBushes",value:function(){if(this.justTouched){var t=this.inputHandler.getTouchedWorldCoord(),e=this.layoutData.board;if(Xt(t,e.x,e.y,e.width,e.height)){this.selectedPath.length=0;var i=Math.floor((t.x-e.x)/(e.width/5)),n=Math.floor((t.y-e.y)/(e.height/5));this.currentBushIdx=5*n+i,this.bushes[this.currentBushIdx].disappearTime>0||(this.selectedPath.length=0,this.getSameColorSideBushIdx(this.currentBushIdx))}}}},{key:"processSlideSelectBushes",value:function(){var t=this.inputHandler.getTouchedWorldCoord(),e=this.layoutData.board;if(Xt(t,e.x,e.y,e.width,e.height)){var i=Math.floor((t.x-e.x)/(e.width/5)),n=Math.floor((t.y-e.y)/(e.height/5)),r=5*n+i,a=this.bushes[r];if(this.tmpVector.set(a.x+a.width/2,a.y+a.height/2),!(this.tmpVector.distanceSqr(t)>=Math.pow(.35*a.height,2)))if(-1===this.selectedPath.indexOf(r)){if(this.selectedPath.length>0){var o=this.selectedPath[this.selectedPath.length-1];if(this.bushes[o].type!==a.type)return;var s=o%5,h=(o-s)/5;if(Math.abs(s-i)>1||Math.abs(h-n)>1)return}this.selectedPath.push(r)}else this.selectedPath[this.selectedPath.length-2]===r&&this.selectedPath.pop()}}},{key:"spawnMaterial",value:function(){if(!(this.selectedPath.length<3)){var t=this.uiState.boardInputType===u.TOUCH_TO_MATCH;if(!(t&&this.currentBushIdx<0)){var e=t?this.currentBushIdx:this.selectedPath[this.selectedPath.length-1],i=this.bushes[e];if(3!==i.type){var n,r=D(this.materials);try{for(r.s();!(n=r.n()).done;){var a=n.value;a.pos===e&&(a.index+=1,console.log(a.index))}}catch(c){r.e(c)}finally{r.f()}this.materials.push({type:this.bushes[e].type,x:i.x+i.width/2-l.MATERIAL_WIDTH/2+l.MATERIAL_OFFSET,y:i.y+i.height/2-l.MATERIAL_HEIGHT/2+l.MATERIAL_OFFSET,width:l.MATERIAL_WIDTH,height:l.MATERIAL_HEIGHT,amount:this.selectedPath.length,pos:e,index:0}),this.materials.sort(this.materialSortFunc);var o,s=D(this.selectedPath);try{for(s.s();!(o=s.n()).done;){var h=o.value;this.regrowBush(h,!0)}}catch(c){s.e(c)}finally{s.f()}if(t)qt(this.bushes)||Qt(this.layoutData,this.bushes)}}}}},{key:"process",value:function(){if(this.uiState.uiInputStatus!==f.OPEN_UI_ENDGAME){if(this.justTouched?this.justTouched=!1:this.inputHandler.isTouched()?this.canTriggerJustTouched&&(this.justTouched=!0,this.canTriggerJustTouched=!1):(this.justTouched=!1,this.canTriggerJustTouched=!0),!this.inputHandler.isTouched())return this.spawnMaterial(),this.currentBushIdx=-1,void(this.selectedPath.length=0);this.uiState.boardInputType===u.TOUCH_TO_MATCH?this.processTouchSelectBushes():this.processSlideSelectBushes()}}}]),i}(E.xP),pt=N(ft.prototype,"layoutData",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vt=N(ft.prototype,"inputHandler",[ht],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gt=N(ft.prototype,"selectedPath",[lt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yt=N(ft.prototype,"bushes",[ut],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mt=N(ft.prototype,"uiState",[ct],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wt=N(ft.prototype,"materials",[dt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ft),$t=(Mt=(0,E.tB)("player"),bt=(0,E.tB)("bushes"),xt=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return L(t=e.call.apply(e,[this].concat(r)),"player",Tt,C(t)),L(t,"bushes",St,C(t)),t}return s(i,[{key:"process",value:function(){var t,e=this.player,i=D(this.bushes);try{for(i.s();!(t=i.n()).done;){var n=t.value;!e.arrived&&Xt(e.position,n.x,n.y,n.width,n.height)&&(n.jiggleTime=l.BUSH_JIGGLE_TIME)}}catch(r){i.e(r)}finally{i.f()}}}]),i}(E.xP),Tt=N(xt.prototype,"player",[Mt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),St=N(xt.prototype,"bushes",[bt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xt),te=new a.Color(1,1,1,.8),ee=function(t){z(i,t);var e=F(i);function i(t){var n,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10920;return h(this,i),(n=e.call(this,t,r,o)).previousColor=new a.Color(1,1,1,1),n.tmpColor=new a.Color(1,1,1,1),n.setShader(new a.Shader(t,i.VS,i.FS)),n}return s(i,[{key:"normalizeColorNumber",value:function(t){return~~(255*(t=a.MathUtils.clamp(t,.1,.9)))}},{key:"setOutlineInfo",value:function(t,e,i){if(!t)return this.setColor(this.previousColor),void this.previousColor.setFromColor(a.Color.WHITE);if(e){this.previousColor.setFromColor(this.color);var n=a.NumberUtil.colorToFloat(this.normalizeColorNumber(e.r),this.normalizeColorNumber(e.g),this.normalizeColorNumber(e.b),this.normalizeColorNumber(e.a));i=i||2.5,this.tmpColor.unsafeSet(n,i,0,0),this.setColor(this.tmpColor)}}}]),i}(a.PolygonBatch);ee.VS="\n    #ifdef GL_ES\n      #define LOWP lowp\n      precision highp float;\n    #else\n      #define LOWP\n    #endif\n    attribute vec4 ".concat(a.Shader.POSITION,";\n    attribute vec4 ").concat(a.Shader.COLOR,";\n    attribute vec2 ").concat(a.Shader.TEXCOORDS,";\n    uniform mat4 ").concat(a.Shader.MVP_MATRIX,";\n    varying vec4 v_color;\n    varying vec2 v_texCoords;\n\n    void main () {\n      v_color = ").concat(a.Shader.COLOR,";\n      v_texCoords = ").concat(a.Shader.TEXCOORDS,";\n      gl_Position = ").concat(a.Shader.MVP_MATRIX," * ").concat(a.Shader.POSITION,";\n    }\n  "),ee.FS="\n    #ifdef GL_ES\n      #define LOWP lowp\n      precision highp float;\n    #else\n      #define LOWP\n    #endif\n    varying vec4 v_color;\n    varying vec2 v_texCoords;\n    uniform sampler2D u_texture;\n    uniform mat4 ".concat(a.Shader.MVP_MATRIX,";\n\n    #define FLOAT_MAX  1.70141184e38\n    #define FLOAT_MIN  1.17549435e-38\n\n    lowp vec4 encode_float(highp float v) {\n      highp float av = abs(v);\n\n      //Handle special cases\n      if(av < FLOAT_MIN) {\n        return vec4(1.0, 1.0, 1.0, 1.0);\n      } else if(v > FLOAT_MAX) {\n        return vec4(127.0, 128.0, 0.0, 0.0) / 255.0;\n      } else if(v < -FLOAT_MAX) {\n        return vec4(255.0, 128.0, 0.0, 0.0) / 255.0;\n      }\n\n      highp vec4 c = vec4(0,0,0,0);\n\n      //Compute exponent and mantissa\n      highp float e = floor(log2(av));\n      highp float m = av * pow(2.0, -e) - 1.0;\n      \n      //Unpack mantissa\n      c[1] = floor(128.0 * m);\n      m -= c[1] / 128.0;\n      c[2] = floor(32768.0 * m);\n      m -= c[2] / 32768.0;\n      c[3] = floor(8388608.0 * m);\n      \n      //Unpack exponent\n      highp float ebias = e + 127.0;\n      c[0] = floor(ebias / 2.0);\n      ebias -= c[0] * 2.0;\n      c[1] += floor(ebias) * 128.0; \n\n      //Unpack sign bit\n      c[0] += 128.0 * step(0.0, -v);\n\n      //Scale back to range\n      return c / 256.0;\n    }\n\n\n    void main () {\n      float a = v_color.a;\n      if (a != 0.0) {\n        gl_FragColor = v_color * texture2D(u_texture, v_texCoords);\n        return;\n      }\n      vec4 outlineColor = encode_float(v_color.r);\n\n      const float Pi = 6.28318530718; // Pi*2\n    \n      // GAUSSIAN BLUR SETTINGS {{{\n      const float Directions = 16.0; // BLUR DIRECTIONS (Default 16.0 - More is better but slower)\n      const float Quality = 4.0; // BLUR QUALITY (Default 4.0 - More is better but slower)\n      float Size = v_color.g; // BLUR SIZE (Radius)\n      // GAUSSIAN BLUR SETTINGS }}}\n     \n      vec4 Radius4 = ").concat(a.Shader.MVP_MATRIX," * vec4(Size, Size, 0.0, 0.0);\n      vec2 Radius = Radius4.xy;\n      \n      // Normalized pixel coordinates (from 0 to 1)\n      vec2 uv = v_texCoords;\n      // Pixel colour\n      vec4 Color = texture2D(u_texture, uv);\n      \n      // Blur calculations\n      for( float d=0.0; d<Pi; d+=Pi/Directions)\n      {\n        for(float i=1.0/Quality; i<=1.0; i+=1.0/Quality)\n        {\n          Color += texture2D( u_texture, uv+vec2(cos(d),sin(d))*Radius*i);\t\t\n        }\n      }\n      \n      // Output to screen\n      Color /= Quality * Directions - 15.0;\n      gl_FragColor = outlineColor * Color.a;\n    }\n  ");var ie,ne,re,ae,oe,se,he,le,ue,ce,de,fe,pe,ve,ge,ye,me,we,Me,be,xe,Te,Se,ke,_e,Ie,Ee,Re,Ae,Pe,Oe,De,Le,Ce,Be,ze,He=(kt=(0,E.tB)("bushes"),_t=(0,E.tB)("sortedDrawingSystem"),It=(0,E.tB)("assetManager"),Et=(0,E.tB)("batch"),Rt=(0,E.tB)("selectedPath"),At=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return L(t=e.call.apply(e,[this].concat(r)),"bushes",Pt,C(t)),L(t,"sortedDrawingSystem",Ot,C(t)),L(t,"assetManager",Dt,C(t)),L(t,"outlineBatch",Lt,C(t)),L(t,"selectedPath",Ct,C(t)),t.bushRegions=[],t.bushAnims=[],t}return s(i,[{key:"initialized",value:function(){var t=this,e=this.assetManager.getAtlas("bush_animation");[0,1,2,3].forEach((function(i){t.bushRegions[i]=e.findRegions("bush_0".concat(i+1)),t.bushAnims[i]=new a.Animation(t.bushRegions[i],1/30)}))}},{key:"process",value:function(){var t,e=this.sortedDrawingSystem,i=this.bushes,n=this.bushRegions,r=this.bushAnims,o=this.world,s=this.outlineBatch,h=o.delta;s.begin();for(var u=0;u<i.length;u++){var c=i[u],d=0,f=c.type;if(c.disappearTime>0)c.disappearTime-=h,d=Kt(1,0,(l.BUSH_DISAPPEAR_TIME-c.disappearTime)/l.BUSH_DISAPPEAR_TIME),void 0!==c.previousType&&(f=c.previousType);else{if(c.disappearTime=0,c.growDelay>0){c.growDelay-=h;continue}c.growDelay=0,c.growTime>0?c.growTime-=h:c.growTime=0,d=Kt(0,1,0===(t=(l.BUSH_GROW_TIME-c.growTime)/l.BUSH_GROW_TIME)?0:1===t?1:Math.pow(2,-10*t)*Math.sin((t-.1)*(2*Math.PI)/.4)+1)}var p=n[f][0];c.jiggleTime>0?(c.jiggleTime-=h,c.stateTime+=h,p=r[f].getKeyFrame(c.stateTime,a.PlayMode.LOOP)):c.stateTime=0,e.deferDraw(p,c.x,c.y,c.width,c.height,c.y+c.height,c.width/2,c.height,0,d,d),this.selectedPath.includes(u)&&e.deferDraw(p,c.x,c.y+5,c.width,c.height,c.y+c.height-.2,c.width/2,c.height,0,1.1*d,1.1*d,a.Color.WHITE,!0,te,2)}s.end()}}]),i}(E.xP),Pt=N(At.prototype,"bushes",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ot=N(At.prototype,"sortedDrawingSystem",[_t],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dt=N(At.prototype,"assetManager",[It],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lt=N(At.prototype,"outlineBatch",[Et],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ct=N(At.prototype,"selectedPath",[Rt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),At),Ve={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.sin((1-t)*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.sin(Math.PI*(.5-t)))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return 1===t?1:t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return 0===t?0:--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-Ve.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*Ve.Bounce.In(2*t):.5*Ve.Bounce.Out(2*t-1)+.5}},generatePow:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4;return t=(t=t<Number.EPSILON?Number.EPSILON:t)>1e4?1e4:t,{In:function(e){return Math.pow(e,t)},Out:function(e){return 1-Math.pow(1-e,t)},InOut:function(e){return e<.5?Math.pow(2*e,t)/2:(1-Math.pow(2-2*e,t))/2+.5}}}},Fe=Ve,Ne=function(t){var e=t.currentTime%(t.duration+t.rest);if(e>t.duration)return 0;var i=t.duration/t.count,n=!0;Math.floor(e/i)%2===0&&(n=!1);var r=e%i,a=t.maxOffset;return a=Kt(a,0,e/t.duration),n?Kt(a,-a,Fe.Quadratic.InOut(r/i)):Kt(-a,a,Fe.Quadratic.InOut(r/i))},Ge=(ie=(0,E.tB)("assetManager"),ne=(0,E.tB)("dishes"),re=(0,E.tB)("uiState"),ae=(0,E.tB)("sortedDrawingSystem"),oe=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return L(t=e.call.apply(e,[this].concat(r)),"assetManager",se,C(t)),L(t,"dishes",he,C(t)),L(t,"uiState",le,C(t)),L(t,"sortedDrawingSystem",ue,C(t)),t.atlas=void 0,t.dishRegion=void 0,t.dishDrawWidth=0,t.dishDrawHeight=0,t.tempVec=new a.Vector2(0,0),t}return s(i,[{key:"initialized",value:function(){this.atlas=this.assetManager.getAtlas("ingredient"),this.dishRegion=this.atlas.findRegion("dish")}},{key:"calculateDrawSize",value:function(t,e){return this.tempVec.set(0,0),e.width>e.height?(this.tempVec.x=t,this.tempVec.y=this.tempVec.x/e.originalWidth*e.originalHeight):(this.tempVec.y=t,this.tempVec.x=this.tempVec.y/e.originalHeight*e.originalWidth),this.tempVec}},{key:"drawIngredient",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.sortedDrawingSystem.deferDraw(t,i.x+i.width/2-e.x/2+n,i.y+i.height/2-e.y/2+r,e.x,e.y,i.y+1,e.x/2,e.y/2)}},{key:"drawOneItem",value:function(t,e,i){var n=this.atlas.findRegion(t);if(n){var r=this.calculateDrawSize(55,n);n&&this.drawIngredient(n,r,e,i,.1*-e.height)}}},{key:"drawTwoItems",value:function(t,e,i){var n,r=0,a=D(t);try{for(a.s();!(n=a.n()).done;){var o=n.value,s=this.atlas.findRegion(o);if(s){var h=this.calculateDrawSize(27,s);s&&this.drawIngredient(s,h,e,.175*-e.width+r*e.width*.35+i),r++}}}catch(l){a.e(l)}finally{a.f()}}},{key:"drawDish",value:function(t,e){if(this.sortedDrawingSystem.deferDraw(this.dishRegion,t.x+e,t.y,t.width,t.height,t.y),void 0===t.item){if(0===t.ingredients.length)return;(1===t.ingredients.length||2===t.ingredients.length)&&this.drawTwoItems(t.ingredients,t,e)}else this.drawOneItem(t.item,t,e)}},{key:"process",value:function(){for(var t=0;t<this.dishes.length;t++){var e=this.dishes[t],i=this.uiState.dishShakes.get(t),n=0;void 0!==i&&(n=Ne(i)),this.drawDish(e,n)}}}]),i}(E.xP),se=N(oe.prototype,"assetManager",[ie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),he=N(oe.prototype,"dishes",[ne],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),le=N(oe.prototype,"uiState",[re],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ue=N(oe.prototype,"sortedDrawingSystem",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oe),je=(ce=(0,E.tB)("uiState"),de=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return L(t=e.call.apply(e,[this].concat(r)),"uiState",fe,C(t)),t}return s(i,[{key:"process",value:function(){var t=this;this.uiState.toolShakes.forEach((function(e,i){!e.loop&&e.currentTime>=e.duration?t.uiState.toolShakes.delete(i):e.currentTime+=t.world.delta})),this.uiState.dishShakes.forEach((function(e,i){!e.loop&&e.currentTime>=e.duration?t.uiState.dishShakes.delete(i):e.currentTime+=t.world.delta})),this.uiState.orderEffects.forEach((function(e,i){e.remainingTime-=t.world.delta,e.remainingTime<=0&&t.uiState.orderEffects.delete(i)}))}}]),i}(E.xP),fe=N(de.prototype,"uiState",[ce],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),de),We=(pe=(0,E.tB)("assetManager"),ve=(0,E.tB)("sortedDrawingSystem"),ge=(0,E.tB)("uiState"),ye=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return L(t=e.call.apply(e,[this].concat(r)),"assetManager",me,C(t)),L(t,"sortedDrawingSystem",we,C(t)),L(t,"uiState",Me,C(t)),t.effectAnimations=new Map,t}return s(i,[{key:"initialized",value:function(){var t=this.assetManager.getAtlas("bubble");this.effectAnimations.set("smoke",new a.Animation(t.findRegions("smoke"),1/30))}},{key:"process",value:function(){for(var t=this.uiState.effects,e=t.length-1;e>=0;e--){var i=t[e];i.remainingTime-=this.world.delta,i.remainingTime<=0&&t.splice(e,1)}var n,r=D(t);try{for(r.s();!(n=r.n()).done;){var o,s=n.value,h=null===(o=this.effectAnimations.get(s.type))||void 0===o?void 0:o.getKeyFrame(s.duration-s.remainingTime,a.PlayMode.NORMAL);h&&this.sortedDrawingSystem.deferDraw(h,s.x,s.y,s.width,s.height,s.order)}}catch(l){r.e(l)}finally{r.f()}}}]),i}(E.xP),me=N(ye.prototype,"assetManager",[pe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),we=N(ye.prototype,"sortedDrawingSystem",[ve],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Me=N(ye.prototype,"uiState",[ge],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ye);function Ue(t){return function(t){if(Array.isArray(t))return A(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||P(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Ye,Xe=40,Ke=(be=(0,E.tB)("batch"),xe=(0,E.tB)("assetManager"),Te=(0,E.tB)("sortedDrawingSystem"),Se=(0,E.tB)("layoutData"),ke=(0,E.tB)("inventory"),_e=(0,E.tB)("uiState"),Ie=(0,E.tB)("inputHandler"),Ee=(0,E.tB)("tools"),Re=function(t){z(i,t);var e=F(i);function i(){var t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return h(this,i),(t=e.call(this)).before=n,L(t,"batch",Ae,C(t)),L(t,"assetManager",Pe,C(t)),L(t,"sortedDrawingSystem",Oe,C(t)),L(t,"layoutData",De,C(t)),L(t,"inventory",Le,C(t)),L(t,"uiState",Ce,C(t)),L(t,"inputHandler",Be,C(t)),L(t,"tools",ze,C(t)),t.atlas=void 0,t.uiAtlas=void 0,t.fromVector=new a.Vector2(0,0),t.toVector=new a.Vector2(0,0),t.drawPos=new a.Vector2(0,0),t.color=new a.Color(1,1,1,1),t}return s(i,[{key:"initialized",value:function(){this.atlas=this.assetManager.getAtlas("ingredient"),this.uiAtlas=this.assetManager.getAtlas("ui")}},{key:"drawItem",value:function(t,e){var i=this.atlas.findRegion(t);if(i){var n,r=Xe,a=Xe;i.width>i.height?a=(r=Xe)/i.originalWidth*i.originalHeight:r=(a=Xe)/i.originalHeight*i.originalWidth;var o,s=D(this.uiState.inventoryTransitions);try{for(s.s();!(o=s.n()).done;){var h=o.value;h.index===e&&(n=h)}}catch(d){s.e(d)}finally{s.f()}var u=this.layoutData.inventory.y+this.layoutData.inventory.height+1;if(this.uiState.draggingIndex===e){var c=this.inputHandler.getTouchedWorldCoord();this.drawPos.set(c.x-r/2,c.y-a/2),u=1e4}else this.drawPos.set(this.layoutData.inventorySlots[e].x-r/2,this.layoutData.inventorySlots[e].y-a/2),n&&(this.fromVector.set(n.fromX,n.fromY),this.toVector.setVector(this.drawPos),Ut(this.drawPos,this.fromVector,this.toVector,Fe.Quartic.Out(1-n.remainingTime/l.INVENTORY_TRANSITION_TIME)));this.sortedDrawingSystem.deferDraw(i,this.drawPos.x,this.drawPos.y,r,a,u)}}},{key:"drawToolPickingTransition",value:function(t){var e=this.atlas.findRegion(t.itemCode);if(e){var i=Xe,n=Xe;e.width>e.height?n=(i=Xe)/e.originalWidth*e.originalHeight:i=(n=Xe)/e.originalHeight*e.originalWidth;var r=this.layoutData.inventory.y+this.layoutData.inventory.height+1;this.drawPos.set(this.layoutData.inventorySlots[t.itemIndex].x-i/2,this.layoutData.inventorySlots[t.itemIndex].y-n/2);var a=this.tools[t.toolIndex],o=a.x+a.width/2,s=a.y+a.height/2;this.toVector.set(o,s),this.fromVector.setVector(this.drawPos),Ut(this.drawPos,this.fromVector,this.toVector,Fe.Quartic.Out(1-t.remainingTime/l.TOOL_PICKING_TRANSITION_TIME)),this.sortedDrawingSystem.deferDraw(e,this.drawPos.x,this.drawPos.y,i,n,r)}}},{key:"process",value:function(){if(this.before){for(var t=this.uiState.inventoryTransitions,e=t.length-1;e>=0;e--){var i=t[e];i.remainingTime-=this.world.delta,i.remainingTime<=0&&t.splice(e,1)}for(var n=this.uiState.toolPickingTransitions,r=n.length-1;r>=0;r--){var a=n[r];a.remainingTime-=this.world.delta,a.remainingTime<=0&&n.splice(r,1)}for(var o=this.uiState.purchaseErrorShakingEffect,s=o.length-1;s>=0;s--){var h=o[s];h.remainingTime-=this.world.delta,h.remainingTime<=0&&o.splice(s,1)}}var u=!0;if(this.uiState.toolInputStatus===Ci.OPEN_SHOP&&this.before&&(u=!1),this.uiState.toolInputStatus===Ci.OPEN_SHOP||this.before||(u=!1),u){var c,d=0,f=D(this.uiState.purchaseErrorShakingEffect);try{for(f.s();!(c=f.n()).done;){var p=c.value;"inventory"===p.target&&(d=p.remainingTime)}}catch(x){f.e(x)}finally{f.f()}var v=1;d>0?(v=Kt(1,1.2,Fe.Bounce.Out(d/l.PURCHASE_ERROR_SHAKING_TIME)),this.color.set(1,2.5*(1.2-v)+.5,2.5*(1.2-v)+.5,1)):this.color.set(1,1,1,1);var g=this.uiAtlas.findRegion("inventory_bar",-1);g&&this.sortedDrawingSystem.deferDraw(g,this.layoutData.inventory.x,this.layoutData.inventory.y,this.layoutData.inventory.width,this.layoutData.inventory.height,this.layoutData.inventory.y+this.layoutData.inventory.height,this.layoutData.inventory.width/2,this.layoutData.inventory.height/2,0,1,v,this.color);for(var y=0;y<this.inventory.slots.length;y++){var m=this.inventory.slots[y];void 0!==m&&this.drawItem(m,y)}var w,M=D(this.uiState.toolPickingTransitions);try{for(M.s();!(w=M.n()).done;){var b=w.value;this.drawToolPickingTransition(b)}}catch(x){M.e(x)}finally{M.f()}}}}]),i}(E.xP),Ae=N(Re.prototype,"batch",[be],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pe=N(Re.prototype,"assetManager",[xe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oe=N(Re.prototype,"sortedDrawingSystem",[Te],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),De=N(Re.prototype,"layoutData",[Se],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Le=N(Re.prototype,"inventory",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ce=N(Re.prototype,"uiState",[_e],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Be=N(Re.prototype,"inputHandler",[Ie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ze=N(Re.prototype,"tools",[Ee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Re);!function(t){t[t.Point=0]="Point",t[t.Line=1]="Line",t[t.Filled=4]="Filled"}(Ye||(Ye={}));var qe,Qe,Je,Ze,$e,ti,ei,ii,ni,ri,ai,oi,si,hi,li,ui,ci,di,fi,pi,vi,gi,yi,mi,wi,Mi,bi,xi,Ti,Si,ki,_i,Ii,Ei,Ri,Ai,Pi,Oi,Di,Li,Ci,Bi,zi="\n  #ifdef GL_ES\n    #define LOWP lowp\n    precision mediump float;\n  #else\n    #define LOWP\n  #endif\n  attribute vec4 ".concat(a.Shader.POSITION,";\n  uniform mat4 ").concat(a.Shader.MVP_MATRIX,";\n  varying vec4 v_pos;\n\n  void main () {\n    gl_Position = ").concat(a.Shader.MVP_MATRIX," * ").concat(a.Shader.POSITION,";\n    v_pos = ").concat(a.Shader.POSITION,";\n  }\n"),Hi="\n  #ifdef GL_ES\n    #define LOWP lowp\n    precision mediump float;\n  #else\n    #define LOWP\n  #endif\n  uniform mat4 ".concat(a.Shader.MVP_MATRIX,";\n  uniform vec4 u_center;\n  uniform vec4 u_color;\n  uniform float u_clearRadius;\n  uniform float u_dimRadius;\n\n  varying vec4 v_pos;\n  \n  void main () {\n    float alpha, dist;\n\n    dist = distance(u_center, v_pos);\n\n    alpha = u_color.a;\n    if (dist <= u_clearRadius) {\n      alpha = 0.0;\n    } else if (dist <= u_dimRadius) {\n      alpha = mix(0.0, u_color.a, (dist - u_clearRadius) / (u_dimRadius - u_clearRadius));\n    }\n    gl_FragColor = vec4(u_color.rgb, alpha);\n  }\n"),Vi=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10920;if(h(this,t),this.context=void 0,this.isDrawing=!1,this.mesh=void 0,this.shapeType=Ye.Filled,this.color=new a.Color(0,0,0,.6),this.shader=void 0,this.vertexIndex=0,this.srcColorBlend=void 0,this.srcAlphaBlend=void 0,this.dstBlend=void 0,this.projectionValues=new Float32Array(16),this.x=0,this.y=0,this.clearRadius=0,this.dimRadius=0,i>10920)throw new Error("Can't have more than 10920 triangles per batch: "+i);this.context=e,this.mesh=new a.Mesh(e,[new a.Position2Attribute],i,0);var n=this.context;this.srcColorBlend=n.SRC_ALPHA,this.srcAlphaBlend=n.ONE,this.dstBlend=n.ONE_MINUS_SRC_ALPHA,this.shader=new a.Shader(n,zi,Hi)}return s(t,[{key:"setProjection",value:function(t){this.projectionValues=t}},{key:"begin",value:function(){if(this.isDrawing)throw new Error("ShapeRenderer.begin() has already been called");this.vertexIndex=0,this.isDrawing=!0,this.shader.bind(),this.shader.setUniform4x4f(a.Shader.MVP_MATRIX,this.projectionValues),this.shader.setUniform4f("u_color",this.color.r,this.color.g,this.color.b,this.color.a),this.shader.setUniform4f("u_center",this.x,this.y,0,0),this.shader.setUniformf("u_clearRadius",this.clearRadius),this.shader.setUniformf("u_dimRadius",this.dimRadius);var t=this.context;t.enable(t.BLEND),t.blendFuncSeparate(this.srcColorBlend,this.dstBlend,this.srcAlphaBlend,this.dstBlend)}},{key:"setBlendMode",value:function(t,e,i){(this.srcColorBlend=t,this.srcAlphaBlend=e,this.dstBlend=i,this.isDrawing)&&(this.flush(),this.context.blendFuncSeparate(t,i,e,i))}},{key:"setColor",value:function(t){this.color.setFromColor(t)}},{key:"setColorWith",value:function(t,e,i,n){this.color.set(t,e,i,n)}},{key:"setHighlightInfo",value:function(t,e,i,n){this.x=t,this.y=e,this.clearRadius=i,this.dimRadius=n}},{key:"quad",value:function(t,e,i,n,r,a,o,s,h){this.check(t?Ye.Filled:Ye.Line,3),t?(this.vertex(e,i),this.vertex(n,r),this.vertex(a,o),this.vertex(a,o),this.vertex(s,h),this.vertex(e,i)):(this.vertex(e,i),this.vertex(n,r),this.vertex(n,r),this.vertex(a,o),this.vertex(a,o),this.vertex(s,h),this.vertex(s,h),this.vertex(e,i))}},{key:"rect",value:function(t,e,i,n,r){this.quad(t,e,i,e+n,i,e+n,i+r,e,i+r)}},{key:"vertex",value:function(t,e){var i=this.vertexIndex,n=this.mesh.getVertices();n[i++]=t,n[i++]=e,this.vertexIndex=i}},{key:"end",value:function(){if(!this.isDrawing)throw new Error("ShapeRenderer.begin() has not been called");this.flush();var t=this.context;t.disable(t.BLEND),this.isDrawing=!1}},{key:"flush",value:function(){0!==this.vertexIndex&&(this.mesh.setVerticesLength(this.vertexIndex),this.mesh.draw(this.shader,this.shapeType),this.vertexIndex=0)}},{key:"check",value:function(t,e){if(!this.isDrawing)throw new Error("ShapeRenderer.begin() has not been called");if(this.shapeType===t){if(!(this.mesh.maxVertices()-this.mesh.numVertices()<e))return;this.flush()}else this.flush(),this.shapeType=t}},{key:"dispose",value:function(){this.mesh.dispose()}}]),t}(),Fi=-Math.PI/2,Ni=-Math.PI/4,Gi=90,ji=Math.PI/2*1.75,Wi=Math.PI/6,Ui=155,Yi=new a.Vector2(0,0),Xi=function(t){for(var e=t.x+t.width/2+6,i=t.y+t.height/2+18,n=[],r=0;r<4;r++)Yi.set(Gi,0).rotateRad(Fi+Ni*r).add(e,i),n.push(Yi.cpy());for(var a=4;a<8;a++)Yi.set(Ui,0).rotateRad(ji+Wi*(a-4)).add(e,i),n.push(Yi.cpy());return n},Ki=67.5,qi=(qe=(0,E.tB)("context"),Qe=(0,E.tB)("assetManager"),Je=(0,E.tB)("uiState"),Ze=(0,E.tB)("camera"),$e=(0,E.tB)("shop"),ti=(0,E.tB)("resources"),ei=(0,E.tB)("levelData"),ii=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return L(t=e.call.apply(e,[this].concat(r)),"gl",ni,C(t)),L(t,"assetManager",ri,C(t)),L(t,"uiState",ai,C(t)),L(t,"camera",oi,C(t)),L(t,"shop",si,C(t)),L(t,"resources",hi,C(t)),L(t,"levelData",li,C(t)),t.overlayRenderer=void 0,t.atlas=void 0,t.materialRegions=void 0,t.font=void 0,t.itemPositions=void 0,t.batch=void 0,t.offsettedItemPositions=void 0,t.color=new a.Color(1,1,1,1),t.timeSinceOpenning=0,t.alphaValues=[],t.lerpVector=new a.Vector2(0,0),t}return s(i,[{key:"initialized",value:function(){this.batch=new a.PolygonBatch(this.gl),this.batch.setYDown(!0),this.font=this.assetManager.getFont("ui"),this.atlas=this.assetManager.getAtlas("ingredient"),this.materialRegions=this.atlas.findRegions("icon"),this.overlayRenderer=new Vi(this.gl),this.itemPositions=Xi(this.shop),this.offsettedItemPositions=function(t,e){for(var i=t.x+t.width/2+6,n=t.y+t.height/2+18,r=[],a=0;a<4;a++)Yi.set(Gi+e,0).rotateRad(Fi+Ni*a).add(i,n),r.push(Yi.cpy());for(var o=4;o<8;o++)Yi.set(Ui+e,0).rotateRad(ji+Wi*(o-4)).add(i,n),r.push(Yi.cpy());return r}(this.shop,-15)}},{key:"dispose",value:function(){this.batch.dispose(),this.overlayRenderer.dispose()}},{key:"drawAmount",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.color.set(1,1,1,n),t.amount>this.resources.amount[t.material]&&this.color.set(1,.3,.3,n),this.batch.setColor(this.color),this.font.draw(this.batch,t.amount.toString(),e,i+20,15),this.batch.setColor(a.Color.WHITE)}},{key:"drawBadge",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.color.set(1,1,1,n),this.batch.setColor(this.color);var r=this.atlas.findRegion("merchant_menu",2),o=33,s=o*r.height/r.width;null===r||void 0===r||r.draw(this.batch,e-o/2,i-s/2+25,o,s);var h=this.materialRegions[t.material];h.draw(this.batch,e-o/2-3,i-1.3*s/2+25,1.3*s,1.3*s),this.batch.setColor(a.Color.WHITE)}},{key:"drawPurchase",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.color.set(1,1,1,n),this.batch.setColor(this.color);var r=this.atlas.findRegion(t.item),o=this.atlas.findRegion("merchant_menu",1);if(r){var s=0,h=0;r.width>r.height?h=(s=45)/r.originalWidth*r.originalHeight:s=(h=45)/r.originalHeight*r.originalWidth,null===o||void 0===o||o.draw(this.batch,e-33.75,i-33.75,Ki,Ki,33.75,33.75),null===r||void 0===r||r.draw(this.batch,e-s/2,i-h/2,s,h),this.batch.setColor(a.Color.WHITE)}}},{key:"process",value:function(){var t,e;if(this.uiState.toolInputStatus===Ci.OPEN_SHOP){var i=this.shop.x+this.shop.width/2+6,n=this.shop.y+this.shop.height/2+18;this.overlayRenderer.setProjection(this.camera.combined),this.overlayRenderer.setHighlightInfo(i,n,Gi,Ui),this.overlayRenderer.begin(),this.overlayRenderer.rect(!0,l.BG_OFFSET,0,l.BG_WIDTH,l.BG_HEIGHT),this.overlayRenderer.end(),this.timeSinceOpenning+=this.world.delta;for(var r=0;r<8;r++){var a=Math.max(this.timeSinceOpenning-.05*r,0);this.alphaValues[r]=Math.min(1,Kt(0,1,a/.1))}this.batch.setProjection(this.camera.combined),this.batch.begin();var o=this.levelData.shopItems;null===(t=this.atlas.findRegion("shop_deco_small"))||void 0===t||t.draw(this.batch,i-Gi,n-Gi,180,180,Gi,Gi,this.timeSinceOpenning*Math.PI/20,this.alphaValues[2],this.alphaValues[2]),null===(e=this.atlas.findRegion("shop_deco"))||void 0===e||e.draw(this.batch,i-Ui,n-Ui,310,310,Ui,Ui,-this.timeSinceOpenning*Math.PI/20,this.alphaValues[6],this.alphaValues[6]);for(var s=0;s<4;s++){var h=o[s];if(h){var u=Ut(this.lerpVector,this.offsettedItemPositions[s],this.itemPositions[s],Fe.Quadratic.In(this.alphaValues[s]));this.drawPurchase(h,u.x,u.y,this.alphaValues[s])}}for(var c=4;c<8;c++){var d=o[c];if(d){var f=Ut(this.lerpVector,this.offsettedItemPositions[c],this.itemPositions[c],Fe.Quadratic.In(this.alphaValues[c]));this.drawPurchase(d,f.x,f.y,this.alphaValues[c])}}for(var p=0;p<4;p++){var v=o[p];if(v){var g=Ut(this.lerpVector,this.offsettedItemPositions[p],this.itemPositions[p],Fe.Quadratic.In(this.alphaValues[p]));this.drawBadge(v,g.x,g.y,this.alphaValues[p])}}for(var y=4;y<8;y++){var m=o[y];if(m){var w=Ut(this.lerpVector,this.offsettedItemPositions[y],this.itemPositions[y],Fe.Quadratic.In(this.alphaValues[y]));this.drawBadge(m,w.x,w.y,this.alphaValues[y])}}this.font.getData().setXYScale(.7);for(var M=0;M<4;M++){var b=o[M];if(b){var x=Ut(this.lerpVector,this.offsettedItemPositions[M],this.itemPositions[M],Fe.Quadratic.In(this.alphaValues[M]));this.drawAmount(b,x.x,x.y,this.alphaValues[M])}}for(var T=4;T<8;T++){var S=o[T];if(S){var k=Ut(this.lerpVector,this.offsettedItemPositions[T],this.itemPositions[T],Fe.Quadratic.In(this.alphaValues[T]));this.drawAmount(S,k.x,k.y,this.alphaValues[T])}}this.font.getData().setXYScale(1),this.batch.end()}else this.timeSinceOpenning=0}}]),i}(E.xP),ni=N(ii.prototype,"gl",[qe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ri=N(ii.prototype,"assetManager",[Qe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ai=N(ii.prototype,"uiState",[Je],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oi=N(ii.prototype,"camera",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),si=N(ii.prototype,"shop",[$e],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hi=N(ii.prototype,"resources",[ti],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),li=N(ii.prototype,"levelData",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ii);!function(t){t[t.NORMAL=0]="NORMAL",t[t.OPEN_SHOP=1]="OPEN_SHOP",t[t.DRAGGING_FOOD=2]="DRAGGING_FOOD"}(Ci||(Ci={})),function(t){t[t.COMBINE_SUCCESS=0]="COMBINE_SUCCESS",t[t.INGREDIENT_RECEIVED=1]="INGREDIENT_RECEIVED",t[t.INGREDIENT_REJECTED=2]="INGREDIENT_REJECTED"}(Bi||(Bi={}));var Qi,Ji,Zi,$i,tn,en,nn,rn,an,on,sn,hn,ln,un,cn,dn,fn,pn,vn,gn,yn,mn,wn,Mn,bn,xn,Tn,Sn,kn,_n,In,En,Rn,An,Pn,On=(ui=(0,E.tB)("inputHandler"),ci=(0,E.tB)("tools"),di=(0,E.tB)("dishes"),fi=(0,E.tB)("orders"),pi=(0,E.tB)("shop"),vi=(0,E.tB)("uiState"),gi=(0,E.tB)("inventory"),yi=(0,E.tB)("resources"),mi=(0,E.tB)("levelData"),wi=(0,E.tB)("layoutData"),Mi=(0,E.tB)("assetManager"),bi=(0,E.tB)("eventEmitter"),xi=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return L(t=e.call.apply(e,[this].concat(r)),"inputHandler",Ti,C(t)),L(t,"tools",Si,C(t)),L(t,"dishes",ki,C(t)),L(t,"orders",_i,C(t)),L(t,"shop",Ii,C(t)),L(t,"uiState",Ei,C(t)),L(t,"inventory",Ri,C(t)),L(t,"resources",Ai,C(t)),L(t,"levelData",Pi,C(t)),L(t,"layoutData",Oi,C(t)),L(t,"assetManager",Di,C(t)),L(t,"eventEmitter",Li,C(t)),t.tmpVector=new a.Vector2(0,0),t.itemPositions=void 0,t.purchases=void 0,t.tempIndices=[],t.toolCandidates=[],t.toolCandidateIndices=[],t.tmpV2=new a.Vector2(0,0),t.canTriggerJustTouched=!0,t.justTouched=!1,t}return s(i,[{key:"initialized",value:function(){this.purchases=this.levelData.shopItems,this.itemPositions=Xi(this.shop)}},{key:"processPurchase",value:function(t){if(this.resources.amount[t.material]<t.amount)this.uiState.purchaseErrorShakingEffect.push({target:"material",remainingTime:l.PURCHASE_ERROR_SHAKING_TIME});else{for(var e=-1,i=0;i<this.inventory.slots.length;i++){if(void 0===this.inventory.slots[i]){e=i;break}}if(e<0)this.uiState.purchaseErrorShakingEffect.push({target:"inventory",remainingTime:l.PURCHASE_ERROR_SHAKING_TIME});else{this.inventory.slots[e]=t.item,this.resources.amount[t.material]-=t.amount;var n=this.purchases.indexOf(t),r=this.itemPositions[n];this.uiState.inventoryTransitions.push({index:e,fromX:r.x,fromY:r.y,remainingTime:l.INVENTORY_TRANSITION_TIME})}}}},{key:"checkTapOnItem",value:function(){for(var t,e=this.inputHandler.getTouchedWorldCoord(),i=this.itemPositions,n=this.tmpVector,r=1/0,a=0;a<this.purchases.length;a++){var o=i[a],s=n.set(o.x,o.y).distanceSqr(e);s<=Math.pow(33.75,2)&&s<r&&(t=this.purchases[a],r=s)}return!!t&&(this.processPurchase(t),!0)}},{key:"processShopInput",value:function(){var t=this.shop;if(this.uiState.toolInputStatus===Ci.NORMAL){if(this.justTouched){var e=this.inputHandler.getTouchedWorldCoord();Xt(e,t.x,t.y,t.width,t.height)&&(this.uiState.toolInputStatus=Ci.OPEN_SHOP,t.status=d.WORKING,t.stateTime=0)}}else this.uiState.toolInputStatus===Ci.OPEN_SHOP&&this.justTouched&&(this.checkTapOnItem()||(this.uiState.toolInputStatus=Ci.NORMAL,t.status=d.IDLE,t.stateTime=0))}},{key:"checkTapOnInventoryItem",value:function(){for(var t,e=this.inputHandler.getTouchedWorldCoord(),i=this.tmpVector,n=1/0,r=0;r<this.layoutData.inventorySlots.length;r++){var a=this.layoutData.inventorySlots[r],o=i.set(a.x,a.y).distanceSqr(e);o<=Math.pow(40,2)&&o<n&&(t=r,n=o)}return void 0!==t&&(this.uiState.draggingIndex=t,this.uiState.toolInputStatus=Ci.DRAGGING_FOOD,!0)}},{key:"checkTapOnDish",value:function(){for(var t=this.inputHandler.getTouchedWorldCoord(),e=0;e<this.dishes.length;e++){var i=this.dishes[e];if(Xt(t,i.x,i.y,i.width,i.height)){if(void 0!==i.item){var n,r=i.item,a=D(this.orders);try{for(a.s();!(n=a.n()).done;){if(O(n.value,2)[1].dish===r){this.eventEmitter.emit("serveOrder",{dishItem:r}),i.item=void 0,i.ingredients.length=0;break}}}catch(c){a.e(c)}finally{a.f()}if(void 0!==i.item){this.uiState.dishShakes.set(e,{duration:.5,rest:1,currentTime:0,count:6,loop:!1,maxOffset:5})}}else{if(void 0!==i.item||0===i.ingredients.length)return!1;this.tempIndices.length=0;for(var o=-1;-1!==(o=this.inventory.slots.indexOf(void 0,o+1));)this.tempIndices.push(o);if(0===this.tempIndices.length){this.uiState.dishShakes.set(e,{duration:.5,rest:1,currentTime:0,count:6,loop:!1,maxOffset:5})}var s,h=D(this.tempIndices);try{for(h.s();!(s=h.n()).done;){var u=s.value;if(0===i.ingredients.length)break;this.inventory.slots[u]=i.ingredients[0],i.ingredients.shift(),this.uiState.inventoryTransitions.push({index:u,fromX:i.x+i.width/2,fromY:i.y+i.height/2,remainingTime:l.INVENTORY_TRANSITION_TIME})}}catch(c){h.e(c)}finally{h.f()}}return!0}}return!1}},{key:"processInventoryInput",value:function(){this.uiState.toolInputStatus===Ci.NORMAL&&this.justTouched&&!this.checkTapOnInventoryItem()&&(this.uiState.toolInputStatus=Ci.NORMAL),this.uiState.toolInputStatus===Ci.DRAGGING_FOOD&&(this.inputHandler.isTouched()||(this.checkDropToTrashBin()||this.checkDropToDishes()||this.checkDropItemToTool(),this.uiState.toolInputStatus=Ci.NORMAL,this.uiState.draggingIndex=void 0))}},{key:"processDishInput",value:function(){this.uiState.toolInputStatus===Ci.NORMAL&&this.justTouched&&!this.checkTapOnDish()&&(this.uiState.toolInputStatus=Ci.NORMAL)}},{key:"checkDropToTrashBin",value:function(){var t=this.inputHandler.getTouchedWorldCoord();return!!Xt(t,this.layoutData.trash.x,this.layoutData.trash.y,this.layoutData.trash.width,this.layoutData.trash.height)&&(void 0!==this.uiState.draggingIndex&&(this.inventory.slots[this.uiState.draggingIndex]=void 0),this.uiState.effects.push({type:"smoke",x:this.layoutData.trash.x,y:this.layoutData.trash.y,width:this.layoutData.trash.width,height:this.layoutData.trash.width,order:1e3,remainingTime:l.SMOKE_DURATION,duration:l.SMOKE_DURATION}),!0)}},{key:"checkDropToDishes",value:function(){for(var t=this.inputHandler.getTouchedWorldCoord(),e=0;e<this.dishes.length;e++){var i=this.dishes[e],n=1.5*i.width,r=1.5*i.width;if(Xt(t,i.x+i.width/2-n/2,i.y+i.height/2-r/2,n,r))return this.processDropIngredientToDish(i,e),!0}return!1}},{key:"processDropIngredientToDish",value:function(t,e){if(void 0!==this.uiState.draggingIndex&&void 0===t.item){var i=this.inventory.slots[this.uiState.draggingIndex];i&&(t.ingredients.push(i),this.tryCombineIngredients(e)!==Bi.INGREDIENT_REJECTED&&(this.inventory.slots[this.uiState.draggingIndex]=void 0))}}},{key:"tryCombineAllDishes",value:function(){for(var t=0;t<this.dishes.length&&this.tryCombineIngredients(t)!==Bi.COMBINE_SUCCESS;t++);}},{key:"tryCombineIngredients",value:function(t){var e=this.dishes[t],i=Gt.searchOutputDish.apply(Gt,Ue(e.ingredients)),n=!1;if(i){var r,a=D(this.orders);try{for(a.s();!(r=a.n()).done;){if(O(r.value,2)[1].dish===i.outputItemCode){n=!0;break}}}catch(h){a.e(h)}finally{a.f()}if(n){e.item=i.outputItemCode,e.ingredients.length=0;var o=1.5*e.width,s=o/l.SMOKE_WH_RATIO;return this.uiState.effects.push({type:"smoke",x:e.x+e.width/2-o/2,y:e.y+15-s/2,width:o,height:s,duration:l.SMOKE_DURATION,remainingTime:l.SMOKE_DURATION,order:1e3}),Bi.COMBINE_SUCCESS}}if(!n&&e.ingredients.length===l.MAX_INGREDIENTS_IN_DISH){if(e.ingredients.pop(),void 0!==this.uiState.draggingIndex){this.uiState.inventoryTransitions.push({index:this.uiState.draggingIndex,fromX:e.x+e.width/2,fromY:e.y+e.height/2,remainingTime:l.INVENTORY_TRANSITION_TIME});this.uiState.dishShakes.set(t,{duration:.5,rest:1,currentTime:0,count:6,loop:!1,maxOffset:5})}return Bi.INGREDIENT_REJECTED}return Bi.INGREDIENT_RECEIVED}},{key:"processIngredientWithTool",value:function(t,e){var i=this.tools.indexOf(t);if(void 0!==t.type&&t.status!==d.WORKING){var n=this.inventory.slots[e];if(void 0!==n){var r=Nt.searchOutputItem(n,t.type);if(void 0!==r)t.status=d.WORKING,t.stateTime=0,t.requireTime=r.requireTime,t.workingTime=r.requireTime,t.processingIngredient=n,t.resultIngredient=void 0,this.inventory.slots[e]=void 0;else{this.uiState.toolShakes.set(i,{duration:.5,rest:1,currentTime:0,count:6,loop:!1,maxOffset:5})}}}}},{key:"processTapToTool",value:function(){if(this.uiState.toolInputStatus===Ci.NORMAL&&this.justTouched){var t,e=this.inputHandler.getTouchedWorldCoord(),i=D(this.tools);try{for(i.s();!(t=i.n()).done;){var n=t.value;if(Xt(e,n.x,n.y,n.width,n.height))return void(n.locked=!n.locked)}}catch(r){i.e(r)}finally{i.f()}}}},{key:"checkDropItemToTool",value:function(){var t=this.inputHandler.getTouchedWorldCoord();this.toolCandidates.length=0,this.toolCandidateIndices.length=0;for(var e=0;e<this.tools.length;e++){var i=this.tools[e];Xt(t,i.x,i.y,i.width,i.height)&&(this.toolCandidates.push(i),this.toolCandidateIndices.push(e))}if(!(this.toolCandidates.length<=0)){for(var n=1/0,r=0,a=this.toolCandidates[r],o=0;o<this.toolCandidates.length;o++){var s=this.toolCandidates[o],h=this.tmpV2.set(s.x+s.width/2,s.y+s.height/2).distanceSqr(t);h<n&&(a=s,n=h,r=o)}if(void 0!==this.uiState.draggingIndex)if(a.locked){this.uiState.toolShakes.set(r,{duration:.5,rest:1,currentTime:0,count:6,loop:!1,maxOffset:5})}else this.processIngredientWithTool(a,this.uiState.draggingIndex)}}},{key:"process",value:function(){this.uiState.uiInputStatus!==f.OPEN_UI_ENDGAME&&(this.justTouched?this.justTouched=!1:this.inputHandler.isTouched()?this.canTriggerJustTouched&&(this.justTouched=!0,this.canTriggerJustTouched=!1):(this.justTouched=!1,this.canTriggerJustTouched=!0),this.processShopInput(),this.processInventoryInput(),this.processDishInput(),this.processTapToTool())}}]),i}(E.xP),Ti=N(xi.prototype,"inputHandler",[ui],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Si=N(xi.prototype,"tools",[ci],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ki=N(xi.prototype,"dishes",[di],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_i=N(xi.prototype,"orders",[fi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ii=N(xi.prototype,"shop",[pi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ei=N(xi.prototype,"uiState",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ri=N(xi.prototype,"inventory",[gi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ai=N(xi.prototype,"resources",[yi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pi=N(xi.prototype,"levelData",[mi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oi=N(xi.prototype,"layoutData",[wi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Di=N(xi.prototype,"assetManager",[Mi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Li=N(xi.prototype,"eventEmitter",[bi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xi),Dn=(Qi=(0,E.tB)("assetManager"),Ji=(0,E.tB)("sortedDrawingSystem"),Zi=(0,E.tB)("layoutData"),$i=(0,E.tB)("uiState"),tn=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return L(t=e.call.apply(e,[this].concat(r)),"assetManager",en,C(t)),L(t,"sortedDrawingSystem",nn,C(t)),L(t,"layoutData",rn,C(t)),L(t,"uiState",an,C(t)),t.atlas=void 0,t}return s(i,[{key:"initialized",value:function(){this.atlas=this.assetManager.getAtlas("ui")}},{key:"process",value:function(){var t=this.atlas,e=this.layoutData,i=this.sortedDrawingSystem,n=t.findRegion("inventory_bar",-1),r=t.findRegion("trash_bin",-1);this.uiState.toolInputStatus!==Ci.OPEN_SHOP&&n&&i.deferDraw(n,e.inventory.x,e.inventory.y,e.inventory.width,e.inventory.height,e.inventory.y+e.inventory.height),r&&i.deferDraw(r,e.trash.x,e.trash.y,e.trash.width,e.trash.height,e.trash.y+e.trash.height)}}]),i}(E.xP),en=N(tn.prototype,"assetManager",[Qi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nn=N(tn.prototype,"sortedDrawingSystem",[Ji],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rn=N(tn.prototype,"layoutData",[Zi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),an=N(tn.prototype,"uiState",[$i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tn),Ln=(on=(0,E.tB)("player"),sn=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return L(t=e.call.apply(e,[this].concat(r)),"player",hn,C(t)),t.tmpV2=new a.Vector2(0,0),t}return s(i,[{key:"process",value:function(){var t=this.player,e=this.tmpV2,i=this.world.delta;t.stateTime+=i,t.arrived||(t.target.distanceSqr(t.position)<=l.HERO_SPEED*i*l.HERO_SPEED*i?(t.position.setVector(t.target),t.arrived=!0,t.stateTime=0):(e.setVector(t.target).subVector(t.position).nor().scale(l.HERO_SPEED*i),e.x>0?t.flipped=!0:t.flipped=!1,t.position.addVector(e)))}}]),i}(E.xP),hn=N(sn.prototype,"player",[on],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sn),Cn=(ln=(0,E.tB)("player"),un=(0,E.tB)("materials"),cn=(0,E.tB)("layoutData"),dn=(0,E.tB)("resources"),fn=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return L(t=e.call.apply(e,[this].concat(r)),"player",pn,C(t)),L(t,"materials",vn,C(t)),L(t,"layoutData",gn,C(t)),L(t,"resources",yn,C(t)),t.tmpV2=new a.Vector2(0,0),t}return s(i,[{key:"findNearestMaterial",value:function(t,e){var i,n,r=1/0,a=D(e);try{for(a.s();!(n=a.n()).done;){var o=n.value;this.tmpV2.set(o.x+o.width/2,o.y+o.height/2);var s=t.distanceSqr(this.tmpV2);s<r&&(i=o,r=s)}}catch(h){a.e(h)}finally{a.f()}return i}},{key:"process",value:function(){var t=this.player,e=this.materials,i=this.layoutData.spawn;if(t.picking)return t.pickingTime-=this.world.delta,void(t.pickingTime<=0&&(t.pickingTime=0,t.picking=!1,t.collecting=!1));if(t.collecting){var n=this.findNearestMaterial(t.position,e);if(n)if(this.tmpV2.set(n.x+n.width/2,n.y+n.height/2),t.position.distanceSqr(this.tmpV2)<=Math.pow(l.HERO_SPEED*this.world.delta,2)){t.position.setVector(this.tmpV2),t.arrived=!0,t.picking=!0,t.pickingTime=l.HERO_PICKING_TIME,t.holding={type:n.type,amount:n.amount};var r,a=e.indexOf(n),o=D(e);try{for(o.s();!(r=o.n()).done;){var s=r.value;s.pos===n.pos&&s.index>n.index&&(s.index-=1)}}catch(u){o.e(u)}finally{o.f()}e.splice(a,1)}}if(!t.collecting)if(t.holding)this.tmpV2.set(i.x,i.y),t.position.distanceSqr(this.tmpV2)<=Math.pow(l.HERO_SPEED*this.world.delta,2)?(t.position.set(i.x,i.y),t.arrived=!0,t.flipped=!1,t.home=!0,t.holding&&(this.resources.amount[t.holding.type]+=t.holding.amount,t.holding=void 0)):(t.arrived=!1,t.target.set(i.x,i.y));else{var h=this.findNearestMaterial(t.position,e);h&&(t.collecting=!0,t.arrived=!1,t.target.set(h.x+h.width/2,h.y+h.height/2),t.home=!1)}}}]),i}(E.xP),pn=N(fn.prototype,"player",[ln],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vn=N(fn.prototype,"materials",[un],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gn=N(fn.prototype,"layoutData",[cn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yn=N(fn.prototype,"resources",[dn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fn),Bn=(mn=(0,E.tB)("sortedDrawingSystem"),wn=(0,E.tB)("assetManager"),Mn=(0,E.tB)("player"),bn=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return L(t=e.call.apply(e,[this].concat(r)),"sortedDrawingSystem",xn,C(t)),L(t,"assetManager",Tn,C(t)),L(t,"player",Sn,C(t)),t.heroFullRegions=void 0,t.heroHalfRegions=void 0,t.heroFullAnim=void 0,t.heroHalfAnim=void 0,t.pickupAnim=void 0,t.iconRegions=void 0,t.idleAnim=void 0,t}return s(i,[{key:"initialized",value:function(){var t=this.assetManager,e=t.getAtlas("character_animation");this.heroFullRegions=e.findRegions("run_full"),this.heroFullAnim=new a.Animation(this.heroFullRegions,1/30),this.heroHalfRegions=e.findRegions("run_half"),this.heroHalfAnim=new a.Animation(this.heroHalfRegions,1/30);var i=e.findRegions("pick_item");this.pickupAnim=new a.Animation(i,1/30);var n=t.getAtlas("ui");this.iconRegions=n.findRegions("icon");var r=e.findRegions("kit_idle");this.idleAnim=new a.Animation(r,1/15)}},{key:"drawFullHero",value:function(){var t=this.heroFullAnim,e=this.heroFullRegions,i=this.player,n=this.sortedDrawingSystem,r=e[0];i.arrived||(r=t.getKeyFrame(i.stateTime,a.PlayMode.LOOP)),n.deferDraw(r,i.position.x-i.size.x/2,i.position.y-i.size.y,i.size.x,i.size.y,i.position.y+5,i.size.x/2,i.size.y,0,i.flipped?-1:1)}},{key:"drawHeroHalf",value:function(){var t=this.heroHalfAnim,e=this.heroHalfRegions,i=this.player,n=this.sortedDrawingSystem,r=e[0];i.arrived||(r=t.getKeyFrame(i.stateTime,a.PlayMode.LOOP)),n.deferDraw(r,i.position.x-i.size.x/2,i.position.y-i.size.y,i.size.x,i.size.y,1e3,i.size.x/2,i.size.y,0,i.flipped?-1:1)}},{key:"process",value:function(){this.player.home?this.drawHeroIdle():this.player.picking?this.drawHeroPickup():(this.drawHeroHolding(),this.drawFullHero(),this.drawHeroHalf())}},{key:"drawHeroPickup",value:function(){var t=this.pickupAnim,e=this.player,i=this.sortedDrawingSystem,n=t.getKeyFrame(Math.max(l.HERO_PICKING_TIME-e.pickingTime,0),a.PlayMode.NORMAL);i.deferDraw(n,e.position.x-e.size.x/2,e.position.y-e.size.y,e.size.x,e.size.y,1e3,e.size.x/2,e.size.y,0,e.flipped?-1:1),l.HERO_PICKING_TIME-e.pickingTime<0&&this.drawHeroHolding()}},{key:"drawHeroHolding",value:function(){var t=this.player,e=this.sortedDrawingSystem,i=this.iconRegions;t.holding&&e.deferDraw(i[t.holding.type],t.position.x-l.MATERIAL_WIDTH/2,t.position.y-t.size.y-l.MATERIAL_HEIGHT/2,l.MATERIAL_WIDTH,l.MATERIAL_HEIGHT,1001)}},{key:"drawHeroIdle",value:function(){var t=this.idleAnim,e=this.player,i=this.sortedDrawingSystem,n=t.getKeyFrame(e.stateTime,a.PlayMode.LOOP);i.deferDraw(n,e.position.x-e.size.x/2,e.position.y-e.size.y,e.size.x,e.size.y,1e3,e.size.x/2,e.size.y,0,e.flipped?-1:1)}}]),i}(E.xP),xn=N(bn.prototype,"sortedDrawingSystem",[mn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tn=N(bn.prototype,"assetManager",[wn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sn=N(bn.prototype,"player",[Mn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bn),zn=(kn=(0,E.tB)("batch"),_n=(0,E.tB)("assetManager"),In=(0,E.tB)("materials"),En=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return L(t=e.call.apply(e,[this].concat(r)),"batch",Rn,C(t)),L(t,"assetManager",An,C(t)),L(t,"materials",Pn,C(t)),t.regions=[],t.stateTime=0,t.font=void 0,t}return s(i,[{key:"initialized",value:function(){var t=this.assetManager,e=t.getAtlas("ui");this.regions=e.findRegions("icon");var i=t.getFont("ui-outlined");this.font=i}},{key:"process",value:function(){var t=this.batch,e=this.regions,i=this.materials,n=this.font;t.begin(),this.stateTime+=this.world.delta;var r,o=Math.sin(3*this.stateTime)/8+1,s=D(i);try{for(s.s();!(r=s.n()).done;){var h=r.value;0===h.index?(t.setOutlineInfo(!0,te,1),e[h.type].draw(t,h.x,h.y,h.width,h.height,h.width/2,h.height/2,0,1.2*o,1.2*o),t.setOutlineInfo(!1),e[h.type].draw(t,h.x,h.y,h.width,h.height,h.width/2,h.height/2,0,o,o)):h.index<4&&(t.setOutlineInfo(!0,te,1),e[h.type].draw(t,h.x+.1*h.width+h.width*h.index*.2,h.y+.4*h.height,h.width,h.height,h.width/2,h.height/2,0,.5*o*1.2,.5*o*1.2),t.setOutlineInfo(!1),e[h.type].draw(t,h.x+.1*h.width+h.width*h.index*.2,h.y+.4*h.height,h.width,h.height,h.width/2,h.height/2,0,.5*o,.5*o))}}catch(d){s.e(d)}finally{s.f()}n.getData().setXYScale(.36);var l,u=D(i);try{for(u.s();!(l=u.n()).done;){var c=l.value;c.index>0||n.draw(t,"x".concat(c.amount),c.x+c.width-50,c.y-.2*c.height,100,a.Align.center)}}catch(d){u.e(d)}finally{u.f()}this.font.data.setXYScale(1),t.end()}}]),i}(E.xP),Rn=N(En.prototype,"batch",[kn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),An=N(En.prototype,"assetManager",[_n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pn=N(En.prototype,"materials",[In],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),En);function Hn(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Vn(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function Fn(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Vn(Object(i),!0).forEach((function(e){Hn(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Vn(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var Nn=s((function t(){h(this,t)}));Nn.addListener=function(t,e,i){return t.addListener(e,i),function(){return t.removeListener(e,i)}};var Gn,jn,Wn,Un,Yn,Xn,Kn,qn,Qn,Jn,Zn,$n,tr,er,ir,nr,rr,ar,or,sr,hr,lr,ur,cr,dr,fr,pr,vr,gr,yr,mr,wr,Mr,br,xr,Tr,Sr,kr,_r,Ir,Er,Rr,Ar,Pr,Or,Dr,Lr,Cr,Br,zr,Hr,Vr,Fr,Nr,Gr,jr,Wr,Ur,Yr,Xr,Kr,qr,Qr,Jr,Zr,$r,ta,ea,ia,na,ra,aa,oa,sa,ha,la,ua,ca,da,fa,pa,va,ga,ya,ma,wa,Ma,ba,xa,Ta,Sa,ka,_a,Ia,Ea,Ra,Aa,Pa,Oa,Da,La,Ca,Ba,za,Ha,Va,Fa,Na,Ga,ja,Wa,Ua,Ya,Xa,Ka,qa,Qa,Ja,Za,$a,to,eo,io,no,ro,ao,oo,so,ho,lo,uo,co,fo,po,vo,go,yo,mo,wo,Mo,bo,xo,To,So,ko,_o=function(){function t(){h(this,t),this.dishesScore=new Map,this.loadScoreData()}return s(t,[{key:"trimText",value:function(t){return t.replaceAll(" ",""),t}},{key:"loadScoreData",value:function(){var t=r(e().mark((function t(){var i,n,r,a,o,s,h;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("data/dish_data.txt").then((function(t){return t.text()}));case 2:if((i=t.sent)&&0!==i.length){t.next=5;break}return t.abrupt("return");case 5:this.dishesScore.clear(),n=i.split(/\r?\n/),r=D(n);try{for(r.s();!(a=r.n()).done;)o=a.value,s=o.split(","),h=this.trimText(s[0]),this.dishesScore.set(h,{code:h,score:parseInt(this.trimText(s[1])),name:s[2]})}catch(e){r.e(e)}finally{r.f()}case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getDishData",value:function(t){return this.dishesScore.get(t)}},{key:"getScore",value:function(t){var e=this.getDishData(t);return void 0===e?0:e.score}}]),t}(),Io=new _o,Eo=(Gn=(0,E.tB)("orders"),jn=(0,E.tB)("uiState"),Wn=(0,E.tB)("levelData"),Un=(0,E.tB)("levelState"),Yn=(0,E.tB)("eventEmitter"),Xn=(0,E.tB)("toolInputHandlingSystem"),Kn=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return L(t=e.call.apply(e,[this].concat(r)),"orders",qn,C(t)),L(t,"uiState",Qn,C(t)),L(t,"levelData",Jn,C(t)),L(t,"levelState",Zn,C(t)),L(t,"eventEmitter",$n,C(t)),L(t,"toolInputHandlingSystem",tr,C(t)),t.unregisterServeOrderEvent=void 0,t.nextGenerateIdx=0,t.orderQueue=[],t}return s(i,[{key:"initialized",value:function(){var t=this;this.unregisterServeOrderEvent=Nn.addListener(this.eventEmitter,"serveOrder",(function(e){var i=e.dishItem;t.serveOrder(i)}))}},{key:"serveOrder",value:function(t){var e=this.levelState.servedDishes.get(t);void 0!==e&&this.levelState.servedDishes.set(t,e+1);for(var i=0;i<l.TOTAL_ORDERS;i++){var n=this.orders.get(i);if(void 0!==n&&n.dish===t){var r=Io.getScore(t),a=1-(n.duration-n.remainingTime)/(2*n.duration),o=Math.round(a*r);this.levelState.score+=o,this.orders.delete(i);var s={type:"disapear",duration:l.ORDER_EFFECT_TIME,remainingTime:l.ORDER_EFFECT_TIME,orderItem:t};this.uiState.orderEffects.set(i,s);break}}}},{key:"processGenerateOrder",value:function(){if(this.nextGenerateIdx>=this.levelData.orders.length&&0===this.orderQueue.length&&0===this.orders.size)this.levelState.endGame=!0;else if(this.orders.size!==l.TOTAL_ORDERS){for(var t=this.nextGenerateIdx;t<this.levelData.orders.length;t++){var e=this.levelData.orders[t];this.levelState.gameTime>=e.startTime&&this.orderQueue.push(Fn({},e))}for(var i=0;i<l.TOTAL_ORDERS;i++){if(void 0===this.orders.get(i)&&0!==this.orderQueue.length){var n=this.orderQueue.at(0);this.orders.set(i,{dish:n.dish,startTime:n.startTime,duration:n.duration,remainingTime:n.duration}),this.orderQueue.splice(0,1),this.toolInputHandlingSystem.tryCombineAllDishes(),this.nextGenerateIdx++;var r={type:"appear",duration:l.ORDER_EFFECT_TIME,remainingTime:l.ORDER_EFFECT_TIME,orderItem:n.dish};this.uiState.orderEffects.set(i,r);break}}}}},{key:"failToServeOrder",value:function(t,e){var i=Io.getScore(t);this.levelState.score-=i,this.levelState.score<0&&(this.levelState.score=0);var n={type:"disapear",duration:l.ORDER_EFFECT_TIME,remainingTime:l.ORDER_EFFECT_TIME,orderItem:t};this.uiState.orderEffects.set(e,n),this.orders.delete(e)}},{key:"processOrders",value:function(){for(var t=0;t<l.TOTAL_ORDERS;t++){var e=this.orders.get(t);if(void 0!==e){if(e.remainingTime<=0){this.failToServeOrder(e.dish,t);break}e.remainingTime-=this.world.delta}}}},{key:"dispose",value:function(){this.unregisterServeOrderEvent()}},{key:"process",value:function(){this.processOrders(),this.processGenerateOrder()}}]),i}(E.xP),qn=N(Kn.prototype,"orders",[Gn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qn=N(Kn.prototype,"uiState",[jn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jn=N(Kn.prototype,"levelData",[Wn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zn=N(Kn.prototype,"levelState",[Un],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$n=N(Kn.prototype,"eventEmitter",[Yn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tr=N(Kn.prototype,"toolInputHandlingSystem",[Xn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kn),Ro=(er=(0,E.tB)("orders"),ir=(0,E.tB)("layoutData"),nr=(0,E.tB)("assetManager"),rr=(0,E.tB)("uiState"),ar=(0,E.tB)("batch"),or=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return L(t=e.call.apply(e,[this].concat(r)),"orders",sr,C(t)),L(t,"layoutData",hr,C(t)),L(t,"assetManager",lr,C(t)),L(t,"uiState",ur,C(t)),L(t,"batch",cr,C(t)),t.atlas=void 0,t.orderBg=void 0,t.progressBg=void 0,t.processBar=void 0,t.tempColor=a.Color.WHITE,t.fullTimeColor=a.Color.fromString("4dfe9c"),t.endTimeColor=a.Color.fromString("e81010"),t}return s(i,[{key:"initialized",value:function(){this.atlas=this.assetManager.getAtlas("ingredient");var t=this.assetManager.getAtlas("ui");this.orderBg=this.atlas.findRegion("bg_order"),this.progressBg=t.findRegion("progress_bg"),this.processBar=t.findRegion("progress_bar")}},{key:"drawOrder",value:function(t,e,i,n){this.drawOrderBackground(t.dish,e,i,n),Yt(this.tempColor,this.fullTimeColor,this.endTimeColor,Math.min(1-t.remainingTime/t.duration,1)),this.batch.setColor(this.tempColor);var r=e.width/this.progressBg.width;this.progressBg.draw(this.batch,e.x+(e.width-this.progressBg.width*r)/2,e.y+e.height-15,this.progressBg.width*r,this.progressBg.height*r,e.y+e.height+1);var a=this.processBar.width*r;this.processBar.draw(this.batch,e.x+(e.width-this.processBar.width*r)/2,e.y+e.height-15+(this.progressBg.height*r-this.processBar.height*r)/2,Kt(0,a,Math.max(0,t.remainingTime/t.duration)),this.processBar.height*r,e.y+e.height+1),this.tempColor.set(1,1,1,1),this.batch.setColor(this.tempColor)}},{key:"drawStaticOrders",value:function(){for(var t=0;t<l.TOTAL_ORDERS;t++){var e=this.orders.get(t);void 0!==e&&this.drawOrder(e,this.layoutData.orders[t],0,0)}}},{key:"drawOrderBackground",value:function(t,e,i,n){this.orderBg.draw(this.batch,e.x+i,e.y+n,e.width,e.height,e.height);var r=this.atlas.findRegion(t);if(null!==r){var a=0,o=0;r.width>r.height?o=(a=43)/r.originalWidth*r.originalHeight:a=(o=43)/r.originalHeight*r.originalWidth,r.draw(this.batch,e.x+e.width/2-a/2+i,e.y+e.height/2-o/2-2+n,a,o,e.height+1)}}},{key:"drawServeOrder",value:function(t,e){this.tempColor.set(1,1,1,Kt(1,0,1-t.remainingTime/t.duration)),this.batch.setColor(this.tempColor),this.drawOrderBackground(t.orderItem,this.layoutData.orders[e],0,Kt(0,-100,1-t.remainingTime/t.duration)),this.tempColor.set(1,1,1,1),this.batch.setColor(this.tempColor)}},{key:"drawAppearOrder",value:function(t,e){var i=Kt(0,1,1-t.remainingTime/t.duration);this.tempColor.set(1,1,1,i),this.batch.setColor(this.tempColor),this.drawOrderBackground(t.orderItem,this.layoutData.orders[e],0,Kt(-100,0,1-t.remainingTime/t.duration)),this.tempColor.set(1,1,1,1),this.batch.setColor(this.tempColor)}},{key:"process",value:function(){if(this.batch.begin(),0===this.uiState.orderEffects.size)this.drawStaticOrders();else for(var t=0;t<=l.TOTAL_ORDERS;t++){var e=this.uiState.orderEffects.get(t);if(void 0!==e)"disapear"===e.type?this.drawServeOrder(e,t):"appear"===e.type&&this.drawAppearOrder(e,t);else{var i=this.orders.get(t);if(void 0===i)continue;this.drawOrder(i,this.layoutData.orders[t],0,0)}}this.batch.end()}}]),i}(E.xP),sr=N(or.prototype,"orders",[er],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hr=N(or.prototype,"layoutData",[ir],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lr=N(or.prototype,"assetManager",[nr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ur=N(or.prototype,"uiState",[rr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cr=N(or.prototype,"batch",[ar],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),or),Ao=(dr=(0,E.tB)("batch"),fr=(0,E.tB)("sortedDrawingSystem"),pr=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return L(t=e.call.apply(e,[this].concat(r)),"batch",vr,C(t)),L(t,"sortedDrawingSystem",gr,C(t)),t}return s(i,[{key:"process",value:function(){this.batch.begin(),this.sortedDrawingSystem.flush(this.batch),this.batch.end()}}]),i}(E.xP),vr=N(pr.prototype,"batch",[dr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gr=N(pr.prototype,"sortedDrawingSystem",[fr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pr),Po=(yr=(0,E.tB)("assetManager"),mr=(0,E.tB)("batch"),wr=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return L(t=e.call.apply(e,[this].concat(r)),"assetManager",Mr,C(t)),L(t,"batch",br,C(t)),t.font=void 0,t.tempString=void 0,t}return s(i,[{key:"initialized",value:function(){var t=this.assetManager.getFont("ui");this.font=t}},{key:"getRenderString",value:function(t,e){return this.tempString=t+e}},{key:"process",value:function(){this.batch.begin(),this.font.draw(this.batch,this.getRenderString("FPS: ",c.fps),55,l.WORLD_HEIGHT-40,100),this.font.draw(this.batch,this.getRenderString("drawCalls: ",c.drawCalls),55,l.WORLD_HEIGHT-20,300),this.batch.end()}}]),i}(E.xP),Mr=N(wr.prototype,"assetManager",[yr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),br=N(wr.prototype,"batch",[mr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wr),Oo=function(){function t(){h(this,t)}return s(t,null,[{key:"createEmptyTexture",value:function(){var t=r(e().mark((function t(i,n,r){var o,s;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Math.ceil(n),r=Math.ceil(r),o=new ImageData(new Uint8ClampedArray(n*r*4),n,r),t.t0=a.Texture,t.t1=i,t.next=7,createImageBitmap(o);case 7:return t.t2=t.sent,s=new t.t0(t.t1,t.t2),t.abrupt("return",s);case 10:case"end":return t.stop()}}),t)})));return function(e,i,n){return t.apply(this,arguments)}}()}]),t}(),Do=(xr=(0,E.tB)("selectedPath"),Tr=(0,E.tB)("bushes"),Sr=(0,E.tB)("layoutData"),kr=(0,E.tB)("context"),_r=(0,E.tB)("uiState"),Ir=(0,E.tB)("camera"),Er=(0,E.tB)("batch"),Rr=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return L(t=e.call.apply(e,[this].concat(r)),"selectedPath",Ar,C(t)),L(t,"bushes",Pr,C(t)),L(t,"layoutData",Or,C(t)),L(t,"gl",Dr,C(t)),L(t,"uiState",Lr,C(t)),L(t,"camera",Cr,C(t)),L(t,"batch",Br,C(t)),t.shapeRenderer=void 0,t.tmpTexture=void 0,t.fbo=void 0,t.boardCam=void 0,t.ready=!1,t.color=new a.Color(.7,.7,.7,1),t.outlineColor=new a.Color(.7,.7,.7,.5),t}return s(i,[{key:"initialized",value:function(){var t=this;this.shapeRenderer=new a.ShapeRenderer(this.gl),this.fbo=this.gl.createFramebuffer(),this.boardCam=new a.OrthoCamera(this.layoutData.board.width,this.layoutData.board.height,this.layoutData.board.width,this.layoutData.board.height),this.boardCam.setPosition(this.layoutData.board.width/2,this.layoutData.board.height/2),this.boardCam.setYDown(!0),Oo.createEmptyTexture(this.gl,this.layoutData.board.width,this.layoutData.board.height).then((function(e){t.tmpTexture=e,t.ready=!0}))}},{key:"dispose",value:function(){this.shapeRenderer.dispose(),this.tmpTexture.dispose(),this.gl.deleteFramebuffer(this.fbo)}},{key:"process",value:function(){if(this.ready&&this.uiState.boardInputType===u.SLIDE_TO_MATCH){var t=this.selectedPath,e=this.bushes,i=this.shapeRenderer,n=this.camera,r=this.gl,a=this.fbo,o=this.tmpTexture,s=this.batch,h=this.layoutData,l=this.boardCam,c=this.color,d=this.outlineColor,f=h.board.x,p=h.board.y;r.bindFramebuffer(r.FRAMEBUFFER,a),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,o.getWebGLTexture(),0),r.viewport(0,0,o.width,o.height),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),i.setProjection(l.combined),i.begin();for(var v=1;v<t.length;v++){var g=e[t[v-1]],y=e[t[v]];i.rectLine(!0,g.x+g.width/2-f,g.y+g.height/2-p,y.x+y.width/2-f,y.y+y.height/2-p,20,c),1===v&&i.circle(!0,g.x+g.width/2-f,g.y+g.height/2-p,10,c),i.circle(!0,y.x+y.width/2-f,y.y+y.height/2-p,10,c)}i.end(),r.bindFramebuffer(r.FRAMEBUFFER,null),r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),s.setProjection(n.combined),s.begin(),s.setOutlineInfo(!0,d,10),s.draw(o,h.board.x,h.board.y,h.board.width,h.board.height,h.board.width/2,h.board.height/2,0,1,-1),s.setOutlineInfo(!1),s.end(),i.setProjection(n.combined),i.begin();for(var m=1;m<t.length;m++){var w=e[t[m-1]],M=e[t[m]];i.rectLine(!0,w.x+w.width/2,w.y+w.height/2,M.x+M.width/2,M.y+M.height/2,3),1===m&&i.circle(!0,w.x+w.width/2,w.y+w.height/2,1.5),i.circle(!0,M.x+M.width/2,M.y+M.height/2,1.5)}i.end()}}}]),i}(E.xP),Ar=N(Rr.prototype,"selectedPath",[xr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pr=N(Rr.prototype,"bushes",[Tr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Or=N(Rr.prototype,"layoutData",[Sr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dr=N(Rr.prototype,"gl",[kr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lr=N(Rr.prototype,"uiState",[_r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cr=N(Rr.prototype,"camera",[Ir],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Br=N(Rr.prototype,"batch",[Er],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rr),Lo=(zr=(0,E.tB)("levelState"),Hr=(0,E.tB)("uiState"),Vr=(0,E.tB)("levelData"),Fr=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return L(t=e.call.apply(e,[this].concat(r)),"levelState",Nr,C(t)),L(t,"uiState",Gr,C(t)),L(t,"levelData",jr,C(t)),t}return s(i,[{key:"getCurrentStar",value:function(){for(var t=0,e=0;e<this.levelData.starRatingScores.length;e++)this.levelState.score>=this.levelData.starRatingScores[e]&&(t=e+1);return t}},{key:"processEndGame",value:function(){if(this.uiState.uiInputStatus!==f.OPEN_UI_ENDGAME){this.uiState.uiInputStatus=f.OPEN_UI_ENDGAME;var t=k(this.levelState.levelIndex);localStorage.setItem("level:".concat(this.levelState.levelIndex,":maxStar"),Math.max(t,this.getCurrentStar()).toString())}}},{key:"process",value:function(){this.levelState.endGame?this.processEndGame():(this.levelState.gameTime+=this.world.delta,this.levelState.gameTime>=this.levelData.totalTime&&(this.levelState.gameTime=this.levelData.totalTime,this.processEndGame()))}}]),i}(E.xP),Nr=N(Fr.prototype,"levelState",[zr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gr=N(Fr.prototype,"uiState",[Hr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jr=N(Fr.prototype,"levelData",[Vr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fr),Co=(Wr=(0,E.tB)("tools"),Ur=(0,E.tB)("shop"),Yr=(0,E.tB)("inventory"),Xr=(0,E.tB)("uiState"),Kr=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return L(t=e.call.apply(e,[this].concat(r)),"tools",qr,C(t)),L(t,"shop",Qr,C(t)),L(t,"inventory",Jr,C(t)),L(t,"uiState",Zr,C(t)),t}return s(i,[{key:"initialized",value:function(){}},{key:"returnProcessedItem",value:function(t,e){if(void 0!==t.processingIngredient&&void 0!==t.type){var i=Nt.searchOutputItem(t.processingIngredient,t.type);void 0!==i&&(t.resultIngredient=i.outputItemCode)}if(t.resultIngredient){for(var n=-1,r=0;r<this.inventory.slots.length;r++)if(void 0===this.inventory.slots[r]){n=r;break}if(n<0){if(!this.uiState.toolShakes.has(e)){this.uiState.toolShakes.set(e,{duration:.5,rest:1,currentTime:0,count:6,loop:!0,maxOffset:5})}return}var a=this.uiState.toolShakes.get(e);void 0!==a&&(a.loop=!1),this.uiState.inventoryTransitions.push({fromX:t.x,fromY:t.y,index:n,remainingTime:l.INVENTORY_TRANSITION_TIME}),this.inventory.slots[n]=t.resultIngredient}t.workingTime=void 0,t.processingIngredient=void 0,t.status=d.IDLE}},{key:"process",value:function(){for(var t=this.world.delta,e=0;e<this.tools.length;e++){var i=this.tools[e];i.status===d.WORKING&&(void 0!==i.workingTime&&(i.workingTime-=t,i.workingTime<=0&&this.returnProcessedItem(i,e)))}}}]),i}(E.xP),qr=N(Kr.prototype,"tools",[Wr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qr=N(Kr.prototype,"shop",[Ur],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jr=N(Kr.prototype,"inventory",[Yr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zr=N(Kr.prototype,"uiState",[Xr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kr),Bo=40,zo=($r=(0,E.tB)("tools"),ta=(0,E.tB)("shop"),ea=(0,E.tB)("assetManager"),ia=(0,E.tB)("uiState"),na=(0,E.tB)("sortedDrawingSystem"),ra=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return L(t=e.call.apply(e,[this].concat(r)),"tools",aa,C(t)),L(t,"shop",oa,C(t)),L(t,"assetManager",sa,C(t)),L(t,"uiState",ha,C(t)),L(t,"sortedDrawingSystem",la,C(t)),t.idleAnimations=new Map,t.playfulAnimations=new Map,t.workingAnimations=new Map,t.uiAtlas=void 0,t.iconLockRegions=void 0,t.ingredientAtlas=void 0,t.bubbleAnimation=void 0,t.stateTime=0,t.finishWorkingBarColor=a.Color.fromString("f6963e"),t.workingBarColor=a.Color.fromString("4dfe9c"),t.lerpingColor=new a.Color(1,1,1,1),t}return s(i,[{key:"loadToolAnimation",value:function(t,e,i,n,r){var o=t.type;if(o){var s=this.assetManager.getAtlas(e||"".concat(o,"_animation"));this.uiAtlas=this.assetManager.getAtlas("ui");var h=this.assetManager.getAtlas("bubble");this.ingredientAtlas=this.assetManager.getAtlas("ingredient"),this.iconLockRegions=this.uiAtlas.findRegions("icon_lock"),this.bubbleAnimation=new a.Animation(h.findRegions("bubble"),1/30),s&&(this.idleAnimations.set(o,new a.Animation(s.findRegions(i||"idle_1"),1/30)),this.playfulAnimations.set(o,new a.Animation(s.findRegions(n||"idle_2"),1/30)),this.workingAnimations.set(o,new a.Animation(s.findRegions(r||"working"),1/30)))}}},{key:"initialized",value:function(){var t,e=D(this.tools);try{for(e.s();!(t=e.n()).done;){var i=t.value;this.loadToolAnimation(i)}}catch(n){e.e(n)}finally{e.f()}this.loadToolAnimation(this.shop,"shop_animation","idle","action","action")}},{key:"drawTool",value:function(t,e){var i,n=t.type,r=t.status;if(n&&r){var o,s=a.PlayMode.LOOP,h=(t.workingTime||-1)<=0,l=0;if(h){var u=this.uiState.toolShakes.get(e);void 0!==u&&(l=Ne(u))}switch(r){case d.PLAYFUL:o=this.playfulAnimations.get(n);break;case d.WORKING:if(o=this.workingAnimations.get(n),t.workingTime&&t.workingTime<=0&&(o=this.idleAnimations.get(n)),"shop"===n&&(s=a.PlayMode.NORMAL),void 0!==t.workingTime&&void 0!==t.requireTime&&void 0!==this.uiAtlas){var c,f,p=null===(c=this.uiAtlas)||void 0===c?void 0:c.findRegion("progress_bg"),v=null===(f=this.uiAtlas)||void 0===f?void 0:f.findRegion("progress_bar"),g=1;if(h){var y,m=null===(y=this.uiAtlas)||void 0===y?void 0:y.findRegion("tool_angry");if(m){var w=Kt(.7,1,Fe.Sinusoidal.In(4*-t.workingTime)/2);this.sortedDrawingSystem.deferDraw(m,t.x+.9*t.width-20+l,t.y+t.height/2-20,Bo,Bo,1e3,20,20,0,w,w)}}if(p&&v){g=(t.width-40)/p.width,this.sortedDrawingSystem.deferDraw(p,t.x+(t.width-p.width*g)/2,t.y+t.height-30,p.width*g,p.height*g,t.y+t.height+1);var M=v.width*g;this.sortedDrawingSystem.deferDraw(v,t.x+(t.width-v.width*g)/2,t.y+t.height-30+(p.height*g-v.height*g)/2,Kt(M,0,Math.max(0,t.workingTime/t.requireTime)),v.height*g,t.y+t.height+1,0,0,0,1,1,h?Yt(this.lerpingColor,this.workingBarColor,this.finishWorkingBarColor,Math.min(20*-t.workingTime/t.requireTime,1)):this.workingBarColor)}var b=this.bubbleAnimation.getKeyFrame(t.stateTime,a.PlayMode.LOOP);this.sortedDrawingSystem.deferDraw(b,t.x+.1*t.width-27.5,t.y+t.height/2-27.5,55,55,1e3);var x=t.resultIngredient||t.processingIngredient;if(x){var T=this.ingredientAtlas.findRegion(x);if(T){var S=0,k=0;T.width>T.height?k=(S=24.75)/T.originalWidth*T.originalHeight:S=(k=24.75)/T.originalHeight*T.originalWidth;var _=Kt(.8,1,Fe.Sinusoidal.In(3*t.workingTime)/2);this.sortedDrawingSystem.deferDraw(T,t.x+.1*t.width-S/2,t.y+t.height/2-k/2,S,k,1001,S/2,k/2,0,_,_)}}}break;default:o=this.idleAnimations.get(n)}var I=null===(i=o)||void 0===i?void 0:i.getKeyFrame(t.stateTime,s);I&&this.sortedDrawingSystem.deferDraw(I,t.x+l,t.y,t.width,t.height,t.y+t.height),"shop"!==t.type&&this.sortedDrawingSystem.deferDraw(t.locked?this.iconLockRegions[0]:this.iconLockRegions[1],t.x+t.width-40,t.y+t.height-40,40,40,t.y+t.height+1)}}},{key:"process",value:function(){for(var t=0;t<this.tools.length;t++)this.drawTool(this.tools[t],t);this.drawTool(this.shop,-1)}}]),i}(E.xP),aa=N(ra.prototype,"tools",[$r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oa=N(ra.prototype,"shop",[ta],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sa=N(ra.prototype,"assetManager",[ea],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ha=N(ra.prototype,"uiState",[ia],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),la=N(ra.prototype,"sortedDrawingSystem",[na],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ra),Ho=(ua=(0,E.tB)("tools"),ca=(0,E.tB)("shop"),da=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return L(t=e.call.apply(e,[this].concat(r)),"tools",fa,C(t)),L(t,"shop",pa,C(t)),t}return s(i,[{key:"processToolStatus",value:function(t,e){if(t.stateTime+=e,t.status===d.IDLE){if("shop"===t.type)return;t.timeUntilPlayful||(t.timeUntilPlayful=(i=l.PLAYFUL_TIME_RANGE[0],n=l.PLAYFUL_TIME_RANGE[1],Math.random()*(n-i)+i)),t.timeUntilPlayful-=e,t.timeUntilPlayful<=0&&(t.status=d.PLAYFUL,t.timeUntilPlayful=void 0,t.stateTime=0)}else t.status===d.PLAYFUL?(t.playfulTime||(t.playfulTime="shop"===t.type?l.SHOP_PLAYFUL_ANIMATION_TIME:l.TOOL_PLAYFUL_ANIMATION_TIME),t.playfulTime-=e,t.playfulTime<=0&&(t.status=d.IDLE,t.playfulTime=void 0,t.stateTime=0)):t.status===d.WORKING&&(t.timeUntilPlayful=void 0,t.playfulTime=void 0);var i,n}},{key:"process",value:function(){var t,e=this.tools,i=this.shop,n=this.processToolStatus,r=this.world.delta,a=D(e);try{for(a.s();!(t=a.n()).done;){n(t.value,r)}}catch(o){a.e(o)}finally{a.f()}n(i,r)}}]),i}(E.xP),fa=N(da.prototype,"tools",[ua],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pa=N(da.prototype,"shop",[ca],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),da),Vo=(va=(0,E.tB)("assetManager"),ga=(0,E.tB)("batch"),ya=(0,E.tB)("shapeRenderer"),ma=(0,E.tB)("camera"),wa=(0,E.tB)("endLevelLayoutData"),Ma=(0,E.tB)("levelState"),ba=(0,E.tB)("levelData"),xa=(0,E.tB)("uiState"),Ta=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return L(t=e.call.apply(e,[this].concat(r)),"assetManager",Sa,C(t)),L(t,"batch",ka,C(t)),L(t,"shapeRenderer",_a,C(t)),L(t,"camera",Ia,C(t)),L(t,"endLevelLayoutData",Ea,C(t)),L(t,"levelState",Ra,C(t)),L(t,"levelData",Aa,C(t)),L(t,"uiState",Pa,C(t)),t.atlas=void 0,t.ingredientAtlas=void 0,t.font=void 0,t.bgRegion=void 0,t.emptyStarRegion=void 0,t.starRegion=void 0,t.btnNext=void 0,t.btnReplay=void 0,t.btnBack=void 0,t.dishRegion=void 0,t.totalStar=-1,t.overlayColor=new a.Color(0,0,0,.7),t}return s(i,[{key:"initialized",value:function(){this.ingredientAtlas=this.assetManager.getAtlas("ingredient"),this.dishRegion=this.ingredientAtlas.findRegion("dish"),this.atlas=this.assetManager.getAtlas("ui_end_level"),this.bgRegion=this.atlas.findRegion("end_level_bg"),this.emptyStarRegion=this.atlas.findRegion("star_empty"),this.starRegion=this.atlas.findRegion("star"),this.btnNext=this.atlas.findRegion("btn_next"),this.btnReplay=this.atlas.findRegion("btn_replay"),this.btnBack=this.atlas.findRegion("btn_back");var t=this.assetManager.getFont("ui-outlined");this.font=t}},{key:"getCurrentStar",value:function(){if(this.totalStar>=0)return this.totalStar;this.totalStar=0;for(var t=0;t<this.levelData.starRatingScores.length&&!(this.levelState.score<this.levelData.starRatingScores[t]);t++)this.totalStar=t+1;return this.totalStar}},{key:"process",value:function(){var t=this;if(this.uiState.uiInputStatus===f.OPEN_UI_ENDGAME){this.shapeRenderer.setProjection(this.camera.combined),this.shapeRenderer.begin(),this.shapeRenderer.rect(!0,l.BG_OFFSET,0,l.BG_WIDTH,l.BG_HEIGHT,this.overlayColor),this.shapeRenderer.end(),this.getCurrentStar(),this.batch.begin(),this.bgRegion.draw(this.batch,this.endLevelLayoutData.background.x,this.endLevelLayoutData.background.y,this.endLevelLayoutData.background.width,this.endLevelLayoutData.background.height);for(var e=0;e<this.endLevelLayoutData.stars.length;e++){var i=this.endLevelLayoutData.stars[e];(e<this.totalStar?this.starRegion:this.emptyStarRegion).draw(this.batch,i.x-this.emptyStarRegion.width/2,i.y-this.emptyStarRegion.height/2,this.emptyStarRegion.width,this.emptyStarRegion.height)}this.btnBack.draw(this.batch,this.endLevelLayoutData.btnBack.x,this.endLevelLayoutData.btnBack.y,this.endLevelLayoutData.btnBack.width,this.endLevelLayoutData.btnBack.height),this.btnReplay.draw(this.batch,this.endLevelLayoutData.btnReplay.x,this.endLevelLayoutData.btnReplay.y,this.endLevelLayoutData.btnReplay.width,this.endLevelLayoutData.btnReplay.height),this.btnNext.draw(this.batch,this.endLevelLayoutData.btnNext.x,this.endLevelLayoutData.btnNext.y,this.endLevelLayoutData.btnNext.width,this.endLevelLayoutData.btnNext.height);var n=0;this.levelState.servedDishes.forEach((function(e,i){if(n<t.endLevelLayoutData.servedDishes.length){var r=t.endLevelLayoutData.servedDishes[n];t.dishRegion.draw(t.batch,r.x,r.y,r.width,r.height);var a=t.ingredientAtlas.findRegion(i);if(a){var o=0,s=0;a.width>a.height?s=(o=60)/a.originalWidth*a.originalHeight:o=(s=60)/a.originalHeight*a.originalWidth,a.draw(t.batch,r.x+r.width/2-o/2,r.y+r.height/2-s/2,o,s)}}n++})),n=0,this.levelState.servedDishes.forEach((function(e,i){if(n<t.endLevelLayoutData.servedDishes.length){var r=t.endLevelLayoutData.servedDishes[n];t.font.getData().setXYScale(.7),t.font.draw(t.batch,"x ".concat(e),r.x+r.width+30,r.y+r.height/2-20,200)}n++})),this.font.getData().setXYScale(.7),this.font.draw(this.batch,"Score: ".concat(this.levelState.score),this.endLevelLayoutData.scoreText.x,this.endLevelLayoutData.scoreText.y+this.endLevelLayoutData.scoreText.height/2,this.endLevelLayoutData.scoreText.width,a.Align.center),this.font.getData().setXYScale(1),this.batch.end()}}}]),i}(E.xP),Sa=N(Ta.prototype,"assetManager",[va],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ka=N(Ta.prototype,"batch",[ga],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_a=N(Ta.prototype,"shapeRenderer",[ya],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ia=N(Ta.prototype,"camera",[ma],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ea=N(Ta.prototype,"endLevelLayoutData",[wa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ra=N(Ta.prototype,"levelState",[Ma],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Aa=N(Ta.prototype,"levelData",[ba],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pa=N(Ta.prototype,"uiState",[xa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ta),Fo=(Oa=(0,E.tB)("inputHandler"),Da=(0,E.tB)("layoutData"),La=(0,E.tB)("levelState"),Ca=(0,E.tB)("endLevelLayoutData"),Ba=(0,E.tB)("uiState"),za=(0,E.tB)("viewport"),Ha=(0,E.tB)("assetManager"),Va=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return L(t=e.call.apply(e,[this].concat(r)),"inputHandler",Fa,C(t)),L(t,"layoutData",Na,C(t)),L(t,"levelState",Ga,C(t)),L(t,"endLevelLayoutData",ja,C(t)),L(t,"uiState",Wa,C(t)),L(t,"viewport",Ua,C(t)),L(t,"assetManager",Ya,C(t)),t.closingRecipes=!1,t.transitioning=!1,t.canTriggerJustTouched=!0,t.justTouched=!1,t}return s(i,[{key:"initialized",value:function(){}},{key:"processTouchBtnRecipes",value:function(){if(this.justTouched)if(this.uiState.uiInputStatus===f.NORMAL){var t=this.inputHandler.getTouchedWorldCoord();Xt(t,this.layoutData.btnRecipe.x,this.layoutData.btnRecipe.y,this.layoutData.btnRecipe.width,this.layoutData.btnRecipe.height)&&(this.uiState.uiInputStatus=f.OPEN_RECIPES)}else this.uiState.uiInputStatus===f.OPEN_RECIPES&&(this.uiState.uiInputStatus=f.NORMAL,this.closingRecipes=!0)}},{key:"processTouchBtnLevelSelection",value:function(){if(this.justTouched&&this.uiState.uiInputStatus===f.NORMAL){var t=this.inputHandler.getTouchedWorldCoord();Xt(t,this.layoutData.btnLevelSelection.x,this.layoutData.btnLevelSelection.y,this.layoutData.btnLevelSelection.width,this.layoutData.btnLevelSelection.height)&&this.goToSelectLevelScreen()}}},{key:"goToSelectLevelScreen",value:function(){this.transitioning||(this.transitioning=!0,ts(this.viewport,this.assetManager).then((function(t){a.Game.shared.setScreen(t)})))}},{key:"goToLevel",value:function(t){this.transitioning||(this.transitioning=!0,Jo(this.viewport,this.assetManager,this.uiState.boardInputType,t).then((function(t){a.Game.shared.setScreen(t)})))}},{key:"processTouchEndGame",value:function(){if(this.uiState.uiInputStatus===f.OPEN_UI_ENDGAME&&this.justTouched){var t=this.inputHandler.getTouchedWorldCoord();if(Xt(t,this.endLevelLayoutData.btnReplay.x,this.endLevelLayoutData.btnReplay.y,this.endLevelLayoutData.btnReplay.width,this.endLevelLayoutData.btnReplay.height))return void this.goToLevel(this.levelState.levelIndex);if(Xt(t,this.endLevelLayoutData.btnBack.x,this.endLevelLayoutData.btnBack.y,this.endLevelLayoutData.btnBack.width,this.endLevelLayoutData.btnBack.height))return void this.goToSelectLevelScreen();if(Xt(t,this.endLevelLayoutData.btnNext.x,this.endLevelLayoutData.btnNext.y,this.endLevelLayoutData.btnNext.width,this.endLevelLayoutData.btnNext.height))return void(this.levelState.levelIndex+1===l.TOTAL_DEMO_LEVEL?this.goToSelectLevelScreen():this.goToLevel(this.levelState.levelIndex+1))}}},{key:"process",value:function(){this.justTouched?this.justTouched=!1:this.inputHandler.isTouched()?this.canTriggerJustTouched&&(this.justTouched=!0,this.canTriggerJustTouched=!1):(this.justTouched=!1,this.canTriggerJustTouched=!0),this.processTouchBtnRecipes(),this.processTouchBtnLevelSelection(),this.processTouchEndGame(),this.processTouchOrders(),this.closingRecipes=!1}},{key:"processTouchOrders",value:function(){if(this.justTouched&&!this.closingRecipes){var t,e=this.inputHandler.getTouchedWorldCoord(),i=D(this.layoutData.orders);try{for(i.s();!(t=i.n()).done;){var n=t.value;if(Xt(e,n.x,n.y,n.width,n.height)){this.uiState.uiInputStatus=f.OPEN_RECIPES;break}}}catch(r){i.e(r)}finally{i.f()}}}}]),i}(E.xP),Fa=N(Va.prototype,"inputHandler",[Oa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Na=N(Va.prototype,"layoutData",[Da],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ga=N(Va.prototype,"levelState",[La],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ja=N(Va.prototype,"endLevelLayoutData",[Ca],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wa=N(Va.prototype,"uiState",[Ba],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ua=N(Va.prototype,"viewport",[za],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ya=N(Va.prototype,"assetManager",[Ha],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Va),No=60,Go=40,jo=20,Wo=(Xa=(0,E.tB)("batch"),Ka=(0,E.tB)("shapeRenderer"),qa=(0,E.tB)("camera"),Qa=(0,E.tB)("context"),Ja=(0,E.tB)("uiState"),Za=(0,E.tB)("assetManager"),$a=(0,E.tB)("levelState"),to=(0,E.tB)("tools"),eo=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return L(t=e.call.apply(e,[this].concat(r)),"batch",io,C(t)),L(t,"shapeRenderer",no,C(t)),L(t,"camera",ro,C(t)),L(t,"gl",ao,C(t)),L(t,"uiState",oo,C(t)),L(t,"assetManager",so,C(t)),L(t,"levelState",ho,C(t)),L(t,"tools",lo,C(t)),t.uiAtlas=void 0,t.ingredientAtlas=void 0,t.bgRegion=void 0,t.dishRegion=void 0,t.ingredientBgRegion=void 0,t.font=void 0,t.plusRegion=void 0,t.equalRegion=void 0,t.toolRegions=new Map,t.prerenderedTexture=void 0,t.fbo=void 0,t.tempVec=new a.Vector2(0,0),t.startDrawPos=new a.Vector2(60,30),t.offsetY=0,t.overlayColor=new a.Color(0,0,0,.7),t}return s(i,[{key:"initialized",value:function(){var t=this;this.uiAtlas=this.assetManager.getAtlas("ui"),this.bgRegion=this.uiAtlas.findRegion("popup_recipe_bg"),this.ingredientAtlas=this.assetManager.getAtlas("ingredient"),this.dishRegion=this.ingredientAtlas.findRegion("dish"),this.ingredientBgRegion=this.ingredientAtlas.findRegion("shoping_item_frame"),this.plusRegion=this.ingredientAtlas.findRegion("plus"),this.equalRegion=this.ingredientAtlas.findRegion("equal");var e=this.assetManager.getFont("ui-outlined");this.font=e;var i,n=D(R);try{for(n.s();!(i=n.n()).done;){var r=i.value;this.toolRegions.set(r,this.ingredientAtlas.findRegion("".concat(r,"_icon")))}}catch(a){n.e(a)}finally{n.f()}this.fbo=this.gl.createFramebuffer(),Oo.createEmptyTexture(this.gl,2*this.bgRegion.width,2*this.bgRegion.height).then((function(e){t.prerenderedTexture=e,t.prepareRecipes()}))}},{key:"prepareRecipes",value:function(){if(this.prerenderedTexture){var t=this.gl,e=new a.OrthoCamera(this.prerenderedTexture.width/2,this.prerenderedTexture.height/2,this.prerenderedTexture.width,this.prerenderedTexture.height);e.setPosition(this.prerenderedTexture.width/4,this.prerenderedTexture.height/4),e.setYDown(!0),t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.prerenderedTexture.getWebGLTexture(),0),t.viewport(0,0,this.prerenderedTexture.width,this.prerenderedTexture.height),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),this.batch.setProjection(e.combined),this.batch.begin(),this.bgRegion.draw(this.batch,0,0,this.bgRegion.width,this.bgRegion.height),this.font.data.setXYScale(.4),this.offsetY=0;var i,n=D(this.levelState.servedDishes);try{for(n.s();!(i=n.n()).done;){var r=O(i.value,1)[0];this.renderOrderRecipe(r)}}catch(o){n.e(o)}finally{n.f()}this.font.data.setXYScale(1),this.batch.end(),this.batch.setProjection(this.camera.combined),t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight)}}},{key:"calculateDrawSize",value:function(t,e){return this.tempVec.set(0,0),e.width>e.height?(this.tempVec.x=t,this.tempVec.y=this.tempVec.x/e.originalWidth*e.originalHeight):(this.tempVec.y=t,this.tempVec.x=this.tempVec.y/e.originalHeight*e.originalWidth),this.tempVec}},{key:"renderOrderRecipe",value:function(t){var e=Io.getDishData(t);void 0!==e&&(this.font.draw(this.batch,e.name,this.startDrawPos.x,this.startDrawPos.y+this.offsetY,500),this.offsetY+=25),this.dishRegion.draw(this.batch,this.startDrawPos.x,this.startDrawPos.y+this.offsetY,No,No);var i=this.ingredientAtlas.findRegion(t);null!==i&&(this.calculateDrawSize(48,i),i.draw(this.batch,this.startDrawPos.x+30-this.tempVec.x/2,this.startDrawPos.y+30-this.tempVec.y/2+this.offsetY,this.tempVec.x,this.tempVec.y)),this.equalRegion.draw(this.batch,this.startDrawPos.x+No+6,this.startDrawPos.y+this.offsetY+30-10,jo,jo);var n=Gt.searchIngredientsOfDish(t);if(n){for(var r=0;r<n.length;r++){var a=n[r];if(i=this.ingredientAtlas.findRegion(a),this.calculateDrawSize(32,i),null!==i){var o=this.startDrawPos.x+No+37+77*r,s=this.startDrawPos.y+30+this.offsetY;this.ingredientBgRegion.draw(this.batch,o,s-20,Go,Go),i.draw(this.batch,o+20-this.tempVec.x/2,s-this.tempVec.y/2,this.tempVec.x,this.tempVec.y),r<n.length-1&&this.plusRegion.draw(this.batch,o+Go+10,s-10,jo,jo)}}for(var h=0;h<n.length;h++){var l=n[h],u=Nt.searchInputItem(l);if(void 0!==u){i=this.ingredientAtlas.findRegion(l),this.calculateDrawSize(32,i);var c=this.startDrawPos.x+30-20,d=this.startDrawPos.y+No+this.offsetY;this.ingredientBgRegion.draw(this.batch,c,d,Go,Go),i.draw(this.batch,c+20-this.tempVec.x/2,d+20-this.tempVec.y/2,this.tempVec.x,this.tempVec.y),this.equalRegion.draw(this.batch,this.startDrawPos.x+No+6,d+20-10,jo,jo),c=this.startDrawPos.x+No+37,this.ingredientBgRegion.draw(this.batch,c,d,Go,Go),i=this.ingredientAtlas.findRegion(u.itemCode),this.calculateDrawSize(32,i),i.draw(this.batch,c+20-this.tempVec.x/2,d+20-this.tempVec.y/2,this.tempVec.x,this.tempVec.y),this.plusRegion.draw(this.batch,c+Go+10,d+20-10,jo,jo);var f=this.toolRegions.get(u.toolCode);if(f&&(this.calculateDrawSize(48,f),f.draw(this.batch,c+Go+37+20-this.tempVec.x/2,d+20-this.tempVec.y/2,this.tempVec.x,this.tempVec.y)),void 0!==(u=Nt.searchInputItem(u.itemCode))){this.offsetY+=Go,d+=45,this.ingredientBgRegion.draw(this.batch,c,d,Go,Go),this.calculateDrawSize(32,i),i.draw(this.batch,c+20-this.tempVec.x/2,d+20-this.tempVec.y/2,this.tempVec.x,this.tempVec.y),i=this.ingredientAtlas.findRegion(u.itemCode),this.ingredientBgRegion.draw(this.batch,c+Go+37,d,Go,Go),this.calculateDrawSize(32,i),i.draw(this.batch,c+20-this.tempVec.x/2+Go+37,d+20-this.tempVec.y/2,this.tempVec.x,this.tempVec.y),this.equalRegion.draw(this.batch,c+Go+10,d+20-10,jo,jo);var p=this.toolRegions.get(u.toolCode);p&&(this.plusRegion.draw(this.batch,c+124+3,d+20-10,jo,jo),this.calculateDrawSize(48,p),p.draw(this.batch,c+154+20-this.tempVec.x/2,d+20-this.tempVec.y/2,this.tempVec.x,this.tempVec.y))}this.offsetY+=50}}}this.offsetY+=No,this.offsetY+=10}},{key:"process",value:function(){this.uiState.uiInputStatus===f.OPEN_RECIPES&&this.prerenderedTexture&&(this.shapeRenderer.setProjection(this.camera.combined),this.shapeRenderer.begin(),this.shapeRenderer.rect(!0,l.BG_OFFSET,0,l.BG_WIDTH,l.BG_HEIGHT,this.overlayColor),this.shapeRenderer.end(),this.batch.begin(),this.batch.draw(this.prerenderedTexture,l.WORLD_WIDTH/2-this.bgRegion.width/2,l.WORLD_HEIGHT/2-this.bgRegion.height/2,this.bgRegion.width,this.bgRegion.height,this.bgRegion.width/2,this.bgRegion.height/2,0,1.2,-1.2),this.batch.end())}},{key:"dispose",value:function(){var t;null===(t=this.prerenderedTexture)||void 0===t||t.dispose(),this.gl.deleteFramebuffer(this.fbo)}}]),i}(E.xP),io=N(eo.prototype,"batch",[Xa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),no=N(eo.prototype,"shapeRenderer",[Ka],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ro=N(eo.prototype,"camera",[qa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ao=N(eo.prototype,"gl",[Qa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oo=N(eo.prototype,"uiState",[Ja],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),so=N(eo.prototype,"assetManager",[Za],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ho=N(eo.prototype,"levelState",[$a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lo=N(eo.prototype,"tools",[to],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eo),Uo=(uo=(0,E.tB)("assetManager"),co=(0,E.tB)("batch"),fo=(0,E.tB)("layoutData"),po=(0,E.tB)("levelData"),vo=(0,E.tB)("levelState"),go=(0,E.tB)("resources"),yo=(0,E.tB)("uiState"),mo=function(t){z(i,t);var e=F(i);function i(){var t;h(this,i);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return L(t=e.call.apply(e,[this].concat(r)),"assetManager",wo,C(t)),L(t,"batch",Mo,C(t)),L(t,"layoutData",bo,C(t)),L(t,"levelData",xo,C(t)),L(t,"levelState",To,C(t)),L(t,"resources",So,C(t)),L(t,"uiState",ko,C(t)),t.uiAtlas=void 0,t.iconRegions=void 0,t.font=void 0,t.clockRegion=void 0,t.clockHandRegion=void 0,t.scorePanelRegion=void 0,t.btnBack=void 0,t.btnRecipe=void 0,t.btnMenu=void 0,t.color=new a.Color(1,1,1,1),t.progressBarColor=a.Color.fromString("4dfe9c"),t.progressBarGap=4,t.starSize=15,t}return s(i,[{key:"initialized",value:function(){this.uiAtlas=this.assetManager.getAtlas("ui"),this.iconRegions=this.uiAtlas.findRegions("icon"),this.clockRegion=this.uiAtlas.findRegion("clock"),this.clockHandRegion=this.uiAtlas.findRegion("clock_hand"),this.scorePanelRegion=this.uiAtlas.findRegion("point"),this.btnBack=this.uiAtlas.findRegion("btn_back"),this.btnRecipe=this.uiAtlas.findRegion("btn_recipe"),this.btnMenu=this.uiAtlas.findRegion("btn_menu");var t=this.assetManager.getFont("ui");this.font=t}},{key:"process",value:function(){var t,e=this.batch,i=this.uiAtlas,n=this.iconRegions,r=this.layoutData,o=this.font;e.begin();var s,h=0,u=D(this.uiState.purchaseErrorShakingEffect);try{for(u.s();!(s=u.n()).done;){var c=s.value;"material"===c.target&&(h=c.remainingTime)}}catch(S){u.e(S)}finally{u.f()}var d=1;h>0&&(d=Kt(1,1.2,Fe.Bounce.Out(h/l.PURCHASE_ERROR_SHAKING_TIME)),e.setColor(this.color.set(1,2.5*(1.2-d)+.5,2.5*(1.2-d)+.5,1))),null===(t=i.findRegion("resource_panel",-1))||void 0===t||t.draw(e,r.resourcePanel.x,r.resourcePanel.y,r.resourcePanel.width,r.resourcePanel.height,r.resourcePanel.width/2,r.resourcePanel.height/2,0,1,d),e.setColor(this.color.set(1,1,1,1));var f,p=i.findRegion("resource_bar",-1),v=D(r.resourceBars);try{for(v.s();!(f=v.n()).done;){var g=f.value;null===p||void 0===p||p.draw(e,g.x,g.y,g.width,g.height)}}catch(S){v.e(S)}finally{v.f()}for(var y=0;y<3;y++){var m=r.resourceBars[y];n[y].draw(e,m.x-5,m.y-5,l.MATERIAL_WIDTH,l.MATERIAL_HEIGHT,0,0,0,.5,.5)}for(var w=0;w<3;w++){var M=r.resourceBars[w];o.draw(e,this.resources.amount[w].toString(),M.x+18,M.y+3,50)}this.btnMenu.draw(e,r.btnMenu.x,r.btnMenu.y,r.btnMenu.width,r.btnMenu.height),this.btnBack.draw(e,r.btnLevelSelection.x,r.btnLevelSelection.y,r.btnLevelSelection.width,r.btnLevelSelection.height),this.btnRecipe.draw(e,r.btnRecipe.x,r.btnRecipe.y,r.btnRecipe.width,r.btnRecipe.height),this.clockRegion.draw(e,r.clock.x,r.clock.y,r.clock.width,r.clock.height),d=this.layoutData.clock.width/this.clockRegion.originalWidth;var b=this.clockHandRegion.originalWidth*d,x=this.clockHandRegion.originalHeight*d,T=Kt(-90,90,this.levelState.gameTime/this.levelData.totalTime);this.clockHandRegion.draw(e,r.clock.x+r.clock.width/2-b/2,r.clock.y+r.clock.height-x,b,x,b/2,x-3,T*a.MathUtils.degreesToRadians),this.scorePanelRegion.draw(e,r.scorePanel.x,r.scorePanel.y,r.scorePanel.width,r.scorePanel.height),this.drawProgress(),o.draw(e,this.levelState.score.toString(),r.scorePanel.x,r.scorePanel.y+6,r.scorePanel.width,a.Align.center),e.end()}},{key:"drawProgress",value:function(){var t=this.uiAtlas.findRegion("progress_bg"),e=this.uiAtlas.findRegion("progress_bar"),i=this.uiAtlas.findRegion("star_empty"),n=this.uiAtlas.findRegion("star"),r=this.levelData.starRatingScores[2];t.draw(this.batch,this.layoutData.progressPanel.x,this.layoutData.progressPanel.y,this.layoutData.progressPanel.width,this.layoutData.progressPanel.height);var o=this.batch.color;this.batch.setColor(this.progressBarColor),e.draw(this.batch,this.layoutData.progressPanel.x+this.progressBarGap,this.layoutData.progressPanel.y+this.progressBarGap,this.layoutData.progressPanel.width-2*this.progressBarGap,this.layoutData.progressPanel.height-2*this.progressBarGap,0,0,0,a.MathUtils.clamp(this.levelState.score/r,0,1),1),this.batch.setColor(o);var s,h=D(this.levelData.starRatingScores);try{for(h.s();!(s=h.n()).done;){var l=s.value,u=i,c=1;this.levelState.score>=l&&(u=n,c=1.2),u.draw(this.batch,this.layoutData.progressPanel.x+l/r*this.layoutData.progressPanel.width-this.starSize/2,this.layoutData.progressPanel.y+this.layoutData.progressPanel.height/2-this.starSize/2,this.starSize,this.starSize,this.starSize/2,this.starSize/2,0,c,c)}}catch(d){h.e(d)}finally{h.f()}}}]),i}(E.xP),wo=N(mo.prototype,"assetManager",[uo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mo=N(mo.prototype,"batch",[co],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bo=N(mo.prototype,"layoutData",[fo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xo=N(mo.prototype,"levelData",[po],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),To=N(mo.prototype,"levelState",[vo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),So=N(mo.prototype,"resources",[go],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ko=N(mo.prototype,"uiState",[yo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mo),Yo=function(){var t=r(e().mark((function t(i){var n,r,a,o,s,h,l;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=[],t.next=3,fetch(i).then((function(t){return t.text()}));case 3:r=t.sent,a=r.split(/\r?\n/),o=D(a),t.prev=6,o.s();case 8:if((s=o.n()).done){t.next=16;break}if(h=s.value,!((l=h.replaceAll(" ","").split(",")).length<3)){t.next=13;break}return t.abrupt("continue",14);case 13:n.push({item:l[0],material:parseInt(l[2]),amount:parseInt(l[1])});case 14:t.next=8;break;case 16:t.next=21;break;case 18:t.prev=18,t.t0=t.catch(6),o.e(t.t0);case 21:return t.prev=21,o.f(),t.finish(21);case 24:return t.abrupt("return",n);case 25:case"end":return t.stop()}}),t,null,[[6,18,21,24]])})));return function(e){return t.apply(this,arguments)}}(),Xo=function(){var t=r(e().mark((function t(i){var n,r,a,o,s,h,l,u,c,d,f,p,v,g,y,m,w,M,b,x,T;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(i).then((function(t){return t.json()}));case 2:return n=t.sent,r=n.layers.find((function(t){return"layout"===t.name})),a=n.layers.find((function(t){return"inventory_slot"===t.name})),o=n.layers.find((function(t){return"dishes"===t.name})),s=n.layers.find((function(t){return"orders"===t.name})),h=r.objects.find((function(t){return"board"===t.name})),l=r.objects.find((function(t){return"spawn"===t.name})),u=r.objects.find((function(t){return"inventory"===t.name})),c=r.objects.find((function(t){return"trash"===t.name})),d=r.objects.find((function(t){return"shop"===t.name})),f=r.objects.find((function(t){return"clock"===t.name})),p=r.objects.find((function(t){return"btn_level_selection"===t.name})),v=r.objects.find((function(t){return"btn_recipe"===t.name})),g=r.objects.find((function(t){return"btn_menu"===t.name})),y=r.objects.find((function(t){return"score_panel"===t.name})),m=r.objects.find((function(t){return"resource_panel"===t.name})),w=r.objects.filter((function(t){return"resource_bar"===t.name})),M=r.objects.find((function(t){return"progress_panel"===t.name})),b=a.objects,x=o.objects,T=s.objects,t.abrupt("return",{board:h,spawn:l,inventory:u,trash:c,resourcePanel:m,resourceBars:w,shop:d,clock:f,scorePanel:y,inventorySlots:b,dishes:x,orders:T,btnLevelSelection:p,btnRecipe:v,btnMenu:g,progressPanel:M});case 24:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Ko=function(){var t=r(e().mark((function t(i){var n,r,a,o,s,h,l,u,c,d,f,p,v;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(i).then((function(t){return t.json()}));case 2:if(n=t.sent,r=n.layers.find((function(t){return"level"===t.name})),a=r.objects.filter((function(t){return"tool"===t.name})).sort((function(t,e){return e.y-t.y})).map((function(t){return Fn(Fn({},t),{},{type:t.type||t.class})})),o=n.properties.find((function(t){return"orders"===t.name})),s=[],void 0!==o&&(s=JSON.parse(o.value)),h=n.properties.find((function(t){return"star_rating_score"===t.name})),l=[],void 0!==h)for(u=h.value.replaceAll(" ","").split(","),c=0;c<u.length;c++)l.push(parseInt(u[c]));return d=n.properties.find((function(t){return"shop_items"===t.name})).value.split(","),t.next=14,Yo("./data/ingredient_data.txt");case 14:return f=t.sent.filter((function(t){return d.includes(t.item)})),p=n.properties.find((function(t){return"total_time"===t.name})),v=p.value,t.abrupt("return",{tools:a,orders:s,totalTime:v,starRatingScores:l,shopItems:f});case 18:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),qo=function(){var t=r(e().mark((function t(i){var n,r,a,o,s,h,l,u,c;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(i).then((function(t){return t.json()}));case 2:return n=t.sent,r=n.layers.find((function(t){return"layout"===t.name})),a=r.objects.find((function(t){return"background"===t.name})),o=r.objects.filter((function(t){return"star"===t.name})),s=r.objects.find((function(t){return"score_text"===t.name})),h=r.objects.find((function(t){return"btn_back"===t.name})),l=r.objects.find((function(t){return"btn_replay"===t.name})),u=r.objects.find((function(t){return"btn_next"===t.name})),c=r.objects.filter((function(t){return"dish"===t.name})),t.abrupt("return",{background:a,stars:o,scoreText:s,btnBack:h,btnReplay:l,btnNext:u,servedDishes:c});case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Qo=function(){function t(){h(this,t),this.pendingDraws=[],this.pendingDrawPool=[],this.sortFunc=function(t,e){return t.order-e.order}}return s(t,[{key:"getPendingDraw",value:function(){var t=this.pendingDrawPool.shift();return t||{x:0,y:0,width:0,height:0,order:0,originX:0,originY:0,rotation:0,scaleX:0,scaleY:0}}},{key:"releasePendingDraw",value:function(t){this.pendingDrawPool.push(t)}},{key:"deferDraw",value:function(t,e,i,n,r,a){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:1,u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,c=arguments.length>11?arguments[11]:void 0,d=arguments.length>12&&void 0!==arguments[12]&&arguments[12],f=arguments.length>13&&void 0!==arguments[13]?arguments[13]:te,p=arguments.length>14&&void 0!==arguments[14]?arguments[14]:2.5,v=this.getPendingDraw();v.region=t,v.x=e,v.y=i,v.width=n,v.height=r,v.order=a,v.originX=o,v.originY=s,v.rotation=h,v.scaleX=l,v.scaleY=u,v.color=c,v.outline=d,v.outlineColor=f,v.outlineBlurSize=p,this.pendingDraws.push(v)}},{key:"flush",value:function(t){var e;for(this.pendingDraws.sort(this.sortFunc);void 0!==(e=this.pendingDraws.shift());){var i,n=t.color;e.color&&t.setColor(e.color),e.outline&&t.setOutlineInfo(!0,e.outlineColor,e.outlineBlurSize),null===(i=e.region)||void 0===i||i.draw(t,e.x,e.y,e.width,e.height,e.originX,e.originY,e.rotation,e.scaleX,e.scaleY),e.outline&&t.setOutlineInfo(!1),e.color&&t.setColor(n),this.releasePendingDraw(e)}}}]),t}(),Jo=function(){var t=r(e().mark((function t(i,n,r){var o,s,h,u,c,p,v,g,y,m,w,M,b,x,T,S,k,_,R,A,P,O,D,L,C,B,z,H,V,F,N,G,j=arguments;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=j.length>3&&void 0!==j[3]?j[3]:0,s=i.getContext(),(h=i.getCamera()).setYDown(!0),u=new Qo,c=new ee(s),p=new a.ShapeRenderer(s),c.setYDown(!0),v=new a.ViewportInputHandler(i),t.next=11,Xo("./assets/map/layout.json");case 11:return g=t.sent,t.next=14,Ko("./assets/map/level_".concat(o+1,".json"));case 14:return y=t.sent,t.next=17,qo("./assets/map/end_level_layout.json");case 17:for(m=t.sent,w=[],M=[],b=[],x={position:new a.Vector2(g.spawn.x,g.spawn.y),target:new a.Vector2(0,0),size:new a.Vector2(l.HERO_WIDTH,l.HERO_HEIGHT),arrived:!0,home:!0,stateTime:0,flipped:!1,collecting:!1,picking:!1,pickingTime:0},T={amount:[999,999,999]},S={slots:[void 0,void 0,void 0,void 0,void 0]},k=g.dishes.map((function(t){return{x:t.x,y:t.y,width:t.width,height:t.height,ingredients:[],item:void 0}})),_=new Map,R=y.tools.map((function(t){return{x:t.x,y:t.y,width:t.width,height:t.height,type:t.type,status:d.IDLE,stateTime:0,locked:!1}})),A=g.shop,P={x:A.x,y:A.y,width:A.width,height:A.height,type:"shop",status:d.IDLE,stateTime:0,locked:!1},O={toolInputStatus:Ci.NORMAL,uiInputStatus:f.NORMAL,boardInputType:r,inventoryTransitions:[],toolPickingTransitions:[],purchaseErrorShakingEffect:[],effects:[],toolShakes:new Map,dishShakes:new Map,orderEffects:new Map},D={fps:0,drawCalls:0},L={levelIndex:o,gameTime:0,score:0,endGame:!1,servedDishes:new Map},C=0;C<y.orders.length;C++)L.servedDishes.set(y.orders[C].dish,0);return B=new E.q3,z=new(I()),B.register("layoutData",g),B.register("levelData",y),B.register("levelState",L),B.register("endLevelLayoutData",m),B.register("context",s),B.register("viewport",i),B.register("assetManager",n),B.register("camera",h),B.register("batch",c),B.register("shapeRenderer",p),B.register("inputHandler",v),B.register("eventEmitter",z),B.register("sortedDrawingSystem",u),B.register("selectedPath",w),B.register("materials",b),B.register("player",x),B.register("bushes",M),B.register("shop",P),B.register("tools",R),B.register("uiState",O),B.register("resources",T),B.register("inventory",S),B.register("dishes",k),B.register("orders",_),B.register("performanceData",D),H=new On,B.register("toolInputHandlingSystem",H),B.addSystem(new Jt,!0),B.addSystem(new Cn,!0),B.addSystem(new Ln,!0),B.addSystem(new je,!0),B.addSystem(new Co,!0),B.addSystem(new Eo,!0),B.addSystem(new Lo,!0),B.addSystem(new Fo,!0),B.addSystem(new jt,!0),B.addSystem(new Bt,!0),B.addSystem(new Zt,!1),B.addSystem(new $t,!1),B.addSystem(new Wt,!1),B.addSystem(new He,!1),B.addSystem(new Dn,!1),B.addSystem(new Bn,!1),B.addSystem(new Ho,!1),B.addSystem(new zo,!1),B.addSystem(new Ge,!1),B.addSystem(new Ro,!1),B.addSystem(H,!1),B.addSystem(new Ke(!0),!1),B.addSystem(new We,!1),B.addSystem(new Ao,!1),B.addSystem(new Do,!1),B.addSystem(new zn,!1),B.addSystem(new qi,!1),B.addSystem(new Ke,!1),B.addSystem(new Ao,!1),B.addSystem(new Uo,!1),B.addSystem(new Wo,!1),B.addSystem(new Vo,!1),B.addSystem(new Po,!1),V=.5,F=0,N=!0,G=new a.Color(0,0,0,1),t.abrupt("return",{update:function(t,e){N&&(F+=t)>=V&&(N=!1),c.setProjection(h.combined),B.setDelta(t),B.processActiveSystem(),B.processPassiveSystem(),N&&(p.setProjection(h.combined),p.begin(),G.a=1-a.MathUtils.clamp(F/V,0,1),p.rect(!0,l.BG_OFFSET,0,l.BG_WIDTH,l.BG_HEIGHT,G),p.end())},dispose:function(){B.dispose(),v.cleanup(),c.dispose(),p.dispose()}});case 100:case"end":return t.stop()}}),t)})));return function(e,i,n){return t.apply(this,arguments)}}(),Zo=105,$o="setting:boardInput",ts=function(){var t=r(e().mark((function t(i,n){var r,o,s,h,c,d,f,p,v,g,y,m,w,M,b,x,T,_,I,E,R,A,P,O,D,L,C,B,z,H,V,F,N,G;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(C=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;B=!0,S(Jo(i,n,P,t),1e3*L).then((function(t){a.Game.shared.setScreen(t)}))},D=function(){P=P===u.SLIDE_TO_MATCH?u.TOUCH_TO_MATCH:u.SLIDE_TO_MATCH,localStorage.setItem($o,P)},r=i.getContext(),(o=i.getCamera()).setYDown(!0),(s=new a.PolygonBatch(r)).setYDown(!0),h=new a.ViewportInputHandler(i),c=n.getTexture("bg"),d=new a.ShapeRenderer(r),f=n.getAtlas("ui"),p=f.findRegion("bg_level"),v=n.getFont("ui-outlined"),g=f.findRegion("star"),y=f.findRegion("star_empty"),m=f.findRegion("game_title"),w=n.getTexture("check"),M=n.getTexture("un_check"),b=[],20,x=(l.WORLD_WIDTH-480)/2,T=(l.WORLD_HEIGHT-355)/2+50,_=0,I=0,E=0;E<12;E++)R=x+125*I,A=T+125*_,b.push({x:R,y:A,width:Zo,height:Zo}),4===++I&&(I=0,_++);return P=u.TOUCH_TO_MATCH,null!==(O=localStorage.getItem($o))&&(P=O),L=.3,B=!1,z={x:20,y:l.WORLD_HEIGHT-100,width:50,height:50},h.addEventListener(a.InputEvent.TouchEnd,(function(){if(!B){for(var t=h.getTouchedWorldCoord(),e=0;e<b.length;e++){var i=b[e];if((0,a.pointInRect)(t.x,t.y,i.x,i.y,i.width,i.height))return void C(e)}(0,a.pointInRect)(t.x,t.y,z.x,z.y,z.width,z.height)&&D()}})),H=new a.Color(0,0,0,1),V=0,.5,F=0,N=!0,G=new a.Color(0,0,0,1),t.abrupt("return",{update:function(t,e){N&&(F+=t)>=.5&&(N=!1),s.setProjection(o.combined),s.begin(),s.draw(c,l.BG_OFFSET,0,l.BG_WIDTH,l.BG_HEIGHT),m.draw(s,l.WORLD_WIDTH/2-m.width/2,l.WORLD_HEIGHT/4-m.height/2,m.width,m.height,m.width/2,m.height/2,0,.5,.5),v.getData().setXYScale(.75);for(var i=0;i<12;i++){var n=b[i];p.draw(s,n.x,n.y,n.width,n.height),v.draw(s,"1-".concat(i+1),n.x,n.y+n.height/2-30,n.width,a.Align.center);for(var r=k(i),h=0;h<3;h++){(h<r?g:y).draw(s,n.x+38*h-3,n.y+n.height-35,35,35)}}v.getData().setXYScale(.4),v.draw(s,"Tap to toggle SameGame mechanic",z.x+60,z.y+12,l.WORLD_WIDTH-80),P===u.TOUCH_TO_MATCH?s.draw(w,z.x,z.y,z.width,z.height):s.draw(M,z.x,z.y,z.width,z.height),v.getData().setXYScale(1),s.end(),B&&(V+=t,d.setProjection(o.combined),d.begin(),H.a=a.MathUtils.clamp(V/L,0,1),d.rect(!0,l.BG_OFFSET,0,l.BG_WIDTH,l.BG_HEIGHT,H),d.end()),N&&(d.setProjection(o.combined),d.begin(),G.a=1-a.MathUtils.clamp(F/.5,0,1),d.rect(!0,l.BG_OFFSET,0,l.BG_WIDTH,l.BG_HEIGHT,G),d.end())},dispose:function(){h.cleanup(),s.dispose(),d.dispose()}});case 39:case"end":return t.stop()}}),t)})));return function(e,i){return t.apply(this,arguments)}}(),es=function(){var t=r(e().mark((function t(){var i,n,r,o,s,h,u,d;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=(0,a.createStage)(),n=i.getCanvas(),r=(0,a.createViewport)(n,l.WORLD_WIDTH,l.WORLD_HEIGHT,{crop:!1,contextOption:{antialias:!1},pixelRatio:Math.min(2,window.devicePixelRatio)}),o=r.getContext(),s=new a.AssetManager(o),["bush_animation","character_animation","chop_animation","cut_animation","pan_animation","wok_animation","grill_animation","stew_animation","shop_animation","ui","ui_end_level","ingredient","bubble"].forEach((function(t){return s.loadAtlas("./assets/atlas/".concat(t,".atlas"),t)})),s.loadTexture("./assets/texture/bg.jpg","bg"),s.loadTexture("./assets/texture/check.png","check"),s.loadTexture("./assets/texture/un_check.png","un_check"),s.loadFont("./assets/font/ui-font.fnt","ui",!0),s.loadFont("./assets/font/ui-outlined.fnt","ui-outlined",!0),t.next=13,s.finishLoading();case 13:return t.next=15,ts(r,s);case 15:h=t.sent,a.Game.shared.setScreen(h),u={loop:void 0,getFps:function(){return this.loop?this.loop.getFps():0}},d=(0,a.createGameLoop)((function(t){o.clearColor(0,0,0,1),o.clear(o.COLOR_BUFFER_BIT),a.PolygonBatch.resetTotalDrawCalls(),a.Game.shared.update(t),c.fps=u.getFps(),c.drawCalls=a.PolygonBatch.totalDrawCalls})),u.loop=d;case 20:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();es()}()}();